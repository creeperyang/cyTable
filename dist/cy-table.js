"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["angular"],e);else{if("object"!=typeof exports)return e(t);module.exports=e(t)}}(angular||null,function(t){var e=t.module("cyTable",[]);e.config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|data):/)}]),e.factory("cyTableParams",["$q","$log","$filter",function(e,a,n){var r=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},i=function(t){return Object.keys?Object.keys(t).length:function(t){var e,a=0;for(e in t)a++;return a}(t)},l={adjust:function(e,a,n){return t.isArray(e)?{list:n?e:e.slice(0,a.count()),total:e.length}:t.isObject(e)?(e.list=n?e.list:e.list.slice(0,a.count()),e):(a.data=[],a.total(0),!1)},filter:function(t,e){var a=e.filter(),r=a?n("filter")(t.list,a):void 0;return r?{list:r,total:r.length===e.$state.count?e.originalTotal:r.length}:t},sort:function(t,e){var a=e.sorting(),r=a?n("orderBy")(t.list,e.orderBy()):void 0;return r?{list:r,total:t.total}:t}},o=function(n,o){var s=this,c=function(){u.debugMode&&a.debug&&a.debug.apply(this,arguments)};this.data=[],this.originalData=void 0,this.originalTotal=void 0,this.cacheType=void 0,this.changedStates={},this.state=function(e){if(t.isDefined(e)){for(var a in e){var n=e[a];s.trackChanges(a,n,p[a]),p[a]=r(e[a])?parseFloat(e[a]):e[a]}return c("cyTable: set state",p),this}return p},this.props=function(e){return t.isDefined(e)?(u=t.extend(u,e),c("cyTable: set props",u),this):u},this.page=function(e){return t.isDefined(e)?this.state({page:e}):p.page},this.filter=function(e){return t.isDefined(e)?this.state({filter:e}):p.filter},this.count=function(e){return t.isDefined(e)?this.state({count:e,page:1}):p.count},this.sortType=function(e){return t.isDefined(e)?this.state({sortType:e,page:1}):p.sortType},this.filterType=function(e){return t.isDefined(e)?this.state({filterType:e,page:1}):p.filterType},this.total=function(e){return t.isDefined(e)?this.props({total:e}):u.total},this.trackChanges=function(t,e,a){s.changedStates[t]={name:t,prev:a,cur:e}},this.shouldUseCache=function(t,e){var a=i(e);if(1===a){if(e.sorting)return"local"===s.$state.sortType?"sort-local":!1;if(e.filter)return"local"===t.filterType?"filter-local":!1}else if(2===a&&e.page&&e.count)return e.page.cur===e.page.prev&&e.count.cur<=e.count.prev?"count-local":!1;return!1},this.query=function(e){var a,n,r={};if(t.isArray(e))for(a in e)a in p&&(r[a]=p[a]);else if(t.isFunction(e))for(a in p)"filterType"!==a&&"sortType"!==a&&(n=e(a,p[a]),n===!0?r[a]=p[a]:t.isArray(n)&&(r[n[0]]=n[1]));else for(a in p)"filterType"!==a&&"sortType"!==a&&(r[a]=p[a]);return r},this.getData=function(e,a,n){e.resolve(t.isArray(this.data)&&t.isObject(a)?{list:n?this.data:this.data.slice((a.page()-1)*a.count(),a.page()*a.count())}:{list:[],total:0})},this.getAllData=function(){var t=e.defer();return u.getData(t,s,!0),t.promise.then(function(t){u.$scope.$allData=l.adjust(t,s,!0).list}),t},this.reload=function(){var t,a=e.defer();u.loading=u.$scope.$loading=!0,c("cyTable: about to reload."),(s.cacheType=s.shouldUseCache(p,s.changedStates))?(a.resolve({list:(s.originalData||s.data).slice(0,p.count),total:s.originalTotal||p.total}),t=a.promise):(u.getData(a,s),t=a.promise.then(function(t){var e=l.adjust(t,s);return e?(s.originalData=e.list,s.originalTotal=e.total):c("cyTable: data is empty or not valid.",t),e})),s.changedStates={},t.then(function(t){u.loading=u.$scope.$loading=!1,u.$scope.$csvGenerated=!1,t&&("local"===p.filterType&&p.filter&&(t=l.filter(t,s)),"local"===p.sortType&&p.sorting&&(t=l.sort(t,s)),c("cyTable: current scope",u.$scope),s.data=u.$scope.$data=t.list,r(t.total)&&s.total(t.total),u.$scope.pages=s.generatePagesArray(s.page(),s.total(),s.count()),u.$scope.$emit("cyTableAfterReloadData"))})},this.generatePagesArray=function(t,e,a){var n,r,i,l,o,s,c;if(n=11,s=[],o=Math.ceil(e/a),o>1){s.push({type:"prev",number:Math.max(1,t-1),active:t>1}),s.push({type:"first",number:1,active:t>1}),i=Math.round((n-5)/2),l=Math.max(2,t-i),r=Math.min(o-1,t+2*i-(t-l)),l=Math.max(2,l-(2*i-(r-l)));for(var p=l;r>=p;)c=p===l&&2!==p||p===r&&p!==o-1?{type:"more",active:t!==p,number:p}:{type:"page",number:p,active:t!==p},s.push(c),p++;s.push({type:"last",number:o,active:t!==o}),s.push({type:"next",number:Math.min(o,t+1),active:o>t})}return s},this.sorting=function(e){if(2===arguments.length){var a={};return a[e]=arguments[1],this.state({sorting:a}),this}return t.isDefined(e)?this.state({sorting:e}):p.sorting},this.orderBy=function(){var t=[];for(var e in p.sorting)t.push(("asc"===p.sorting[e]?"+":"-")+e);return t};var p=this.$state={page:1,count:5,filter:null,filterType:"local",sorting:null,sortType:"local"},u={loading:!1,total:0,$scope:null,defaultSort:"desc",filterDelay:750,counts:[5,10,25,50],sortingIndicator:"span",getData:this.getData};return this.props(o),this.state(n),this};return o}]);var a=["$scope","cyTableParams","$timeout",function(e,a,n){function r(t){e.params.sortType(t)}function i(t){e.params.filterType(t)}var l=function(){var t=0;return function(e,a){n.cancel(t),t=n(e,a)}}();e.$watch("params",function(a,n){t.isUndefined(a)||(e.$watch("filterType",function(t){t&&i(t)}),e.$watch("sortType",function(t){t&&r(t)}),e.$watch("params.$state",function(a,n){t.isUndefined(a)||(t.equals(a.filter,n&&n.filter)?e.params.reload():l(function(){e.params.$state.page=1,e.params.reload()},e.params.props().filterDelay))},!0))}),e.sortBy=function(t,a){var n=e.parse(t.sortable);if(n){var r=e.params.props().defaultSort,i="asc"===r?"desc":"asc",l=e.params.sorting()&&e.params.sorting()[n]&&e.params.sorting()[n]===r,o=a.ctrlKey||a.metaKey?e.params.sorting():{};o[n]=l?i:r,e.params.state({sorting:o})}}}];return e.directive("cyTable",["$compile","$q","$parse",function(e,n,r){return{restrict:"A",priority:1001,scope:!0,controller:a,compile:function(a){var n,i=[],l=0,o=a.find("table"),s=o.find("thead"),c=t.element(a[0].querySelector("tr:not(.cy-table-group)"));return c&&c[0]?(t.forEach(c.find("td"),function(e){var a=t.element(e);if(!a.attr("ignore-cell")||"true"!==a.attr("ignore-cell")){var n=function(t){return a.attr("data-"+t)||a.attr(t)},o=function(t,e){var a=n(t);return function(t){return a?r(a)(t,{$columns:i}):e}},s=o("title"," "),c=o("header",!1),p=o("filter",!1)(),u=!1,f=!1;p&&p.$$name&&(f=p.$$name,delete p.$$name),p&&p.templateURL&&(u=p.templateURL,delete p.templateURL);var d=n("title");d&&a.attr("data-title-text","{{"+d+"}}"),i.push({id:l++,title:s,sortable:o("sortable",!1),"class":o("header-class",""),filter:p,filterTemplateURL:u,filterName:f,headerTemplateURL:c,filterData:a.attr("filter-data")?a.attr("filter-data"):null,show:a.attr("ng-if")?function(t){return r(a.attr("ng-if"))(t)}:function(){return!0}})}}),n=c.outerHTML?c.outerHTML:t.element("<div></div>").append(c.clone()).html(),function(a,l,o,c){var p=l.find("table").addClass("cy-table-content");if(a.$columns=i,a.$rowTpl="<table><tbody>"+n.replace(/^(\s*<\s*tr.+)(\$data)/,"$1$allData")+"</tbody></table>",o.$observe("filterType",function(t){a.filterType=t}),o.$observe("sortType",function(t){a.sortType=t}),a.$watch(o.cyTable,function(e){t.isUndefined(e)||(a.paramsModel=r(o.cyTable),a.params=e,e.props().$scope=a)},!0),a.parse=function(e){return t.isDefined(e)?e(a):""},o.showFilter&&a.$parent.$watch(o.showFilter,function(t){a.showFilter=t}),t.forEach(i,function(e){var n;if(e.filterData){if(n=r(e.filterData)(a,{$column:e}),!t.isObject(n)||!t.isObject(n.promise))throw new Error("Function "+e.filterData+" must be instance of $q.defer()");return delete e.filterData,n.promise.then(function(a){t.isArray(a)||(a=[]),a.unshift({title:"-",id:""}),e.data=a})}}),!l.hasClass("cy-table")){a.templates={header:o.templateHeader?o.templateHeader:"cy-table/header.html",pagination:o.templatePagination?o.templatePagination:"cy-table/pager.html",operation:o.templateOperation?o.templateOperation:"cy-table/operation.html"};var u=s.length>0?s:t.element(document.createElement("thead")).attr("ng-include","templates.header"),f=t.element(l[0].querySelector(".cy-table-pagination")),d=t.element(l[0].querySelector(".cy-table-operation"));f.attr({"cy-table-pagination":"params","template-url":"templates.pagination"}),d.attr({"cy-table-operation":"","template-url":"templates.operation"}),l.find("thead").remove(),l.addClass("cy-table"),p.prepend(u),e(u)(a),e(f)(a),e(d)(a)}}):void 0}}}]),e.directive("cyTablePagination",["$compile",function(e){return{restrict:"A",scope:{params:"=cyTablePagination",templateUrl:"="},replace:!1,link:function(a,n,r){a.$watch("params",function(e){t.isUndefined(e)||a.params.props().$scope.$on("cyTableAfterReloadData",function(){a.pages=a.params.generatePagesArray(a.params.page(),a.params.total(),a.params.count())},!0)}),a.$watch("templateUrl",function(r){if(!t.isUndefined(r)){var i=t.element(document.createElement("div"));i.attr({"ng-include":"templateUrl"}),n.append(i),e(i)(a)}})}}}]),e.directive("cyTableOperation",["$compile",function(e){return{restrict:"A",scope:!0,replace:!1,require:"^cyTable",link:function(a,n,r){r.templateUrl&&r.$observe("templateUrl",function(r){if(!t.isUndefined(r)){var i=t.element(document.createElement("div"));i.attr({"ng-include":r}),n.append(i),e(i)(a)}})}}}]),e.directive("cyTableCsv",["$parse","$compile","$timeout",function(e,a,n){return{restrict:"A",scope:!1,link:function(r,i,l){function o(e,a){if(!e||!e.length)return"";var n=[];return p.call(e).map(function(e){e=t.element(e);var r=e.find("th");0===r.length&&(r=e.find("td")),a&&a(e)||n.push(p.call(r).map(function(e){return g.stringify(t.element(e).text())}).join(d))}),'"'+n.join(m).split(m).join(f).split(d).join(u)+'"'}function s(t,e,a){var n=document.createElement("a");if(a=a||"application/octet-stream",navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([t],{type:a}),e);if("download"in n)return n.href="data:"+a+","+encodeURIComponent(t),n.setAttribute("download",e),document.body.appendChild(n),setTimeout(function(){n.click(),document.body.removeChild(n)},66),!0;var r=document.createElement("iframe");return document.body.appendChild(r),r.src="data:"+a+","+encodeURIComponent(t),setTimeout(function(){document.body.removeChild(r)},333),!0}var c="",p=Array.prototype.slice,u='","',f='"\r\n"',d=String.fromCharCode(11),m=String.fromCharCode(0),g={stringify:function(t){return t.replace(/^\s\s*/,"").replace(/\s*\s$/,"").replace(/"/g,'""')},generate:function(t,e){var l;r.$csvGenerated||(g.generating=!0,e&&r.params.getAllData?(t.preventDefault(),t.stopPropagation(),l=t.target,r.params.getAllData().promise.then(function(){var t=a(r.$rowTpl)(r);n(function(){t.prepend(i.find("thead").clone()),c=o(t.find("tr"),function(t){return t&&t.hasClass("ng-table-filters")}),g.generating=!1,n(function(){l.click()})})})):(c=o(i.find("tr"),function(t){return t&&t.hasClass("ng-table-filters")}),g.generating=!1),r.$csvGenerated=!0)},link:function(){return"data:text/csv;charset=utf-8,"+encodeURIComponent(c)},download:function(t){s(c,t||"dowload.csv","text/csv")},generating:!1};e(l.cyTableCsv).assign(r.$parent,g)}}}]),e.run(["$templateCache",function(t){t.put("cy-table/filters/text.html",'<input type="text" name="{{column.filterName}}" ng-model="params.filter()[name]" ng-change="params.trackChanges(\'filter\', params.filter())" ng-if="filter === \'text\' && params.filterType() === \'local\'" class="input-filter form-control" />'),t.put("cy-table/header.html",'<tr><th ng-repeat="$column in $columns" ng-if="$column.show(this)" data-title="{{$column.title(this)}}" ng-class="{ \'sortable\': parse($column.sortable), \'sort-asc\': params.sorting()[parse($column.sortable)]==\'asc\', \'sort-desc\': params.sorting()[parse($column.sortable)]==\'desc\' }" ng-click="sortBy($column, $event)" ng-init="template=$column.headerTemplateURL(this)" class="header {{$column.class(this)}}"><div ng-if="!template" ng-bind="$column.title(this)"></div><div ng-if="template"><div ng-include="template"></div></div></th></tr><tr ng-show="showFilter && params.filterType() === \'local\'" class="cy-table-filters"><th ng-repeat="$column in $columns" data-title-text="{{$column.title(this)}}" ng-if="$column.show(this)" class="filter"><div ng-repeat="(name, filter) in $column.filter"><div ng-if="$column.filterTemplateURL"><div ng-include="$column.filterTemplateURL"></div></div><div ng-if="!$column.filterTemplateURL"><div ng-include="\'cy-table/filters/\' + filter + \'.html\'"></div></div></div></th></tr>'),t.put("cy-table/pager.html",'<ul class="cy-table-pager pager ng-cloak"><li ng-repeat="page in pages" ng-class="{\'disabled\': !page.active, \'previous\': page.type === \'prev\', \'next\': page.type===\'next\'}"><a ng-if="page.type === \'prev\'" ng-click="params.page(page.number)" href="">Prev</a><a ng-if="page.type === \'next\'" ng-click="params.page(page.number)" href="">Next</a><a ng-if="page.type === \'page\' || page.type === \'first\' || page.type === \'last\'" ng-click="params.page(page.number)" href="">{{page.number}}</a><a ng-if="page.type === \'more\'" ng-click="params.page(page.number)" href="">...</a></li></ul>')}]),e});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN5LXRhYmxlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsImFwcCIsImNvbmZpZyIsIiRjb21waWxlUHJvdmlkZXIiLCJhSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCIsIiRxIiwiJGxvZyIsIiRmaWx0ZXIiLCJpc051bWJlciIsIm4iLCJpc05hTiIsInBhcnNlRmxvYXQiLCJpc0Zpbml0ZSIsImdldGtleXNMZW5ndGgiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwicCIsImkiLCJkYXRhSGFuZGxlcnMiLCJhZGp1c3QiLCJkYXRhIiwidGFibGVQYXJhbXMiLCJub3RDdXREYXRhIiwiaXNBcnJheSIsImxpc3QiLCJzbGljZSIsImNvdW50IiwidG90YWwiLCJpc09iamVjdCIsImZpbHRlciIsInVuZGVmaW5lZCIsIiRzdGF0ZSIsIm9yaWdpbmFsVG90YWwiLCJzb3J0Iiwic29ydGluZyIsIm9yZGVyQnkiLCJjeVRhYmxlUGFyYW1zIiwiaW5pdFN0YXRlIiwiaW5pdFByb3BzIiwic2VsZiIsInRoaXMiLCJsb2ciLCJwcm9wcyIsImRlYnVnTW9kZSIsImRlYnVnIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJvcmlnaW5hbERhdGEiLCJjYWNoZVR5cGUiLCJjaGFuZ2VkU3RhdGVzIiwic3RhdGUiLCJuZXdTdGF0ZSIsImlzRGVmaW5lZCIsImtleSIsInZhbHVlIiwidHJhY2tDaGFuZ2VzIiwibmV3UHJvcHMiLCJleHRlbmQiLCJwYWdlIiwic29ydFR5cGUiLCJmaWx0ZXJUeXBlIiwibmV3VmFsdWUiLCJvbGRWYWx1ZSIsIm5hbWUiLCJwcmV2IiwiY3VyIiwic2hvdWxkVXNlQ2FjaGUiLCJxdWVyeSIsInRtcCIsInJldCIsImlzRnVuY3Rpb24iLCJnZXREYXRhIiwiJGRlZmVyIiwiYWxsIiwicmVzb2x2ZSIsImdldEFsbERhdGEiLCJkZWZlciIsInByb21pc2UiLCJ0aGVuIiwiJHNjb3BlIiwiJGFsbERhdGEiLCJyZWxvYWQiLCJsb2FkaW5nIiwiJGxvYWRpbmciLCJoYW5kbGVkRGF0YSIsIiRjc3ZHZW5lcmF0ZWQiLCIkZGF0YSIsInBhZ2VzIiwiZ2VuZXJhdGVQYWdlc0FycmF5IiwiJGVtaXQiLCJjdXJyZW50UGFnZSIsInRvdGFsSXRlbXMiLCJwYWdlU2l6ZSIsIm1heEJsb2NrcyIsIm1heFBhZ2UiLCJtYXhQaXZvdFBhZ2VzIiwibWluUGFnZSIsIm51bVBhZ2VzIiwidG1wSXRlbSIsIk1hdGgiLCJjZWlsIiwicHVzaCIsInR5cGUiLCJudW1iZXIiLCJtYXgiLCJhY3RpdmUiLCJyb3VuZCIsIm1pbiIsInNvcnRBcnJheSIsImNvbHVtbiIsImRlZmF1bHRTb3J0IiwiZmlsdGVyRGVsYXkiLCJjb3VudHMiLCJzb3J0aW5nSW5kaWNhdG9yIiwiY3lUYWJsZUNvbnRyb2xsZXIiLCIkdGltZW91dCIsInNldFNvcnRUeXBlIiwicGFyYW1zIiwic2V0RmlsdGVyVHlwZSIsImRlbGF5RmlsdGVyIiwidGltZXIiLCJjYWxsYmFjayIsIm1zIiwiY2FuY2VsIiwiJHdhdGNoIiwibmV3UGFyYW1zIiwib2xkUGFyYW1zIiwiaXNVbmRlZmluZWQiLCJvbGRTdGF0ZSIsImVxdWFscyIsInNvcnRCeSIsImV2ZW50IiwicGFyc2VkU29ydGFibGUiLCJwYXJzZSIsInNvcnRhYmxlIiwiaW52ZXJzZVNvcnQiLCJzb3J0aW5nUGFyYW1zIiwiY3RybEtleSIsIm1ldGFLZXkiLCJkaXJlY3RpdmUiLCIkY29tcGlsZSIsIiRwYXJzZSIsInJlc3RyaWN0IiwicHJpb3JpdHkiLCJzY29wZSIsImNvbnRyb2xsZXIiLCJjb21waWxlIiwiZWxlbWVudCIsInJvd1RwbCIsImNvbHVtbnMiLCJ0YWJsZSIsImZpbmQiLCJ0aGVhZCIsInJvdyIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JFYWNoIiwiaXRlbSIsImVsIiwiYXR0ciIsImdldEF0dHJWYWx1ZSIsInBhcnNlZEF0dHJpYnV0ZSIsImRlZmF1bHRWYWx1ZSIsImV4cHIiLCIkY29sdW1ucyIsInBhcnNlZFRpdGxlIiwiaGVhZGVyVGVtcGxhdGVVUkwiLCJmaWx0ZXJUZW1wbGF0ZVVSTCIsImZpbHRlck5hbWUiLCIkJG5hbWUiLCJ0ZW1wbGF0ZVVSTCIsInRpdGxlRXhwciIsImlkIiwidGl0bGUiLCJjbGFzcyIsImZpbHRlckRhdGEiLCJzaG93Iiwib3V0ZXJIVE1MIiwiYXBwZW5kIiwiY2xvbmUiLCJodG1sIiwiYXR0cnMiLCJjdHJsIiwiYWRkQ2xhc3MiLCIkcm93VHBsIiwicmVwbGFjZSIsIiRvYnNlcnZlIiwiY3lUYWJsZSIsInBhcmFtc01vZGVsIiwidGV4dCIsInNob3dGaWx0ZXIiLCIkcGFyZW50IiwiZGVmIiwiJGNvbHVtbiIsIkVycm9yIiwidW5zaGlmdCIsImhhc0NsYXNzIiwidGVtcGxhdGVzIiwiaGVhZGVyIiwidGVtcGxhdGVIZWFkZXIiLCJwYWdpbmF0aW9uIiwidGVtcGxhdGVQYWdpbmF0aW9uIiwib3BlcmF0aW9uIiwidGVtcGxhdGVPcGVyYXRpb24iLCJoZWFkZXJUZW1wbGF0ZSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInBhZ2luYXRpb25UZW1wbGF0ZSIsIm9wZXJhdGlvblRlbXBsYXRlIiwiY3ktdGFibGUtcGFnaW5hdGlvbiIsInRlbXBsYXRlLXVybCIsImN5LXRhYmxlLW9wZXJhdGlvbiIsInJlbW92ZSIsInByZXBlbmQiLCJ0ZW1wbGF0ZVVybCIsImxpbmsiLCIkb24iLCJ0ZW1wbGF0ZSIsIm5nLWluY2x1ZGUiLCJyZXF1aXJlIiwiZ2VuQ3N2Iiwicm93cyIsImlnbm9yZVJvdyIsImhhbmRsZWRSb3dzIiwiY2FsbCIsIm1hcCIsImNvbHMiLCJjb2wiLCJjc3YiLCJzdHJpbmdpZnkiLCJqb2luIiwidG1wQ29sRGVsaW0iLCJ0bXBSb3dEZWxpbSIsInNwbGl0Iiwicm93RGVsaW0iLCJjb2xEZWxpbSIsImRvd25sb2FkIiwiY29udGVudCIsImZpbGVOYW1lIiwibWltZVR5cGUiLCJhIiwibmF2aWdhdG9yIiwibXNTYXZlQmxvYiIsIkJsb2IiLCJocmVmIiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwic2V0QXR0cmlidXRlIiwiYm9keSIsImFwcGVuZENoaWxkIiwic2V0VGltZW91dCIsImNsaWNrIiwicmVtb3ZlQ2hpbGQiLCJmIiwic3JjIiwiY3N2U3RyIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJzdHIiLCJnZW5lcmF0ZSIsIiRldmVudCIsInRhcmdldCIsImdlbmVyYXRpbmciLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsImN5VGFibGVDc3YiLCJhc3NpZ24iLCJydW4iLCIkdGVtcGxhdGVDYWNoZSIsInB1dCJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFRSxTQUFTQSxFQUFTQyxHQUVoQixHQUFzQixrQkFBWEMsU0FBeUJBLE9BQU9DLElBQ3ZDRCxRQUFRLFdBQVlELE9BQ2pCLENBQUEsR0FBdUIsZ0JBQVpHLFNBR2QsTUFBT0gsR0FBUUQsRUFGZkssUUFBT0QsUUFBVUgsRUFBUUQsS0FLL0JBLFNBQVcsS0FBTSxTQUFTQSxHQUV4QixHQUFJTSxHQUFNTixFQUFRSyxPQUFPLGFBT3pCQyxHQUFJQyxRQUFRLG1CQUFvQixTQUFTQyxHQUNyQ0EsRUFBaUJDLDJCQUEyQiw2Q0FRaERILEVBQUlMLFFBQVEsaUJBQWtCLEtBQU0sT0FBUSxVQUFXLFNBQVNTLEVBQUlDLEVBQU1DLEdBQ3RFLEdBQUlDLEdBQVcsU0FBU0MsR0FDcEIsT0FBUUMsTUFBTUMsV0FBV0YsS0FBT0csU0FBU0gsSUFFekNJLEVBQWdCLFNBQVNDLEdBQ3pCLE1BQU9DLFFBQU9DLEtBQU9ELE9BQU9DLEtBQUtGLEdBQUtHLE9BQVMsU0FBVUgsR0FDckQsR0FBV0ksR0FBUEMsRUFBSSxDQUNSLEtBQUtELElBQUtKLEdBQ05LLEdBRUosT0FBT0EsSUFDUkwsSUFJSE0sR0FDQUMsT0FBUSxTQUFvQkMsRUFBTUMsRUFBYUMsR0FDM0MsTUFBSTdCLEdBQVE4QixRQUFRSCxJQUVaSSxLQUFNRixFQUFhRixFQUFPQSxFQUFL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UyxJQUUvRGxCLFNBQVUsU0FBU0UsR0FDZkYsRUFBU2tCLEVBQVFoQixHQUFZLGNBQWUsYUFFaER5QixZQUFZLEVBRWhCekgsR0FBT3VDLEVBQU1xRixZQUFZQyxPQUFPMUgsRUFBTThDLFFBQVNxQyxRQTBEM0RwTyxFQUFJNFEsS0FBSyxpQkFBa0IsU0FBU0MsR0FDaENBLEVBQWVDLElBQUksNkJBQThCLHVQQUNqREQsRUFBZUMsSUFBSSx1QkFBd0IsdWdDQUMzQ0QsRUFBZUMsSUFBSSxzQkFBdUIsOGxCQUd2QzlRIiwiZmlsZSI6ImN5LXRhYmxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG47KGZ1bmN0aW9uKGFuZ3VsYXIsIGZhY3RvcnkpIHtcblxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKFsnYW5ndWxhciddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoYW5ndWxhcik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhY3RvcnkoYW5ndWxhcik7XG4gICAgfVxuXG59KGFuZ3VsYXIgfHwgbnVsbCwgZnVuY3Rpb24oYW5ndWxhcikge1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjeVRhYmxlJywgW10pO1xuXG4gICAgLypcbiAgICAgKiBhdHRlbnNpb246IEFuZ3VsYXJKUyAxLjMueCwgJCRTYW5pdGl6ZVVyaVByb3ZpZGVyIHNldCBhSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCA9IC9eXFxzKihodHRwcz98ZnRwfG1haWx0b3x0ZWx8ZmlsZSk6L1xuICAgICAqIGFuZCBleHBvcnQgY3N2LCBocmVmIHdvdWxkIGJlIGxpa2UgYGRhdGE6dGV4dC9jc3YuLi5gXG4gICAgICogaWYgZG9udCBjaGFuZ2UgdGhpcywgYW5ndWxhciB3b3VsZCBhZGQgYHVuc2FmZTpgIHByZWZpeCwgc28gbW9kaWZ5IGFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0XG4gICAgKi9cbiAgICBhcHAuY29uZmlnKFsnJGNvbXBpbGVQcm92aWRlcicsIGZ1bmN0aW9uKCRjb21waWxlUHJvdmlkZXIpIHtcbiAgICAgICAgJGNvbXBpbGVQcm92aWRlci5hSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCgvXlxccyooaHR0cHM/fGZ0cHxtYWlsdG98dGVsfGZpbGV8ZGF0YSk6Lyk7XG4gICAgfV0pO1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIHNlcnZpY2VcbiAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAqIEBkZXNjcmlwdGlvbiBQYXJhbWV0ZXJzIG1hbmFnZXIgZm9yIGN5VGFibGVcbiAgICAgKi9cbiAgICBhcHAuZmFjdG9yeSgnY3lUYWJsZVBhcmFtcycsIFsnJHEnLCAnJGxvZycsICckZmlsdGVyJywgZnVuY3Rpb24oJHEsICRsb2csICRmaWx0ZXIpIHtcbiAgICAgICAgdmFyIGlzTnVtYmVyID0gZnVuY3Rpb24obikge1xuICAgICAgICAgICAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG4pKSAmJiBpc0Zpbml0ZShuKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGdldGtleXNMZW5ndGggPSBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyA/IE9iamVjdC5rZXlzKG9iaikubGVuZ3RoIDogKGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgICAgIHZhciBpID0gMCwgcDtcbiAgICAgICAgICAgICAgICBmb3IgKHAgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9KShvYmopO1xuICAgICAgICB9O1xuICAgICAgICAvLyBkYXRhIGhhbmRsZXJzIHRvIGhhbmRsZSBkYXRhIGdldCBmcm9tICNnZXREYXRhXG4gICAgICAgIC8vIGlubmVyIHVzYWdlIG5vd1xuICAgICAgICB2YXIgZGF0YUhhbmRsZXJzID0ge1xuICAgICAgICAgICAgYWRqdXN0OiBmdW5jdGlvbiBhZGp1c3REYXRhKGRhdGEsIHRhYmxlUGFyYW1zLCBub3RDdXREYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogbm90Q3V0RGF0YSA/IGRhdGEgOiBkYXRhLnNsaWNlKDAsIHRhYmxlUGFyYW1zLmNvdW50KCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGRhdGEubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbmd1bGFyLmlzT2JqZWN0KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGlzdCA9IG5vdEN1dERhdGEgPyBkYXRhLmxpc3QgOiBkYXRhLmxpc3Quc2xpY2UoMCwgdGFibGVQYXJhbXMuY291bnQoKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlUGFyYW1zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGFibGVQYXJhbXMudG90YWwoMCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiBmaWx0ZXJEYXRhKGRhdGEsIHRhYmxlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlciA9IHRhYmxlUGFyYW1zLmZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gZmlsdGVyID8gJGZpbHRlcignZmlsdGVyJykoZGF0YS5saXN0LCBmaWx0ZXIpIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0ID8ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0OiBsaXN0LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogbGlzdC5sZW5ndGggPT09IHRhYmxlUGFyYW1zLiRzdGF0ZS5jb3VudCA/IHRhYmxlUGFyYW1zLm9yaWdpbmFsVG90YWwgOiBsaXN0Lmxlbmd0aFxuICAgICAgICAgICAgICAgIH0gOiBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNvcnQ6IGZ1bmN0aW9uIHNvcnREYXRhKGRhdGEsIHRhYmxlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRpbmcgPSB0YWJsZVBhcmFtcy5zb3J0aW5nKCk7XG4gICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBzb3J0aW5nID8gJGZpbHRlcignb3JkZXJCeScpKGRhdGEubGlzdCwgdGFibGVQYXJhbXMub3JkZXJCeSgpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdCA/IHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdDogbGlzdCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGRhdGEudG90YWxcbiAgICAgICAgICAgICAgICB9IDogZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY3lUYWJsZVBhcmFtcyA9IGZ1bmN0aW9uKGluaXRTdGF0ZSwgaW5pdFByb3BzKSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByb3BzLmRlYnVnTW9kZSAmJiAkbG9nLmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyB0YWJsZSBkYXRhXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIC8vIHVzZWQgdG8ga2VlcCBvcmlnaW5hbCBkYXRhKGZldGNoZWQgZnJvbSByZW1vdGUpXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxUb3RhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIC8vIFdoZXRoZXIgdG8gdXNlIGNhY2hlLlxuICAgICAgICAgICAgLy8gVXNlZnVsIGZvciBleGFtcGxlLCB3aGVuIHlvdSBzZXQgcGFnZSBsZW5ndGggNTAgdG8gMjAsIG5vIG5lZWQgdG8gcmVsb2FkIGRhdGEuXG4gICAgICAgICAgICB0aGlzLmNhY2hlVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIC8vIHRoZSBjaGFuZ2VkIHN0YXRlIHByb3BlcnRpZXMsIHJlc2V0IGFmdGVyIHJlbG9hZCxcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlZFN0YXRlcyA9IHt9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3N0YXRlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTZXQgbmV3IHN0YXRlIG9yIGdldCBjdXJyZW50IHN0YXRlXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5ld1N0YXRlIE5ldyBzdGF0ZVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdH0gQ3VycmVudCBzdGF0ZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbmV3U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG5ld1N0YXRlW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYWNrQ2hhbmdlcyhrZXksIHZhbHVlLCBzdGF0ZVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlW2tleV0gPSAoaXNOdW1iZXIobmV3U3RhdGVba2V5XSkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQobmV3U3RhdGVba2V5XSkgOiBuZXdTdGF0ZVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsb2coJ2N5VGFibGU6IHNldCBzdGF0ZScsIHN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjcHJvcHNcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNldCBuZXcgcHJvcHMgb3IgZ2V0IGN1cnJlbnQgcHJvcHNcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3UHJvcHMgTmV3IHByb3BzIG9yIHVuZGVmaW5lZFxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdH0gQ3VycmVudCBwcm9wcyBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5wcm9wcyA9IGZ1bmN0aW9uKG5ld1Byb3BzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKG5ld1Byb3BzKSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9wcyA9IGFuZ3VsYXIuZXh0ZW5kKHByb3BzLCBuZXdQcm9wcyk7XG4gICAgICAgICAgICAgICAgICAgIGxvZygnY3lUYWJsZTogc2V0IHByb3BzJywgcHJvcHMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNwYWdlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgcGFnZSBub3Qgc2V0IHJldHVybiBjdXJyZW50IHBhZ2UgZWxzZSBzZXQgY3VycmVudCBwYWdlXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBhZ2UgUGFnZSBudW1iZXJcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R8TnVtYmVyfSBDdXJyZW50IHBhZ2Ugb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMucGFnZSA9IGZ1bmN0aW9uKHBhZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQocGFnZSkgPyB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgJ3BhZ2UnOiBwYWdlXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5wYWdlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNmaWx0ZXJcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmIHBhcmFtZXRlciBwYWdlIG5vdCBzZXQgcmV0dXJuIGN1cnJlbnQgZmlsdGVyIGVsc2Ugc2V0IGN1cnJlbnQgZmlsdGVyXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciBOZXcgZmlsdGVyXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDdXJyZW50IGZpbHRlciBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoZmlsdGVyKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnZmlsdGVyJzogZmlsdGVyXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5maWx0ZXI7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2NvdW50XG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgY291bnQgbm90IHNldCByZXR1cm4gY3VycmVudCBjb3VudCBwZXIgcGFnZSBlbHNlIHNldCBjb3VudCBwZXIgcGFnZVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb3VudCBDb3VudCBwZXIgbnVtYmVyXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fE51bWJlcn0gQ291bnQgcGVyIHBhZ2Ugb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuY291bnQgPSBmdW5jdGlvbihjb3VudCkge1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IHRvIGZpcnN0IHBhZ2UgYmVjYXVzZSBjYW4gYmUgYmxhbmsgcGFnZVxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChjb3VudCkgPyB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogY291bnQsXG4gICAgICAgICAgICAgICAgICAgICdwYWdlJzogMVxuICAgICAgICAgICAgICAgIH0pIDogc3RhdGUuY291bnQ7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3NvcnRUeXBlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgc29ydFR5cGUgbm90IHNldCByZXR1cm4gY3VycmVudCBzb3J0VHlwZSBlbHNlIHNldCBzb3J0VHlwZVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3J0VHlwZSBob3cgdG8gc29ydCBkYXRhKCdyZW1vdGUnOiBsZXQgc2VydmVyIHNvcnQgYWxsIGRhdGEgaW4gZGJ8J2xvY2FsJzogc29ydCBsb2NhbClcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R8TnVtYmVyfSBTb3J0VHlwZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5zb3J0VHlwZSA9IGZ1bmN0aW9uKHNvcnRUeXBlKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgdG8gZmlyc3QgcGFnZSBiZWNhdXNlIGNhbiBiZSBibGFuayBwYWdlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHNvcnRUeXBlKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnc29ydFR5cGUnOiBzb3J0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgJ3BhZ2UnOiAxXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5zb3J0VHlwZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjZmlsdGVyVHlwZVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gSWYgcGFyYW1ldGVyIGZpbHRlclR5cGUgbm90IHNldCByZXR1cm4gY3VycmVudCBmaWx0ZXJUeXBlIGVsc2Ugc2V0IGZpbHRlclR5cGVcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyVHlwZSBob3cgdG8gZmlsdGVyIGRhdGEoJ3JlbW90ZSc6IGxldCBzZXJ2ZXIgc2VhcmNoIGZyb20gZGJ8J2xvY2FsJzogZmlsdGVyIGxvY2FsKVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdHxOdW1iZXJ9IEZpbHRlclR5cGUgb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVHlwZSA9IGZ1bmN0aW9uKGZpbHRlclR5cGUpIHtcbiAgICAgICAgICAgICAgICAvLyByZXNldCB0byBmaXJzdCBwYWdlIGJlY2F1c2UgY2FuIGJlIGJsYW5rIHBhZ2VcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoZmlsdGVyVHlwZSkgPyB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgJ2ZpbHRlclR5cGUnOiBmaWx0ZXJUeXBlLFxuICAgICAgICAgICAgICAgICAgICAncGFnZSc6IDFcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLmZpbHRlclR5cGU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3RvdGFsXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgdG90YWwgbm90IHNldCByZXR1cm4gY3VycmVudCBxdWFudGl0eSBlbHNlIHNldCBxdWFudGl0eVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0b3RhbCBUb3RhbCBxdWFudGl0eSBvZiBpdGVtc1xuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdHxOdW1iZXJ9IEN1cnJlbnQgdG90YWwgb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMudG90YWwgPSBmdW5jdGlvbih0b3RhbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZCh0b3RhbCkgPyB0aGlzLnByb3BzKHtcbiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsJzogdG90YWxcbiAgICAgICAgICAgICAgICB9KSA6IHByb3BzLnRvdGFsO1xuICAgICAgICAgICAgfTtcblxuXG5cbiAgICAgICAgICAgIC8vIGlubmVyIHVzYWdlIG9ubHkgbm93XG4gICAgICAgICAgICAvLyB0cmFjayB3aGF0IGNoYW5nZWQgd2l0aCBzdGF0ZVxuICAgICAgICAgICAgdGhpcy50cmFja0NoYW5nZXMgPSBmdW5jdGlvbihrZXksIG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2hhbmdlZFN0YXRlc1trZXldID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXksXG4gICAgICAgICAgICAgICAgICAgIHByZXY6IG9sZFZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBjdXI6IG5ld1ZhbHVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGlubmVyIHVzYWdlIG9ubHkgbm93XG4gICAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0byB1c2UgY2FjaGVcbiAgICAgICAgICAgIHRoaXMuc2hvdWxkVXNlQ2FjaGUgPSBmdW5jdGlvbihzdGF0ZSwgY2hhbmdlZFN0YXRlcykge1xuICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSBnZXRrZXlzTGVuZ3RoKGNoYW5nZWRTdGF0ZXMpO1xuICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYW5nZWRTdGF0ZXMuc29ydGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuJHN0YXRlLnNvcnRUeXBlID09PSAnbG9jYWwnID8gJ3NvcnQtbG9jYWwnIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYW5nZWRTdGF0ZXMuZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuZmlsdGVyVHlwZSA9PT0gJ2xvY2FsJyA/ICdmaWx0ZXItbG9jYWwnIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZFN0YXRlcy5wYWdlICYmIGNoYW5nZWRTdGF0ZXMuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkU3RhdGVzLnBhZ2UuY3VyID09PSBjaGFuZ2VkU3RhdGVzLnBhZ2UucHJldiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRTdGF0ZXMuY291bnQuY3VyIDw9IGNoYW5nZWRTdGF0ZXMuY291bnQucHJldiA/ICdjb3VudC1sb2NhbCcgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3F1ZXJ5XG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBDYWxsZWQgYnkgdXNlciB0byBidWlsZCBxdWVyeSBwYXJhbXMgZm9yIGFqYXguXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbnxBcnJheX0gb3B0aW9uYWwgZmlsdGVyLiBXaGVuIGl0J3MgYXJyYXksIGl0J3MgcHJvcGVydHkgbmFtZXMgd2hpY2ggbmVlZGVkIGJ5IHVzZXI7XG4gICAgICAgICAgICAgKiAgICAgd2hlbiBpdCdzIGZ1bmN0aW9uLCByZXR1cm4gdHJ1ZXxmYWxzZSB0byBmaWx0ZXIgcHJvcGVydGllcywgb3IgcmV0dXJuIGFuIGFycmF5KFt1cGRhdGVkTmFtZSwgdXBkYXRlZFZhbHVlXSkuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0ge30sIHAsIHRtcDtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChwIGluIGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgKHAgaW4gc3RhdGUpICYmIChyZXRbcF0gPSBzdGF0ZVtwXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAocCBpbiBzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAgPT09ICdmaWx0ZXJUeXBlJyB8fCBwID09PSAnc29ydFR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSBmaWx0ZXIocCwgc3RhdGVbcF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFtwXSA9IHN0YXRlW3BdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbmd1bGFyLmlzQXJyYXkodG1wKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFt0bXBbMF1dID0gdG1wWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChwIGluIHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA9PT0gJ2ZpbHRlclR5cGUnIHx8IHAgPT09ICdzb3J0VHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFtwXSA9IHN0YXRlW3BdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2dldERhdGFcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIENhbGxlZCB0byBnZXQgbmV3IGRhdGEgd2hlbiBzdGF0ZSBjaGFuZ2VkXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRkZWZlciBwcm9taXNlIG9iamVjdFxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHN0YXRlIE5ldyBzdGF0ZVxuICAgICAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBhbGwgV2hldGhlciB0byBnZXQgYWxsIGRhdGFcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5nZXREYXRhID0gZnVuY3Rpb24oJGRlZmVyLCBzdGF0ZSwgYWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheSh0aGlzLmRhdGEpICYmIGFuZ3VsYXIuaXNPYmplY3Qoc3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Q6IGFsbCA/IHRoaXMuZGF0YSA6IHRoaXMuZGF0YS5zbGljZSgoc3RhdGUucGFnZSgpIC0gMSkgKiBzdGF0ZS5jb3VudCgpLCBzdGF0ZS5wYWdlKCkgKiBzdGF0ZS5jb3VudCgpKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkZGVmZXIucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjZ2V0QWxsRGF0YVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gQ2FsbGVkIHdoZW4gd2FudCB0byBsb2FkIGFsbCBkYXRhKHN1Y2ggYXMgZXhwb3J0IGNzdilcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSAkZGVmZXJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5nZXRBbGxEYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyICRkZWZlciA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgcHJvcHMuZ2V0RGF0YSgkZGVmZXIsIHNlbGYsIHRydWUpO1xuICAgICAgICAgICAgICAgICRkZWZlci5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9wcy4kc2NvcGUuJGFsbERhdGEgPSBkYXRhSGFuZGxlcnMuYWRqdXN0KGRhdGEsIHNlbGYsIHRydWUpLmxpc3Q7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRkZWZlcjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjcmVsb2FkXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBSZWxvYWQgdGFibGUgZGF0YVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciAkZGVmZXIgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlO1xuXG4gICAgICAgICAgICAgICAgLy8gc2V0IGxvYWRpbmcgdG8gdHJ1ZVxuICAgICAgICAgICAgICAgIHByb3BzLmxvYWRpbmcgPSBwcm9wcy4kc2NvcGUuJGxvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBhYm91dCB0byByZWxvYWQuJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoKHNlbGYuY2FjaGVUeXBlID0gc2VsZi5zaG91bGRVc2VDYWNoZShzdGF0ZSwgc2VsZi5jaGFuZ2VkU3RhdGVzKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGRlZmVyLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogKHNlbGYub3JpZ2luYWxEYXRhIHx8IHNlbGYuZGF0YSkuc2xpY2UoMCwgc3RhdGUuY291bnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHNlbGYub3JpZ2luYWxUb3RhbCB8fCBzdGF0ZS50b3RhbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9ICRkZWZlci5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BzLmdldERhdGEoJGRlZmVyLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9ICRkZWZlci5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZWREYXRhID0gZGF0YUhhbmRsZXJzLmFkanVzdChkYXRhLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3JpZ2luYWxEYXRhID0gaGFuZGxlZERhdGEubGlzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9yaWdpbmFsVG90YWwgPSBoYW5kbGVkRGF0YS50b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBkYXRhIGlzIGVtcHR5IG9yIG5vdCB2YWxpZC4nLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVkRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VsZi5jaGFuZ2VkU3RhdGVzID0ge307XG5cbiAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24oaGFuZGxlZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMubG9hZGluZyA9IHByb3BzLiRzY29wZS4kbG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBwcm9wcy4kc2NvcGUuJGNzdkdlbmVyYXRlZCA9IGZhbHNlOyAvLyBuZWVkIHJlZ2VuZXJhdGUgY3N2XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFuZGxlZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBmaWx0ZXIgbG9jYWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZpbHRlclR5cGUgPT09ICdsb2NhbCcgJiYgc3RhdGUuZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVkRGF0YSA9IGRhdGFIYW5kbGVycy5maWx0ZXIoaGFuZGxlZERhdGEsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHNvcnQgbG9jYWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNvcnRUeXBlID09PSAnbG9jYWwnICYmIHN0YXRlLnNvcnRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWREYXRhID0gZGF0YUhhbmRsZXJzLnNvcnQoaGFuZGxlZERhdGEsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBjdXJyZW50IHNjb3BlJywgcHJvcHMuJHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZGF0YSA9IHByb3BzLiRzY29wZS4kZGF0YSA9IGhhbmRsZWREYXRhLmxpc3Q7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyKGhhbmRsZWREYXRhLnRvdGFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b3RhbChoYW5kbGVkRGF0YS50b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuJHNjb3BlLnBhZ2VzID0gc2VsZi5nZW5lcmF0ZVBhZ2VzQXJyYXkoc2VsZi5wYWdlKCksIHNlbGYudG90YWwoKSwgc2VsZi5jb3VudCgpKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuJHNjb3BlLiRlbWl0KCdjeVRhYmxlQWZ0ZXJSZWxvYWREYXRhJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2dlbmVyYXRlUGFnZXNBcnJheVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gR2VuZXJhdGUgYXJyYXkgb2YgcGFnZXNcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGN1cnJlbnRQYWdlIHdoaWNoIHBhZ2UgbXVzdCBiZSBhY3RpdmVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gdG90YWxJdGVtcyBUb3RhbCBxdWFudGl0eSBvZiBpdGVtc1xuICAgICAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBwYWdlU2l6ZSBRdWFudGl0eSBvZiBpdGVtcyBvbiBwYWdlXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIHBhZ2VzXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVQYWdlc0FycmF5ID0gZnVuY3Rpb24oY3VycmVudFBhZ2UsIHRvdGFsSXRlbXMsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1heEJsb2NrcywgbWF4UGFnZSwgbWF4UGl2b3RQYWdlcywgbWluUGFnZSwgbnVtUGFnZXMsIHBhZ2VzO1xuICAgICAgICAgICAgICAgIHZhciB0bXBJdGVtO1xuICAgICAgICAgICAgICAgIG1heEJsb2NrcyA9IDExO1xuICAgICAgICAgICAgICAgIHBhZ2VzID0gW107XG4gICAgICAgICAgICAgICAgbnVtUGFnZXMgPSBNYXRoLmNlaWwodG90YWxJdGVtcyAvIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICBpZiAobnVtUGFnZXMgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3ByZXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBNYXRoLm1heCgxLCBjdXJyZW50UGFnZSAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSA+IDFcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ZpcnN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogY3VycmVudFBhZ2UgPiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBtYXhQaXZvdFBhZ2VzID0gTWF0aC5yb3VuZCgobWF4QmxvY2tzIC0gNSkgLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgbWluUGFnZSA9IE1hdGgubWF4KDIsIGN1cnJlbnRQYWdlIC0gbWF4UGl2b3RQYWdlcyk7XG4gICAgICAgICAgICAgICAgICAgIG1heFBhZ2UgPSBNYXRoLm1pbihudW1QYWdlcyAtIDEsIGN1cnJlbnRQYWdlICsgbWF4UGl2b3RQYWdlcyAqIDIgLSAoY3VycmVudFBhZ2UgLSBtaW5QYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgIG1pblBhZ2UgPSBNYXRoLm1heCgyLCBtaW5QYWdlIC0gKG1heFBpdm90UGFnZXMgKiAyIC0gKG1heFBhZ2UgLSBtaW5QYWdlKSkpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG1pblBhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDw9IG1heFBhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaSA9PT0gbWluUGFnZSAmJiBpICE9PSAyKSB8fCAoaSA9PT0gbWF4UGFnZSAmJiBpICE9PSBudW1QYWdlcyAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wSXRlbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21vcmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGN1cnJlbnRQYWdlICE9PSBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBJdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSAhPT0gaVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2godG1wSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcGFnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGFzdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG51bVBhZ2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSAhPT0gbnVtUGFnZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ25leHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBNYXRoLm1pbihudW1QYWdlcywgY3VycmVudFBhZ2UgKyAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogY3VycmVudFBhZ2UgPCBudW1QYWdlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZ2VzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNzb3J0aW5nXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiAnc29ydGluZycgcGFyYW1ldGVyIGlzIG5vdCBzZXQsIHJldHVybiBjdXJyZW50IHNvcnRpbmcuIE90aGVyd2lzZSBzZXQgY3VycmVudCBzb3J0aW5nLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3J0aW5nIE5ldyBzb3J0aW5nXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDdXJyZW50IHNvcnRpbmcgb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuc29ydGluZyA9IGZ1bmN0aW9uKHNvcnRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc29ydEFycmF5ID0ge307XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnJheVtzb3J0aW5nXSA9IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc29ydGluZyc6IHNvcnRBcnJheVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChzb3J0aW5nKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnc29ydGluZyc6IHNvcnRpbmdcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLnNvcnRpbmc7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI29yZGVyQnlcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIFJldHVybiBvYmplY3Qgb2Ygc29ydGluZyBwYXJhbWV0ZXJzIGZvciBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgbGlrZTogWyAnLW5hbWUnLCAnK2FnZScgXVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLm9yZGVyQnkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc29ydGluZyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGNvbHVtbiBpbiBzdGF0ZS5zb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRpbmcucHVzaCgoc3RhdGUuc29ydGluZ1tjb2x1bW5dID09PSAnYXNjJyA/ICcrJyA6ICctJykgKyBjb2x1bW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGluZztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSB3aWxsIGJlIHdhdGNoZWQgYnkgY29udHJvbGxlciB0byByZWxvYWRcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHRoaXMuJHN0YXRlID0ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IDEsXG4gICAgICAgICAgICAgICAgY291bnQ6IDUsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIGZpbHRlclR5cGU6ICdsb2NhbCcsIC8vICdyZW1vdGUnfCdsb2NhbCdcbiAgICAgICAgICAgICAgICBzb3J0aW5nOiBudWxsLFxuICAgICAgICAgICAgICAgIHNvcnRUeXBlOiAnbG9jYWwnIC8vICdyZW1vdGUnfCdsb2NhbCdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGFsdGhvdWdoIHNvbWUgbGlrZSB0b3RhbCBpcyBtb3JlIGFwcHJvcHJpYXRlIHRvIHBsYWNlIHRvIHN0YXRlLFxuICAgICAgICAgICAgLy8gaXQncyBwbGFjZWQgaGVyZSB0byBhdm9pZCBleHRyYSByZWFsb2RcbiAgICAgICAgICAgIHZhciBwcm9wcyA9IHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgICAgICAkc2NvcGU6IG51bGwsIC8vIHNldCBieSBjeVRhYmxlQ29udHJvbGxlclxuICAgICAgICAgICAgICAgIGRlZmF1bHRTb3J0OiAnZGVzYycsXG4gICAgICAgICAgICAgICAgZmlsdGVyRGVsYXk6IDc1MCxcbiAgICAgICAgICAgICAgICBjb3VudHM6IFs1LCAxMCwgMjUsIDUwXSxcbiAgICAgICAgICAgICAgICBzb3J0aW5nSW5kaWNhdG9yOiAnc3BhbicsXG4gICAgICAgICAgICAgICAgZ2V0RGF0YTogdGhpcy5nZXREYXRhXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnByb3BzKGluaXRQcm9wcyk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlKGluaXRTdGF0ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY3lUYWJsZVBhcmFtcztcbiAgICB9XSk7XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2Mgb2JqZWN0XG4gICAgICogQG5hbWUgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZS5jeVRhYmxlQ29udHJvbGxlclxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogRWFjaCB7QGxpbmsgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZSBjeVRhYmxlfSBkaXJlY3RpdmUgY3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgY3lUYWJsZUNvbnRyb2xsZXJgXG4gICAgICovXG4gICAgdmFyIGN5VGFibGVDb250cm9sbGVyID0gWyckc2NvcGUnLCAnY3lUYWJsZVBhcmFtcycsICckdGltZW91dCcsIGZ1bmN0aW9uKCRzY29wZSwgY3lUYWJsZVBhcmFtcywgJHRpbWVvdXQpIHtcbiAgICAgICAgdmFyIGRlbGF5RmlsdGVyID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRpbWVyID0gMDtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaywgbXMpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZXIpO1xuICAgICAgICAgICAgICAgIHRpbWVyID0gJHRpbWVvdXQoY2FsbGJhY2ssIG1zKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgncGFyYW1zJywgZnVuY3Rpb24obmV3UGFyYW1zLCBvbGRQYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKG5ld1BhcmFtcykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2ZpbHRlclR5cGUnLCBmdW5jdGlvbihmaWx0ZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2V0RmlsdGVyVHlwZShmaWx0ZXJUeXBlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnc29ydFR5cGUnLCBmdW5jdGlvbihzb3J0VHlwZSkge1xuICAgICAgICAgICAgICAgIGlmICghc29ydFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRTb3J0VHlwZShzb3J0VHlwZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3BhcmFtcy4kc3RhdGUnLCBmdW5jdGlvbihuZXdTdGF0ZSwgb2xkU3RhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChuZXdTdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWFuZ3VsYXIuZXF1YWxzKG5ld1N0YXRlLmZpbHRlciwgb2xkU3RhdGUgJiYgb2xkU3RhdGUuZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxheUZpbHRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMuJHN0YXRlLnBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgJHNjb3BlLnBhcmFtcy5wcm9wcygpLmZpbHRlckRlbGF5KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuc29ydEJ5ID0gZnVuY3Rpb24oY29sdW1uLCBldmVudCkge1xuICAgICAgICAgICAgdmFyIHBhcnNlZFNvcnRhYmxlID0gJHNjb3BlLnBhcnNlKGNvbHVtbi5zb3J0YWJsZSk7XG4gICAgICAgICAgICBpZiAoIXBhcnNlZFNvcnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGRlZmF1bHRTb3J0ID0gJHNjb3BlLnBhcmFtcy5wcm9wcygpLmRlZmF1bHRTb3J0O1xuICAgICAgICAgICAgdmFyIGludmVyc2VTb3J0ID0gKGRlZmF1bHRTb3J0ID09PSAnYXNjJyA/ICdkZXNjJyA6ICdhc2MnKTtcbiAgICAgICAgICAgIHZhciBzb3J0aW5nID0gJHNjb3BlLnBhcmFtcy5zb3J0aW5nKCkgJiYgJHNjb3BlLnBhcmFtcy5zb3J0aW5nKClbcGFyc2VkU29ydGFibGVdICYmICgkc2NvcGUucGFyYW1zLnNvcnRpbmcoKVtwYXJzZWRTb3J0YWJsZV0gPT09IGRlZmF1bHRTb3J0KTtcbiAgICAgICAgICAgIHZhciBzb3J0aW5nUGFyYW1zID0gKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgPyAkc2NvcGUucGFyYW1zLnNvcnRpbmcoKSA6IHt9O1xuICAgICAgICAgICAgc29ydGluZ1BhcmFtc1twYXJzZWRTb3J0YWJsZV0gPSAoc29ydGluZyA/IGludmVyc2VTb3J0IDogZGVmYXVsdFNvcnQpO1xuICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgc29ydGluZzogc29ydGluZ1BhcmFtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0U29ydFR5cGUodHlwZSkge1xuICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5zb3J0VHlwZSh0eXBlKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZXRGaWx0ZXJUeXBlKHR5cGUpIHtcbiAgICAgICAgICAgICRzY29wZS5wYXJhbXMuZmlsdGVyVHlwZSh0eXBlKTtcbiAgICAgICAgfVxuICAgIH1dO1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGRpcmVjdGl2ZVxuICAgICAqIEBuYW1lIGN5VGFibGUuZGlyZWN0aXZlOmN5VGFibGVcbiAgICAgKiBAcmVzdHJpY3QgRUFcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIERpcmVjdGl2ZSB0aGF0IGluc3RhbnRpYXRlcyB7QGxpbmsgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZS5jeVRhYmxlQ29udHJvbGxlciBjeVRhYmxlQ29udHJvbGxlcn0uXG4gICAgICovXG4gICAgYXBwLmRpcmVjdGl2ZSgnY3lUYWJsZScsIFsnJGNvbXBpbGUnLCAnJHEnLCAnJHBhcnNlJyxcbiAgICAgICAgZnVuY3Rpb24oJGNvbXBpbGUsICRxLCAkcGFyc2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAxMDAxLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGN5VGFibGVDb250cm9sbGVyLFxuICAgICAgICAgICAgICAgIGNvbXBpbGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93VHBsO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGN1c3RvbSBoZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gZWxlbWVudC5maW5kKCd0YWJsZScpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGhlYWQgPSB0YWJsZS5maW5kKCd0aGVhZCcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93ID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcigndHI6bm90KC5jeS10YWJsZS1ncm91cCknKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3cgfHwgIXJvd1swXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvdy5maW5kKCd0ZCcpLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBhbmd1bGFyLmVsZW1lbnQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwuYXR0cignaWdub3JlLWNlbGwnKSAmJiAndHJ1ZScgPT09IGVsLmF0dHIoJ2lnbm9yZS1jZWxsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRBdHRyVmFsdWUgPSBmdW5jdGlvbihhdHRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmF0dHIoJ2RhdGEtJyArIGF0dHIpIHx8IGVsLmF0dHIoYXR0cik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKGF0dHIsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHByID0gZ2V0QXR0clZhbHVlKGF0dHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwciA/ICRwYXJzZShleHByKShzY29wZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbnM6IGNvbHVtbnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBkZWZhdWx0VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJzZWRUaXRsZSA9IHBhcnNlZEF0dHJpYnV0ZSgndGl0bGUnLCAnICcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlclRlbXBsYXRlVVJMID0gcGFyc2VkQXR0cmlidXRlKCdoZWFkZXInLCBmYWxzZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gcGFyc2VkQXR0cmlidXRlKCdmaWx0ZXInLCBmYWxzZSkoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUZW1wbGF0ZVVSTCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlck5hbWUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIuJCRuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlci4kJG5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbHRlci4kJG5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyICYmIGZpbHRlci50ZW1wbGF0ZVVSTCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclRlbXBsYXRlVVJMID0gZmlsdGVyLnRlbXBsYXRlVVJMO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWx0ZXIudGVtcGxhdGVVUkw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aXRsZUV4cHIgPSBnZXRBdHRyVmFsdWUoJ3RpdGxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aXRsZUV4cHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5hdHRyKCdkYXRhLXRpdGxlLXRleHQnLCAne3snICsgdGl0bGVFeHByICsgJ319Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpKyssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHBhcnNlZFRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBwYXJzZWRBdHRyaWJ1dGUoJ3NvcnRhYmxlJywgZmFsc2UpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcyc6IHBhcnNlZEF0dHJpYnV0ZSgnaGVhZGVyLWNsYXNzJywgJycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZmlsdGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclRlbXBsYXRlVVJMOiBmaWx0ZXJUZW1wbGF0ZVVSTCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJOYW1lOiBmaWx0ZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlclRlbXBsYXRlVVJMOiBoZWFkZXJUZW1wbGF0ZVVSTCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJEYXRhOiAoZWwuYXR0cignZmlsdGVyLWRhdGEnKSA/IGVsLmF0dHIoJ2ZpbHRlci1kYXRhJykgOiBudWxsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93OiAoZWwuYXR0cignbmctaWYnKSA/IGZ1bmN0aW9uKHNjb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcGFyc2UoZWwuYXR0cignbmctaWYnKSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcm93VHBsID0gcm93Lm91dGVySFRNTCA/IHJvdy5vdXRlckhUTUwgOiBhbmd1bGFyLmVsZW1lbnQoJzxkaXY+PC9kaXY+JykuYXBwZW5kKHJvdy5jbG9uZSgpKS5odG1sKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gZWxlbWVudC5maW5kKCd0YWJsZScpLmFkZENsYXNzKCdjeS10YWJsZS1jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kY29sdW1ucyA9IGNvbHVtbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kcm93VHBsID0gJzx0YWJsZT48dGJvZHk+JyArIHJvd1RwbC5yZXBsYWNlKC9eKFxccyo8XFxzKnRyLispKFxcJGRhdGEpLywgJyQxJGFsbERhdGEnKSArICc8L3Rib2R5PjwvdGFibGU+JztcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ2ZpbHRlclR5cGUnLCBmdW5jdGlvbihmaWx0ZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmlsdGVyVHlwZSA9IGZpbHRlclR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdzb3J0VHlwZScsIGZ1bmN0aW9uKHNvcnRUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc29ydFR5cGUgPSBzb3J0VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLmN5VGFibGUsIChmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChwYXJhbXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFyYW1zTW9kZWwgPSAkcGFyc2UoYXR0cnMuY3lUYWJsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFyYW1zID0gcGFyYW1zO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wcm9wcygpLiRzY29wZSA9IHNjb3BlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFyc2UgPSBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHRleHQpID8gdGV4dChzY29wZSkgOiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cnMuc2hvd0ZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuJHdhdGNoKGF0dHJzLnNob3dGaWx0ZXIsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dGaWx0ZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChjb2x1bW5zLCBmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sdW1uLmZpbHRlckRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYgPSAkcGFyc2UoY29sdW1uLmZpbHRlckRhdGEpKHNjb3BlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW46IGNvbHVtblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGFuZ3VsYXIuaXNPYmplY3QoZGVmKSAmJiBhbmd1bGFyLmlzT2JqZWN0KGRlZi5wcm9taXNlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGdW5jdGlvbiAnICsgY29sdW1uLmZpbHRlckRhdGEgKyAnIG11c3QgYmUgaW5zdGFuY2Ugb2YgJHEuZGVmZXIoKScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29sdW1uLmZpbHRlckRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZi5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJy0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICcnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4uZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC5oYXNDbGFzcygnY3ktdGFibGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnRlbXBsYXRlcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiAoYXR0cnMudGVtcGxhdGVIZWFkZXIgPyBhdHRycy50ZW1wbGF0ZUhlYWRlciA6ICdjeS10YWJsZS9oZWFkZXIuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiAoYXR0cnMudGVtcGxhdGVQYWdpbmF0aW9uID8gYXR0cnMudGVtcGxhdGVQYWdpbmF0aW9uIDogJ2N5LXRhYmxlL3BhZ2VyLmh0bWwnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiAoYXR0cnMudGVtcGxhdGVPcGVyYXRpb24gPyBhdHRycy50ZW1wbGF0ZU9wZXJhdGlvbiA6ICdjeS10YWJsZS9vcGVyYXRpb24uaHRtbCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZGVyVGVtcGxhdGUgPSB0aGVhZC5sZW5ndGggPiAwID8gdGhlYWQgOiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKSkuYXR0cignbmctaW5jbHVkZScsICd0ZW1wbGF0ZXMuaGVhZGVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2luYXRpb25UZW1wbGF0ZSA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoJy5jeS10YWJsZS1wYWdpbmF0aW9uJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcGVyYXRpb25UZW1wbGF0ZSA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoJy5jeS10YWJsZS1vcGVyYXRpb24nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvblRlbXBsYXRlLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3ktdGFibGUtcGFnaW5hdGlvbic6ICdwYXJhbXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGVtcGxhdGUtdXJsJzogJ3RlbXBsYXRlcy5wYWdpbmF0aW9uJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvblRlbXBsYXRlLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3ktdGFibGUtb3BlcmF0aW9uJzogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZW1wbGF0ZS11cmwnOiAndGVtcGxhdGVzLm9wZXJhdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJ3RoZWFkJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnY3ktdGFibGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5wcmVwZW5kKGhlYWRlclRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZShoZWFkZXJUZW1wbGF0ZSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKHBhZ2luYXRpb25UZW1wbGF0ZSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKG9wZXJhdGlvblRlbXBsYXRlKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSk7XG5cblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBkaXJlY3RpdmVcbiAgICAgKiBAbmFtZSBjeVRhYmxlLmRpcmVjdGl2ZTpjeVRhYmxlUGFnaW5hdGlvblxuICAgICAqIEByZXN0cmljdCBBXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBEaXJlY3RpdmUgdGhhdCBoYW5kbGVzIHBhZ2luYXRpb25cbiAgICAgKi9cbiAgICBhcHAuZGlyZWN0aXZlKCdjeVRhYmxlUGFnaW5hdGlvbicsIFsnJGNvbXBpbGUnLFxuICAgICAgICBmdW5jdGlvbigkY29tcGlsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgICAgICdwYXJhbXMnOiAnPWN5VGFibGVQYWdpbmF0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgJ3RlbXBsYXRlVXJsJzogJz0nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXBsYWNlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwYXJhbXMnLCBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHBhcmFtcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJhbXMucHJvcHMoKS4kc2NvcGUuJG9uKCdjeVRhYmxlQWZ0ZXJSZWxvYWREYXRhJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFnZXMgPSBzY29wZS5wYXJhbXMuZ2VuZXJhdGVQYWdlc0FycmF5KHNjb3BlLnBhcmFtcy5wYWdlKCksIHNjb3BlLnBhcmFtcy50b3RhbCgpLCBzY29wZS5wYXJhbXMuY291bnQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd0ZW1wbGF0ZVVybCcsIGZ1bmN0aW9uKHRlbXBsYXRlVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh0ZW1wbGF0ZVVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmctaW5jbHVkZSc6ICd0ZW1wbGF0ZVVybCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQodGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUodGVtcGxhdGUpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pO1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGRpcmVjdGl2ZVxuICAgICAqIEBuYW1lIGN5VGFibGUuZGlyZWN0aXZlOmN5VGFibGVPcGVyYXRpb25cbiAgICAgKiBAcmVzdHJpY3QgQVxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogRGlyZWN0aXZlIHRoYXQgaGFuZGxlcyB0YWJsZSdzIHBhZ2UgY291bnQsIGZpbHRlciwgYW5kIHNvIG9uXG4gICAgICovXG4gICAgYXBwLmRpcmVjdGl2ZSgnY3lUYWJsZU9wZXJhdGlvbicsIFsnJGNvbXBpbGUnLFxuICAgICAgICBmdW5jdGlvbigkY29tcGlsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlcGxhY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmU6ICdeY3lUYWJsZScsXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghYXR0cnMudGVtcGxhdGVVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhdHRycy4kb2JzZXJ2ZSgndGVtcGxhdGVVcmwnLCBmdW5jdGlvbih0ZW1wbGF0ZVVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodGVtcGxhdGVVcmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICduZy1pbmNsdWRlJzogdGVtcGxhdGVVcmxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQodGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUodGVtcGxhdGUpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pO1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGRpcmVjdGl2ZVxuICAgICAqIEBuYW1lIGN5VGFibGUuZGlyZWN0aXZlOmN5VGFibGVDc3ZcbiAgICAgKiBAcmVzdHJpY3QgQVxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogRGlyZWN0aXZlIHRoYXQgaGVscHMgZXhwb3J0IHRhYmxlIHRvIGNzdlxuICAgICAqL1xuICAgIGFwcC5kaXJlY3RpdmUoJ2N5VGFibGVDc3YnLCBbJyRwYXJzZScsICckY29tcGlsZScsICckdGltZW91dCcsIGZ1bmN0aW9uICgkcGFyc2UsICRjb21waWxlLCAkdGltZW91dCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgIHZhciBjc3ZTdHIgPSAnJztcbiAgICAgICAgICAgICAgICB2YXIgYWxsRGF0YTtcbiAgICAgICAgICAgICAgICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG4gICAgICAgICAgICAgICAgLy8gYWN0dWFsIGRlbGltaXRlciBjaGFyYWN0ZXJzIGZvciBDU1YgZm9ybWF0XG4gICAgICAgICAgICAgICAgdmFyIGNvbERlbGltID0gJ1wiLFwiJztcbiAgICAgICAgICAgICAgICB2YXIgcm93RGVsaW0gPSAnXCJcXHJcXG5cIic7XG4gICAgICAgICAgICAgICAgLy8gVGVtcG9yYXJ5IGRlbGltaXRlciBjaGFyYWN0ZXJzIHVubGlrZWx5IHRvIGJlIHR5cGVkIGJ5IGtleWJvYXJkXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0byBhdm9pZCBhY2NpZGVudGFsbHkgc3BsaXR0aW5nIHRoZSBhY3R1YWwgY29udGVudHNcbiAgICAgICAgICAgICAgICB2YXIgdG1wQ29sRGVsaW0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDExKTsgLy8gdmVydGljYWwgdGFiIGNoYXJhY3RlclxuICAgICAgICAgICAgICAgIHZhciB0bXBSb3dEZWxpbSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMCk7IC8vIG51bGwgY2hhcmFjdGVyXG4gICAgICAgICAgICAgICAgdmFyIGNzdiA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvXlxcc1xccyovLCAnJykucmVwbGFjZSgvXFxzKlxccyQvLCAnJykgLy8gdHJpbSBzcGFjZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXCIvZywnXCJcIicpOyAvLyByZXBsYWNlIHF1b3RlcyB3aXRoIGRvdWJsZSBxdW90ZXNcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKCRldmVudCwgYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRjc3ZHZW5lcmF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjc3YuZ2VuZXJhdGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxsICYmIHNjb3BlLnBhcmFtcy5nZXRBbGxEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9ICRldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFyYW1zLmdldEFsbERhdGEoKS5wcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9ICRjb21waWxlKHNjb3BlLiRyb3dUcGwpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5wcmVwZW5kKGVsZW1lbnQuZmluZCgndGhlYWQnKS5jbG9uZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzdlN0ciA9IGdlbkNzdih0YWJsZS5maW5kKCd0cicpLCBmdW5jdGlvbihyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93ICYmIHJvdy5oYXNDbGFzcygnbmctdGFibGUtZmlsdGVycycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3YuZ2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzdlN0ciA9IGdlbkNzdihlbGVtZW50LmZpbmQoJ3RyJyksIGZ1bmN0aW9uKHJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93ICYmIHJvdy5oYXNDbGFzcygnbmctdGFibGUtZmlsdGVycycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzdi5nZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kY3N2R2VuZXJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2RhdGE6dGV4dC9jc3Y7Y2hhcnNldD11dGYtOCwnICsgZW5jb2RlVVJJQ29tcG9uZW50KGNzdlN0cik7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkOiBmdW5jdGlvbihmaWxlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWQoY3N2U3RyLCBmaWxlTmFtZSB8fCAnZG93bG9hZC5jc3YnLCAndGV4dC9jc3YnKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGluZzogZmFsc2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICRwYXJzZShhdHRycy5jeVRhYmxlQ3N2KS5hc3NpZ24oc2NvcGUuJHBhcmVudCwgY3N2KTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdlbkNzdihyb3dzLCBpZ25vcmVSb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3dzIHx8ICFyb3dzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVkUm93cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBzbGljZS5jYWxsKHJvd3MpLm1hcChmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3cgPSBhbmd1bGFyLmVsZW1lbnQocm93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xzID0gcm93LmZpbmQoJ3RoJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29scy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzID0gcm93LmZpbmQoJ3RkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWdub3JlUm93ICYmIGlnbm9yZVJvdyhyb3cpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZFJvd3MucHVzaChzbGljZS5jYWxsKGNvbHMpLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNzdi5zdHJpbmdpZnkoYW5ndWxhci5lbGVtZW50KGNvbCkudGV4dCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4odG1wQ29sRGVsaW0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnXCInICsgaGFuZGxlZFJvd3Muam9pbih0bXBSb3dEZWxpbSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCh0bXBSb3dEZWxpbSkuam9pbihyb3dEZWxpbSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCh0bXBDb2xEZWxpbSkuam9pbihjb2xEZWxpbSkgKyAnXCInO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIG1vc3QgY29tcGF0aWJsZSBjc3YgZ2VuZXJhdG9yL2Rvd25sb2FkIDxodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yOTMwNDQxND5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb3dubG9hZChjb250ZW50LCBmaWxlTmFtZSwgbWltZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgICAgICAgICAgICAgIG1pbWVUeXBlID0gbWltZVR5cGUgfHwgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci5tc1NhdmVCbG9iKSB7IC8vIElFMTAvMTEvRWRnZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tc1NhdmVCbG9iKG5ldyBCbG9iKFtjb250ZW50XSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG1pbWVUeXBlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSwgZmlsZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCdkb3dubG9hZCcgaW4gYSkgeyAvL2h0bWw1IEFbZG93bmxvYWRdXG4gICAgICAgICAgICAgICAgICAgICAgICBhLmhyZWYgPSAnZGF0YTonICsgbWltZVR5cGUgKyAnLCcgKyBlbmNvZGVVUklDb21wb25lbnQoY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBmaWxlTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDY2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvL2RvIGlmcmFtZSBkYXRhVVJMIGRvd25sb2FkIChvbGQgY2grRkYpOlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmLnNyYyA9ICdkYXRhOicgKyBtaW1lVHlwZSArICcsJyArIGVuY29kZVVSSUNvbXBvbmVudChjb250ZW50KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzMzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTtcblxuICAgIGFwcC5ydW4oWyckdGVtcGxhdGVDYWNoZScsIGZ1bmN0aW9uKCR0ZW1wbGF0ZUNhY2hlKSB7XG4gICAgICAgICR0ZW1wbGF0ZUNhY2hlLnB1dCgnY3ktdGFibGUvZmlsdGVycy90ZXh0Lmh0bWwnLCAnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgbmFtZT1cInt7Y29sdW1uLmZpbHRlck5hbWV9fVwiIG5nLW1vZGVsPVwicGFyYW1zLmZpbHRlcigpW25hbWVdXCIgbmctY2hhbmdlPVwicGFyYW1zLnRyYWNrQ2hhbmdlcyhcXCdmaWx0ZXJcXCcsIHBhcmFtcy5maWx0ZXIoKSlcIiBuZy1pZj1cImZpbHRlciA9PT0gXFwndGV4dFxcJyAmJiBwYXJhbXMuZmlsdGVyVHlwZSgpID09PSBcXCdsb2NhbFxcJ1wiIGNsYXNzPVwiaW5wdXQtZmlsdGVyIGZvcm0tY29udHJvbFwiIC8+Jyk7XG4gICAgICAgICR0ZW1wbGF0ZUNhY2hlLnB1dCgnY3ktdGFibGUvaGVhZGVyLmh0bWwnLCAnPHRyPjx0aCBuZy1yZXBlYXQ9XCIkY29sdW1uIGluICRjb2x1bW5zXCIgbmctaWY9XCIkY29sdW1uLnNob3codGhpcylcIiBkYXRhLXRpdGxlPVwie3skY29sdW1uLnRpdGxlKHRoaXMpfX1cIiBuZy1jbGFzcz1cInsgXFwnc29ydGFibGVcXCc6IHBhcnNlKCRjb2x1bW4uc29ydGFibGUpLCBcXCdzb3J0LWFzY1xcJzogcGFyYW1zLnNvcnRpbmcoKVtwYXJzZSgkY29sdW1uLnNvcnRhYmxlKV09PVxcJ2FzY1xcJywgXFwnc29ydC1kZXNjXFwnOiBwYXJhbXMuc29ydGluZygpW3BhcnNlKCRjb2x1bW4uc29ydGFibGUpXT09XFwnZGVzY1xcJyB9XCIgbmctY2xpY2s9XCJzb3J0QnkoJGNvbHVtbiwgJGV2ZW50KVwiIG5nLWluaXQ9XCJ0ZW1wbGF0ZT0kY29sdW1uLmhlYWRlclRlbXBsYXRlVVJMKHRoaXMpXCIgY2xhc3M9XCJoZWFkZXIge3skY29sdW1uLmNsYXNzKHRoaXMpfX1cIj48ZGl2IG5nLWlmPVwiIXRlbXBsYXRlXCIgbmctYmluZD1cIiRjb2x1bW4udGl0bGUodGhpcylcIj48L2Rpdj48ZGl2IG5nLWlmPVwidGVtcGxhdGVcIj48ZGl2IG5nLWluY2x1ZGU9XCJ0ZW1wbGF0ZVwiPjwvZGl2PjwvZGl2PjwvdGg+PC90cj48dHIgbmctc2hvdz1cInNob3dGaWx0ZXIgJiYgcGFyYW1zLmZpbHRlclR5cGUoKSA9PT0gXFwnbG9jYWxcXCdcIiBjbGFzcz1cImN5LXRhYmxlLWZpbHRlcnNcIj48dGggbmctcmVwZWF0PVwiJGNvbHVtbiBpbiAkY29sdW1uc1wiIGRhdGEtdGl0bGUtdGV4dD1cInt7JGNvbHVtbi50aXRsZSh0aGlzKX19XCIgbmctaWY9XCIkY29sdW1uLnNob3codGhpcylcIiBjbGFzcz1cImZpbHRlclwiPjxkaXYgbmctcmVwZWF0PVwiKG5hbWUsIGZpbHRlcikgaW4gJGNvbHVtbi5maWx0ZXJcIj48ZGl2IG5nLWlmPVwiJGNvbHVtbi5maWx0ZXJUZW1wbGF0ZVVSTFwiPjxkaXYgbmctaW5jbHVkZT1cIiRjb2x1bW4uZmlsdGVyVGVtcGxhdGVVUkxcIj48L2Rpdj48L2Rpdj48ZGl2IG5nLWlmPVwiISRjb2x1bW4uZmlsdGVyVGVtcGxhdGVVUkxcIj48ZGl2IG5nLWluY2x1ZGU9XCJcXCdjeS10YWJsZS9maWx0ZXJzL1xcJyArIGZpbHRlciArIFxcJy5odG1sXFwnXCI+PC9kaXY+PC9kaXY+PC9kaXY+PC90aD48L3RyPicpO1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoJ2N5LXRhYmxlL3BhZ2VyLmh0bWwnLCAnPHVsIGNsYXNzPVwiY3ktdGFibGUtcGFnZXIgcGFnZXIgbmctY2xvYWtcIj48bGkgbmctcmVwZWF0PVwicGFnZSBpbiBwYWdlc1wiIG5nLWNsYXNzPVwie1xcJ2Rpc2FibGVkXFwnOiAhcGFnZS5hY3RpdmUsIFxcJ3ByZXZpb3VzXFwnOiBwYWdlLnR5cGUgPT09IFxcJ3ByZXZcXCcsIFxcJ25leHRcXCc6IHBhZ2UudHlwZT09PVxcJ25leHRcXCd9XCI+PGEgbmctaWY9XCJwYWdlLnR5cGUgPT09IFxcJ3ByZXZcXCdcIiBuZy1jbGljaz1cInBhcmFtcy5wYWdlKHBhZ2UubnVtYmVyKVwiIGhyZWY9XCJcIj5QcmV2PC9hPjxhIG5nLWlmPVwicGFnZS50eXBlID09PSBcXCduZXh0XFwnXCIgbmctY2xpY2s9XCJwYXJhbXMucGFnZShwYWdlLm51bWJlcilcIiBocmVmPVwiXCI+TmV4dDwvYT48YSBuZy1pZj1cInBhZ2UudHlwZSA9PT0gXFwncGFnZVxcJyB8fCBwYWdlLnR5cGUgPT09IFxcJ2ZpcnN0XFwnIHx8IHBhZ2UudHlwZSA9PT0gXFwnbGFzdFxcJ1wiIG5nLWNsaWNrPVwicGFyYW1zLnBhZ2UocGFnZS5udW1iZXIpXCIgaHJlZj1cIlwiPnt7cGFnZS5udW1iZXJ9fTwvYT48YSBuZy1pZj1cInBhZ2UudHlwZSA9PT0gXFwnbW9yZVxcJ1wiIG5nLWNsaWNrPVwicGFyYW1zLnBhZ2UocGFnZS5udW1iZXIpXCIgaHJlZj1cIlwiPi4uLjwvYT48L2xpPjwvdWw+Jyk7XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIGFwcDtcbn0pKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==