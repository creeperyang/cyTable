"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["angular"],e);else{if("object"!=typeof exports)return e(t);module.exports=e(t)}}(angular||null,function(t){var e=t.module("cyTable",[]);e.config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|data):/)}]),e.factory("cyTableParams",["$q","$log","$filter",function(e,a,n){var r=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},i=function(t){return Object.keys?Object.keys(t).length:function(t){var e,a=0;for(e in t)a++;return a}(t)},l={adjust:function(e,a,n){return t.isArray(e)?{list:n?e:e.slice(0,a.count()),total:e.length}:t.isObject(e)?(e.list=n?e.list:e.list.slice(0,a.count()),e):(a.data=[],a.total(0),!1)},filter:function(t,e){var a=e.filter(),r=a?n("filter")(t.list,a):void 0;return r?{list:r,total:r.length===e.$state.count?e.originalTotal:r.length}:t},sort:function(t,e){var a=e.sorting(),r=a?n("orderBy")(t.list,e.orderBy()):void 0;return r?{list:r,total:t.total}:t}},o=function(n,o){var s=this,c=function(){u.debugMode&&a.debug&&a.debug.apply(this,arguments)};this.data=[],this.originalData=void 0,this.originalTotal=void 0,this.cacheType=void 0,this.changedStates={},this.state=function(e){if(t.isDefined(e)){for(var a in e){var n=e[a];s.trackChanges(a,n,p[a]),p[a]=r(e[a])?parseFloat(e[a]):e[a]}return c("cyTable: set state",p),this}return p},this.props=function(e){return t.isDefined(e)?(u=t.extend(u,e),c("cyTable: set props",u),this):u},this.page=function(e){return t.isDefined(e)?this.state({page:e}):p.page},this.filter=function(e){return t.isDefined(e)?this.state({filter:e}):p.filter},this.count=function(e){return t.isDefined(e)?this.state({count:e,page:1}):p.count},this.sortType=function(e){return t.isDefined(e)?this.state({sortType:e,page:1}):p.sortType},this.filterType=function(e){return t.isDefined(e)?this.state({filterType:e,page:1}):p.filterType},this.total=function(e){return t.isDefined(e)?this.props({total:e}):u.total},this.trackChanges=function(t,e,a){s.changedStates[t]={name:t,prev:a,cur:e}},this.shouldUseCache=function(t,e){var a=i(e);if(1===a){if(e.sorting)return"local"===s.$state.sortType?"sort-local":!1;if(e.filter)return"local"===t.filterType?"filter-local":!1}else if(2===a&&e.page&&e.count)return e.page.cur===e.page.prev&&e.count.cur<=e.count.prev?"count-local":!1;return!1},this.query=function(e){var a,n,r={};if(t.isArray(e))for(a in e)a in p&&(r[a]=p[a]);else if(t.isFunction(e))for(a in p)"filterType"!==a&&"sortType"!==a&&(n=e(a,p[a]),n===!0?r[a]=p[a]:t.isArray(n)&&(r[n[0]]=n[1]));else for(a in p)"filterType"!==a&&"sortType"!==a&&(r[a]=p[a]);return r},this.getData=function(e,a,n){e.resolve(t.isArray(this.data)&&t.isObject(a)?{list:n?this.data:this.data.slice((a.page()-1)*a.count(),a.page()*a.count())}:{list:[],total:0})},this.getAllData=function(){var t=e.defer();return u.getData(t,s,!0),t.promise.then(function(t){u.$scope.$allData=l.adjust(t,s,!0).list}),t},this.reload=function(){var t,a=e.defer();u.loading=u.$scope.$loading=!0,c("cyTable: about to reload."),(s.cacheType=s.shouldUseCache(p,s.changedStates))?(a.resolve({list:(s.originalData||s.data).slice(0,p.count),total:s.originalTotal||p.total}),t=a.promise):(u.getData(a,s),t=a.promise.then(function(t){var e=l.adjust(t,s);return e?(s.originalData=e.list,s.originalTotal=e.total):c("cyTable: data is empty or not valid.",t),e})),s.changedStates={},t.then(function(t){u.loading=u.$scope.$loading=!1,u.$scope.$csvGenerated=!1,t&&("local"===p.filterType&&p.filter&&(t=l.filter(t,s)),"local"===p.sortType&&p.sorting&&(t=l.sort(t,s)),c("cyTable: current scope",u.$scope),s.data=u.$scope.$data=t.list,r(t.total)&&s.total(t.total),u.$scope.pages=s.generatePagesArray(s.page(),s.total(),s.count()),u.$scope.$emit("cyTableAfterReloadData"))})},this.generatePagesArray=function(t,e,a){var n,r,i,l,o,s,c;if(n=11,s=[],o=Math.ceil(e/a),o>1){s.push({type:"prev",number:Math.max(1,t-1),active:t>1}),s.push({type:"first",number:1,active:t>1}),i=Math.round((n-5)/2),l=Math.max(2,t-i),r=Math.min(o-1,t+2*i-(t-l)),l=Math.max(2,l-(2*i-(r-l)));for(var p=l;r>=p;)c=p===l&&2!==p||p===r&&p!==o-1?{type:"more",active:t!==p,number:p}:{type:"page",number:p,active:t!==p},s.push(c),p++;s.push({type:"last",number:o,active:t!==o}),s.push({type:"next",number:Math.min(o,t+1),active:o>t})}return s},this.sorting=function(e){if(2===arguments.length){var a={};return a[e]=arguments[1],this.state({sorting:a}),this}return t.isDefined(e)?this.state({sorting:e}):p.sorting},this.orderBy=function(){var t=[];for(var e in p.sorting)t.push(("asc"===p.sorting[e]?"+":"-")+e);return t};var p=this.$state={page:1,count:5,filter:null,filterType:"local",sorting:null,sortType:"local"},u={loading:!1,total:0,$scope:null,defaultSort:"desc",filterDelay:750,counts:[5,10,25,50],sortingIndicator:"span",getData:this.getData};return this.props(o),this.state(n),this};return o}]);var a=["$scope","cyTableParams","$timeout",function(e,a,n){function r(t){e.params.sortType(t)}function i(t){e.params.filterType(t)}var l=function(){var t=0;return function(e,a){n.cancel(t),t=n(e,a)}}();e.$watch("params",function(a,n){t.isUndefined(a)||(e.$watch("filterType",function(t){t&&i(t)}),e.$watch("sortType",function(t){t&&r(t)}),e.$watch("params.$state",function(a,n){t.isUndefined(a)||(t.equals(a.filter,n&&n.filter)?e.params.reload():l(function(){e.params.$state.page=1,e.params.reload()},e.params.props().filterDelay))},!0))}),e.sortBy=function(t,a){var n=e.parse(t.sortable);if(n){var r=e.params.props().defaultSort,i="asc"===r?"desc":"asc",l=e.params.sorting()&&e.params.sorting()[n]&&e.params.sorting()[n]===r,o=a.ctrlKey||a.metaKey?e.params.sorting():{};o[n]=l?i:r,e.params.state({sorting:o})}}}];return e.directive("cyTable",["$compile","$q","$parse",function(e,n,r){return{restrict:"A",priority:1001,scope:!0,controller:a,compile:function(a){var n,i=[],l=0,o=a.find("table"),s=o.find("thead"),c=t.element(document.querySelector("tr:not(.cy-table-group)"));return c?(t.forEach(c.find("td"),function(e){var a=t.element(e);if(!a.attr("ignore-cell")||"true"!==a.attr("ignore-cell")){var n=function(t,e){return function(n){return r(a.attr("data-"+t)||a.attr(t))(n,{$columns:i})||e}},o=n("title"," "),s=n("header",!1),c=n("filter",!1)(),p=!1,u=!1;c&&c.$$name&&(u=c.$$name,delete c.$$name),c&&c.templateURL&&(p=c.templateURL,delete c.templateURL),a.attr("data-title-text",o()),i.push({id:l++,title:o,sortable:n("sortable",!1),"class":a.attr("data-header-class")||a.attr("header-class"),filter:c,filterTemplateURL:p,filterName:u,headerTemplateURL:s,filterData:a.attr("filter-data")?a.attr("filter-data"):null,show:a.attr("ng-show")?function(t){return r(a.attr("ng-show"))(t)}:function(){return!0}})}}),n=c.outerHTML?c.outerHTML:t.element("<div></div>").append(c.clone()).html(),function(a,l,o,c){var p=l.find("table").addClass("cy-table-content");if(a.$columns=i,a.$rowTpl="<table><tbody>"+n.replace(/^(\s*<\s*tr.+)(\$data)/,"$1$allData")+"</tbody></table>",o.$observe("filterType",function(t){a.filterType=t}),o.$observe("sortType",function(t){a.sortType=t}),a.$watch(o.tableParams,function(e){t.isUndefined(e)||(a.paramsModel=r(o.tableParams),a.params=e,e.props().$scope=a)},!0),a.parse=function(e){return t.isDefined(e)?e(a):""},o.showFilter&&a.$parent.$watch(o.showFilter,function(t){a.showFilter=t}),t.forEach(i,function(e){var n;if(e.filterData){if(n=r(e.filterData)(a,{$column:e}),!t.isObject(n)||!t.isObject(n.promise))throw new Error("Function "+e.filterData+" must be instance of $q.defer()");return delete e.filterData,n.promise.then(function(a){t.isArray(a)||(a=[]),a.unshift({title:"-",id:""}),e.data=a})}}),!l.hasClass("cy-table")){a.templates={header:o.templateHeader?o.templateHeader:"cy-table/header.html",pagination:o.templatePagination?o.templatePagination:"cy-table/pager.html",operation:o.templateOperation?o.templateOperation:"cy-table/operation.html"};var u=s.length>0?s:t.element(document.createElement("thead")).attr("ng-include","templates.header"),f=t.element(l[0].querySelector(".cy-table-pagination")),d=t.element(l[0].querySelector(".cy-table-operation"));f.attr({"cy-table-pagination":"params","template-url":"templates.pagination"}),d.attr({"cy-table-operation":"","template-url":"templates.operation"}),l.find("thead").remove(),l.addClass("cy-table"),p.prepend(u),e(u)(a),e(f)(a),e(d)(a)}}):void 0}}}]),e.directive("cyTablePagination",["$compile",function(e){return{restrict:"A",scope:{params:"=cyTablePagination",templateUrl:"="},replace:!1,link:function(a,n,r){a.$watch("params",function(e){t.isUndefined(e)||a.params.props().$scope.$on("cyTableAfterReloadData",function(){a.pages=a.params.generatePagesArray(a.params.page(),a.params.total(),a.params.count())},!0)}),a.$watch("templateUrl",function(r){if(!t.isUndefined(r)){var i=t.element(document.createElement("div"));i.attr({"ng-include":"templateUrl"}),n.append(i),e(i)(a)}})}}}]),e.directive("cyTableOperation",["$compile",function(e){return{restrict:"A",scope:!0,replace:!1,require:"^cyTable",link:function(a,n,r){r.templateUrl&&r.$observe("templateUrl",function(r){if(!t.isUndefined(r)){var i=t.element(document.createElement("div"));i.attr({"ng-include":r}),n.append(i),e(i)(a)}})}}}]),e.directive("cyTableCsv",["$parse","$compile","$timeout",function(e,a,n){return{restrict:"A",scope:!1,link:function(r,i,l){function o(e,a){if(!e||!e.length)return"";var n=[];return p.call(e).map(function(e){e=t.element(e);var r=e.find("th");0===r.length&&(r=e.find("td")),a&&a(e)||n.push(p.call(r).map(function(e){return g.stringify(t.element(e).text())}).join(d))}),'"'+n.join(m).split(m).join(f).split(d).join(u)+'"'}function s(t,e,a){var n=document.createElement("a");if(a=a||"application/octet-stream",navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([t],{type:a}),e);if("download"in n)return n.href="data:"+a+","+encodeURIComponent(t),n.setAttribute("download",e),document.body.appendChild(n),setTimeout(function(){n.click(),document.body.removeChild(n)},66),!0;var r=document.createElement("iframe");return document.body.appendChild(r),r.src="data:"+a+","+encodeURIComponent(t),setTimeout(function(){document.body.removeChild(r)},333),!0}var c="",p=Array.prototype.slice,u='","',f='"\r\n"',d=String.fromCharCode(11),m=String.fromCharCode(0),g={stringify:function(t){return t.replace(/^\s\s*/,"").replace(/\s*\s$/,"").replace(/"/g,'""')},generate:function(t,e){var l;r.$csvGenerated||(g.generating=!0,e&&r.params.getAllData?(t.preventDefault(),t.stopPropagation(),l=t.target,r.params.getAllData().promise.then(function(){var t=a(r.$rowTpl)(r);n(function(){t.prepend(i.find("thead").clone()),c=o(t.find("tr"),function(t){return t&&t.hasClass("ng-table-filters")}),g.generating=!1,n(function(){l.click()})})})):(c=o(i.find("tr"),function(t){return t&&t.hasClass("ng-table-filters")}),g.generating=!1),r.$csvGenerated=!0)},link:function(){return"data:text/csv;charset=utf-8,"+encodeURIComponent(c)},download:function(t){s(c,t||"dowload.csv","text/csv")},generating:!1};e(l.cyTableCsv).assign(r.$parent,g)}}}]),e.run(["$templateCache",function(t){t.put("cy-table/filters/text.html",'<input type="text" name="{{column.filterName}}" ng-model="params.filter()[name]" ng-change="params.trackChanges(\'filter\', params.filter())" ng-if="filter === \'text\' && params.filterType() === \'local\'" class="input-filter form-control" />'),t.put("cy-table/header.html",'<tr> <th ng-repeat="column in $columns" ng-class="{ \'sortable\': parse(column.sortable), \'sort-asc\': params.sorting()[parse(column.sortable)]==\'asc\', \'sort-desc\': params.sorting()[parse(column.sortable)]==\'desc\' }" ng-click="sortBy(column, $event)" ng-show="column.show(this)" ng-init="template=column.headerTemplateURL(this)" class="header {{column.class}}"> <div ng-if="!template" ng-show="!template" ng-bind="parse(column.title)"></div> <div ng-if="template" ng-show="template"><div ng-include="template"></div></div> </th> </tr> <tr ng-show="showFilter && params.filterType() === \'local\'" class="cy-table-filters"> <th ng-repeat="column in $columns" ng-show="column.show(this)" class="filter"> <div ng-repeat="(name, filter) in column.filter"> <div ng-if="column.filterTemplateURL" ng-show="column.filterTemplateURL"> <div ng-include="column.filterTemplateURL"></div> </div> <div ng-if="!column.filterTemplateURL" ng-show="!column.filterTemplateURL"> <div ng-include="\'cy-table/filters/\' + filter + \'.html\'"></div> </div> </div> </th> </tr>'),t.put("cy-table/pager.html",'<ul class="cy-table-pager pager ng-cloak"><li ng-repeat="page in pages" ng-class="{\'disabled\': !page.active, \'previous\': page.type === \'prev\', \'next\': page.type===\'next\'}"><a ng-if="page.type === \'prev\'" ng-click="params.page(page.number)" href="">Prev</a><a ng-if="page.type === \'next\'" ng-click="params.page(page.number)" href="">Next</a><a ng-if="page.type === \'page\' || page.type === \'first\' || page.type === \'last\'" ng-click="params.page(page.number)" href="">{{page.number}}</a><a ng-if="page.type === \'more\'" ng-click="params.page(page.number)" href="">...</a></li></ul>')}]),e});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN5LXRhYmxlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsImFwcCIsImNvbmZpZyIsIiRjb21waWxlUHJvdmlkZXIiLCJhSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCIsIiRxIiwiJGxvZyIsIiRmaWx0ZXIiLCJpc051bWJlciIsIm4iLCJpc05hTiIsInBhcnNlRmxvYXQiLCJpc0Zpbml0ZSIsImdldGtleXNMZW5ndGgiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwicCIsImkiLCJkYXRhSGFuZGxlcnMiLCJhZGp1c3QiLCJkYXRhIiwidGFibGVQYXJhbXMiLCJub3RDdXREYXRhIiwiaXNBcnJheSIsImxpc3QiLCJzbGljZSIsImNvdW50IiwidG90YWwiLCJpc09iamVjdCIsImZpbHRlciIsInVuZGVmaW5lZCIsIiRzdGF0ZSIsIm9yaWdpbmFsVG90YWwiLCJzb3J0Iiwic29ydGluZyIsIm9yZGVyQnkiLCJjeVRhYmxlUGFyYW1zIiwiaW5pdFN0YXRlIiwiaW5pdFByb3BzIiwic2VsZiIsInRoaXMiLCJsb2ciLCJwcm9wcyIsImRlYnVnTW9kZSIsImRlYnVnIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJvcmlnaW5hbERhdGEiLCJjYWNoZVR5cGUiLCJjaGFuZ2VkU3RhdGVzIiwic3RhdGUiLCJuZXdTdGF0ZSIsImlzRGVmaW5lZCIsImtleSIsInZhbHVlIiwidHJhY2tDaGFuZ2VzIiwibmV3UHJvcHMiLCJleHRlbmQiLCJwYWdlIiwic29ydFR5cGUiLCJmaWx0ZXJUeXBlIiwibmV3VmFsdWUiLCJvbGRWYWx1ZSIsIm5hbWUiLCJwcmV2IiwiY3VyIiwic2hvdWxkVXNlQ2FjaGUiLCJxdWVyeSIsInRtcCIsInJldCIsImlzRnVuY3Rpb24iLCJnZXREYXRhIiwiJGRlZmVyIiwiYWxsIiwicmVzb2x2ZSIsImdldEFsbERhdGEiLCJkZWZlciIsInByb21pc2UiLCJ0aGVuIiwiJHNjb3BlIiwiJGFsbERhdGEiLCJyZWxvYWQiLCJsb2FkaW5nIiwiJGxvYWRpbmciLCJoYW5kbGVkRGF0YSIsIiRjc3ZHZW5lcmF0ZWQiLCIkZGF0YSIsInBhZ2VzIiwiZ2VuZXJhdGVQYWdlc0FycmF5IiwiJGVtaXQiLCJjdXJyZW50UGFnZSIsInRvdGFsSXRlbXMiLCJwYWdlU2l6ZSIsIm1heEJsb2NrcyIsIm1heFBhZ2UiLCJtYXhQaXZvdFBhZ2VzIiwibWluUGFnZSIsIm51bVBhZ2VzIiwidG1wSXRlbSIsIk1hdGgiLCJjZWlsIiwicHVzaCIsInR5cGUiLCJudW1iZXIiLCJtYXgiLCJhY3RpdmUiLCJyb3VuZCIsIm1pbiIsInNvcnRBcnJheSIsImNvbHVtbiIsImRlZmF1bHRTb3J0IiwiZmlsdGVyRGVsYXkiLCJjb3VudHMiLCJzb3J0aW5nSW5kaWNhdG9yIiwiY3lUYWJsZUNvbnRyb2xsZXIiLCIkdGltZW91dCIsInNldFNvcnRUeXBlIiwicGFyYW1zIiwic2V0RmlsdGVyVHlwZSIsImRlbGF5RmlsdGVyIiwidGltZXIiLCJjYWxsYmFjayIsIm1zIiwiY2FuY2VsIiwiJHdhdGNoIiwibmV3UGFyYW1zIiwib2xkUGFyYW1zIiwiaXNVbmRlZmluZWQiLCJvbGRTdGF0ZSIsImVxdWFscyIsInNvcnRCeSIsImV2ZW50IiwicGFyc2VkU29ydGFibGUiLCJwYXJzZSIsInNvcnRhYmxlIiwiaW52ZXJzZVNvcnQiLCJzb3J0aW5nUGFyYW1zIiwiY3RybEtleSIsIm1ldGFLZXkiLCJkaXJlY3RpdmUiLCIkY29tcGlsZSIsIiRwYXJzZSIsInJlc3RyaWN0IiwicHJpb3JpdHkiLCJzY29wZSIsImNvbnRyb2xsZXIiLCJjb21waWxlIiwiZWxlbWVudCIsInJvd1RwbCIsImNvbHVtbnMiLCJ0YWJsZSIsImZpbmQiLCJ0aGVhZCIsInJvdyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImZvckVhY2giLCJpdGVtIiwiZWwiLCJhdHRyIiwicGFyc2VkQXR0cmlidXRlIiwiZGVmYXVsdFZhbHVlIiwiJGNvbHVtbnMiLCJwYXJzZWRUaXRsZSIsImhlYWRlclRlbXBsYXRlVVJMIiwiZmlsdGVyVGVtcGxhdGVVUkwiLCJmaWx0ZXJOYW1lIiwiJCRuYW1lIiwidGVtcGxhdGVVUkwiLCJpZCIsInRpdGxlIiwiY2xhc3MiLCJmaWx0ZXJEYXRhIiwic2hvdyIsIm91dGVySFRNTCIsImFwcGVuZCIsImNsb25lIiwiaHRtbCIsImF0dHJzIiwiY3RybCIsImFkZENsYXNzIiwiJHJvd1RwbCIsInJlcGxhY2UiLCIkb2JzZXJ2ZSIsInBhcmFtc01vZGVsIiwidGV4dCIsInNob3dGaWx0ZXIiLCIkcGFyZW50IiwiZGVmIiwiJGNvbHVtbiIsIkVycm9yIiwidW5zaGlmdCIsImhhc0NsYXNzIiwidGVtcGxhdGVzIiwiaGVhZGVyIiwidGVtcGxhdGVIZWFkZXIiLCJwYWdpbmF0aW9uIiwidGVtcGxhdGVQYWdpbmF0aW9uIiwib3BlcmF0aW9uIiwidGVtcGxhdGVPcGVyYXRpb24iLCJoZWFkZXJUZW1wbGF0ZSIsImNyZWF0ZUVsZW1lbnQiLCJwYWdpbmF0aW9uVGVtcGxhdGUiLCJvcGVyYXRpb25UZW1wbGF0ZSIsImN5LXRhYmxlLXBhZ2luYXRpb24iLCJ0ZW1wbGF0ZS11cmwiLCJjeS10YWJsZS1vcGVyYXRpb24iLCJyZW1vdmUiLCJwcmVwZW5kIiwidGVtcGxhdGVVcmwiLCJsaW5rIiwiJG9uIiwidGVtcGxhdGUiLCJuZy1pbmNsdWRlIiwicmVxdWlyZSIsImdlbkNzdiIsInJvd3MiLCJpZ25vcmVSb3ciLCJoYW5kbGVkUm93cyIsImNhbGwiLCJtYXAiLCJjb2xzIiwiY29sIiwiY3N2Iiwic3RyaW5naWZ5Iiwiam9pbiIsInRtcENvbERlbGltIiwidG1wUm93RGVsaW0iLCJzcGxpdCIsInJvd0RlbGltIiwiY29sRGVsaW0iLCJkb3dubG9hZCIsImNvbnRlbnQiLCJmaWxlTmFtZSIsIm1pbWVUeXBlIiwiYSIsIm5hdmlnYXRvciIsIm1zU2F2ZUJsb2IiLCJCbG9iIiwiaHJlZiIsImVuY29kZVVSSUNvbXBvbmVudCIsInNldEF0dHJpYnV0ZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInNldFRpbWVvdXQiLCJjbGljayIsInJlbW92ZUNoaWxkIiwiZiIsInNyYyIsImNzdlN0ciIsIkFycmF5IiwicHJvdG90eXBlIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwic3RyIiwiZ2VuZXJhdGUiLCIkZXZlbnQiLCJ0YXJnZXQiLCJnZW5lcmF0aW5nIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJjeVRhYmxlQ3N2IiwiYXNzaWduIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUUsU0FBU0EsRUFBU0MsR0FFaEIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN2Q0QsUUFBUSxXQUFZRCxPQUNqQixDQUFBLEdBQXVCLGdCQUFaRyxTQUdkLE1BQU9ILEdBQVFELEVBRmZLLFFBQU9ELFFBQVVILEVBQVFELEtBSy9CQSxTQUFXLEtBQU0sU0FBU0EsR0FFeEIsR0FBSU0sR0FBTU4sRUFBUUssT0FBTyxhQU96QkMsR0FBSUMsUUFBUSxtQkFBb0IsU0FBU0MsR0FDckNBLEVBQWlCQywyQkFBMkIsNkNBUWhESCxFQUFJTCxRQUFRLGlCQUFrQixLQUFNLE9BQVEsVUFBVyxTQUFTUyxFQUFJQyxFQUFNQyxHQUN0RSxHQUFJQyxHQUFXLFNBQVNDLEdBQ3BCLE9BQVFDLE1BQU1DLFdBQVdGLEtBQU9HLFNBQVNILElBRXpDSSxFQUFnQixTQUFTQyxHQUN6QixNQUFPQyxRQUFPQyxLQUFPRCxPQUFPQyxLQUFLRixHQUFLRyxPQUFTLFNBQVVILEdBQ3JELEdBQVdJLEdBQVBDLEVBQUksQ0FDUixLQUFLRCxJQUFLSixHQUNOSyxHQUVKLE9BQU9BLElBQ1JMLElBSUhNLEdBQ0FDLE9BQVEsU0FBb0JDLEVBQU1DLEVBQWFDLEdBQzNDLE1BQUk3QixHQUFROEIsUUFBUUgsSUFFWkksS0FBTUYsRUFBYUYsRUFBT0EsRUFBS0ssTUFBTSxFQUFHSixFQUFZSyxTQUNwREMsTUFBT1AsRUFBS0wsUUFFVHRC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QUFTQyxHQUNoQ0EsRUFBZUMsSUFBSSw2QkFBOEIsdVBBQ2pERCxFQUFlQyxJQUFJLHVCQUF3Qix1aUNBQzNDRCxFQUFlQyxJQUFJLHNCQUF1Qiw4bEJBR3ZDMVEiLCJmaWxlIjoiY3ktdGFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbjsoZnVuY3Rpb24oYW5ndWxhciwgZmFjdG9yeSkge1xuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoWydhbmd1bGFyJ10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShhbmd1bGFyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFjdG9yeShhbmd1bGFyKTtcbiAgICB9XG5cbn0oYW5ndWxhciB8fCBudWxsLCBmdW5jdGlvbihhbmd1bGFyKSB7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2N5VGFibGUnLCBbXSk7XG5cbiAgICAvKlxuICAgICAqIGF0dGVuc2lvbjogQW5ndWxhckpTIDEuMy54LCAkJFNhbml0aXplVXJpUHJvdmlkZXIgc2V0IGFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0ID0gL15cXHMqKGh0dHBzP3xmdHB8bWFpbHRvfHRlbHxmaWxlKTovXG4gICAgICogYW5kIGV4cG9ydCBjc3YsIGhyZWYgd291bGQgYmUgbGlrZSBgZGF0YTp0ZXh0L2Nzdi4uLmBcbiAgICAgKiBpZiBkb250IGNoYW5nZSB0aGlzLCBhbmd1bGFyIHdvdWxkIGFkZCBgdW5zYWZlOmAgcHJlZml4LCBzbyBtb2RpZnkgYUhyZWZTYW5pdGl6YXRpb25XaGl0ZWxpc3RcbiAgICAqL1xuICAgIGFwcC5jb25maWcoWyckY29tcGlsZVByb3ZpZGVyJywgZnVuY3Rpb24oJGNvbXBpbGVQcm92aWRlcikge1xuICAgICAgICAkY29tcGlsZVByb3ZpZGVyLmFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0KC9eXFxzKihodHRwcz98ZnRwfG1haWx0b3x0ZWx8ZmlsZXxkYXRhKTovKTtcbiAgICB9XSk7XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2Mgc2VydmljZVxuICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICogQGRlc2NyaXB0aW9uIFBhcmFtZXRlcnMgbWFuYWdlciBmb3IgY3lUYWJsZVxuICAgICAqL1xuICAgIGFwcC5mYWN0b3J5KCdjeVRhYmxlUGFyYW1zJywgWyckcScsICckbG9nJywgJyRmaWx0ZXInLCBmdW5jdGlvbigkcSwgJGxvZywgJGZpbHRlcikge1xuICAgICAgICB2YXIgaXNOdW1iZXIgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgICAgICByZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobikpICYmIGlzRmluaXRlKG4pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgZ2V0a2V5c0xlbmd0aCA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzID8gT2JqZWN0LmtleXMob2JqKS5sZW5ndGggOiAoZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAwLCBwO1xuICAgICAgICAgICAgICAgIGZvciAocCBpbiBvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH0pKG9iaik7XG4gICAgICAgIH07XG4gICAgICAgIC8vIGRhdGEgaGFuZGxlcnMgdG8gaGFuZGxlIGRhdGEgZ2V0IGZyb20gI2dldERhdGFcbiAgICAgICAgLy8gaW5uZXIgdXNhZ2Ugbm93XG4gICAgICAgIHZhciBkYXRhSGFuZGxlcnMgPSB7XG4gICAgICAgICAgICBhZGp1c3Q6IGZ1bmN0aW9uIGFkanVzdERhdGEoZGF0YSwgdGFibGVQYXJhbXMsIG5vdEN1dERhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiBub3RDdXREYXRhID8gZGF0YSA6IGRhdGEuc2xpY2UoMCwgdGFibGVQYXJhbXMuY291bnQoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZGF0YS5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNPYmplY3QoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5saXN0ID0gbm90Q3V0RGF0YSA/IGRhdGEubGlzdCA6IGRhdGEubGlzdC5zbGljZSgwLCB0YWJsZVBhcmFtcy5jb3VudCgpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFibGVQYXJhbXMuZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB0YWJsZVBhcmFtcy50b3RhbCgwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlckRhdGEoZGF0YSwgdGFibGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyID0gdGFibGVQYXJhbXMuZmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBmaWx0ZXIgPyAkZmlsdGVyKCdmaWx0ZXInKShkYXRhLmxpc3QsIGZpbHRlcikgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3QgPyB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3Q6IGxpc3QsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiBsaXN0Lmxlbmd0aCA9PT0gdGFibGVQYXJhbXMuJHN0YXRlLmNvdW50ID8gdGFibGVQYXJhbXMub3JpZ2luYWxUb3RhbCA6IGxpc3QubGVuZ3RoXG4gICAgICAgICAgICAgICAgfSA6IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc29ydDogZnVuY3Rpb24gc29ydERhdGEoZGF0YSwgdGFibGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc29ydGluZyA9IHRhYmxlUGFyYW1zLnNvcnRpbmcoKTtcbiAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IHNvcnRpbmcgPyAkZmlsdGVyKCdvcmRlckJ5JykoZGF0YS5saXN0LCB0YWJsZVBhcmFtcy5vcmRlckJ5KCkpIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0ID8ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0OiBsaXN0LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogZGF0YS50b3RhbFxuICAgICAgICAgICAgICAgIH0gOiBkYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjeVRhYmxlUGFyYW1zID0gZnVuY3Rpb24oaW5pdFN0YXRlLCBpbml0UHJvcHMpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHZhciBsb2cgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAocHJvcHMuZGVidWdNb2RlICYmICRsb2cuZGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5kZWJ1Zy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIHRhYmxlIGRhdGFcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IFtdO1xuICAgICAgICAgICAgLy8gdXNlZCB0byBrZWVwIG9yaWdpbmFsIGRhdGEoZmV0Y2hlZCBmcm9tIHJlbW90ZSlcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxEYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFRvdGFsID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgLy8gV2hldGhlciB0byB1c2UgY2FjaGUuXG4gICAgICAgICAgICAvLyBVc2VmdWwgZm9yIGV4YW1wbGUsIHdoZW4geW91IHNldCBwYWdlIGxlbmd0aCA1MCB0byAyMCwgbm8gbmVlZCB0byByZWxvYWQgZGF0YS5cbiAgICAgICAgICAgIHRoaXMuY2FjaGVUeXBlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgLy8gdGhlIGNoYW5nZWQgc3RhdGUgcHJvcGVydGllcywgcmVzZXQgYWZ0ZXIgcmVsb2FkLFxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VkU3RhdGVzID0ge307XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjc3RhdGVcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNldCBuZXcgc3RhdGUgb3IgZ2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3U3RhdGUgTmV3IHN0YXRlXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDdXJyZW50IHN0YXRlIG9yIGB0aGlzYFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gZnVuY3Rpb24obmV3U3RhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQobmV3U3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBuZXdTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbmV3U3RhdGVba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJhY2tDaGFuZ2VzKGtleSwgdmFsdWUsIHN0YXRlW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVba2V5XSA9IChpc051bWJlcihuZXdTdGF0ZVtrZXldKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChuZXdTdGF0ZVtrZXldKSA6IG5ld1N0YXRlW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGxvZygnY3lUYWJsZTogc2V0IHN0YXRlJywgc3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNwcm9wc1xuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gU2V0IG5ldyBwcm9wcyBvciBnZXQgY3VycmVudCBwcm9wc1xuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdQcm9wcyBOZXcgcHJvcHMgb3IgdW5kZWZpbmVkXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDdXJyZW50IHByb3BzIG9yIGB0aGlzYFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnByb3BzID0gZnVuY3Rpb24obmV3UHJvcHMpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQobmV3UHJvcHMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BzID0gYW5ndWxhci5leHRlbmQocHJvcHMsIG5ld1Byb3BzKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBzZXQgcHJvcHMnLCBwcm9wcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcHM7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3BhZ2VcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmIHBhcmFtZXRlciBwYWdlIG5vdCBzZXQgcmV0dXJuIGN1cnJlbnQgcGFnZSBlbHNlIHNldCBjdXJyZW50IHBhZ2VcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGFnZSBQYWdlIG51bWJlclxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdHxOdW1iZXJ9IEN1cnJlbnQgcGFnZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5wYWdlID0gZnVuY3Rpb24ocGFnZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChwYWdlKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAncGFnZSc6IHBhZ2VcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLnBhZ2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2ZpbHRlclxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gSWYgcGFyYW1ldGVyIHBhZ2Ugbm90IHNldCByZXR1cm4gY3VycmVudCBmaWx0ZXIgZWxzZSBzZXQgY3VycmVudCBmaWx0ZXJcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyIE5ldyBmaWx0ZXJcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IEN1cnJlbnQgZmlsdGVyIG9yIGB0aGlzYFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChmaWx0ZXIpID8gdGhpcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICdmaWx0ZXInOiBmaWx0ZXJcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLmZpbHRlcjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjY291bnRcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmIHBhcmFtZXRlciBjb3VudCBub3Qgc2V0IHJldHVybiBjdXJyZW50IGNvdW50IHBlciBwYWdlIGVsc2Ugc2V0IGNvdW50IHBlciBwYWdlXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGNvdW50IENvdW50IHBlciBudW1iZXJcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R8TnVtYmVyfSBDb3VudCBwZXIgcGFnZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IGZ1bmN0aW9uKGNvdW50KSB7XG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgdG8gZmlyc3QgcGFnZSBiZWNhdXNlIGNhbiBiZSBibGFuayBwYWdlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKGNvdW50KSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnY291bnQnOiBjb3VudCxcbiAgICAgICAgICAgICAgICAgICAgJ3BhZ2UnOiAxXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5jb3VudDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjc29ydFR5cGVcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmIHBhcmFtZXRlciBzb3J0VHlwZSBub3Qgc2V0IHJldHVybiBjdXJyZW50IHNvcnRUeXBlIGVsc2Ugc2V0IHNvcnRUeXBlXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNvcnRUeXBlIGhvdyB0byBzb3J0IGRhdGEoJ3JlbW90ZSc6IGxldCBzZXJ2ZXIgc29ydCBhbGwgZGF0YSBpbiBkYnwnbG9jYWwnOiBzb3J0IGxvY2FsKVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdHxOdW1iZXJ9IFNvcnRUeXBlIG9yIGB0aGlzYFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnNvcnRUeXBlID0gZnVuY3Rpb24oc29ydFR5cGUpIHtcbiAgICAgICAgICAgICAgICAvLyByZXNldCB0byBmaXJzdCBwYWdlIGJlY2F1c2UgY2FuIGJlIGJsYW5rIHBhZ2VcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoc29ydFR5cGUpID8gdGhpcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICdzb3J0VHlwZSc6IHNvcnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAncGFnZSc6IDFcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLnNvcnRUeXBlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNmaWx0ZXJUeXBlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgZmlsdGVyVHlwZSBub3Qgc2V0IHJldHVybiBjdXJyZW50IGZpbHRlclR5cGUgZWxzZSBzZXQgZmlsdGVyVHlwZVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmaWx0ZXJUeXBlIGhvdyB0byBmaWx0ZXIgZGF0YSgncmVtb3RlJzogbGV0IHNlcnZlciBzZWFyY2ggZnJvbSBkYnwnbG9jYWwnOiBmaWx0ZXIgbG9jYWwpXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fE51bWJlcn0gRmlsdGVyVHlwZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJUeXBlID0gZnVuY3Rpb24oZmlsdGVyVHlwZSkge1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IHRvIGZpcnN0IHBhZ2UgYmVjYXVzZSBjYW4gYmUgYmxhbmsgcGFnZVxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChmaWx0ZXJUeXBlKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnZmlsdGVyVHlwZSc6IGZpbHRlclR5cGUsXG4gICAgICAgICAgICAgICAgICAgICdwYWdlJzogMVxuICAgICAgICAgICAgICAgIH0pIDogc3RhdGUuZmlsdGVyVHlwZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjdG90YWxcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmIHBhcmFtZXRlciB0b3RhbCBub3Qgc2V0IHJldHVybiBjdXJyZW50IHF1YW50aXR5IGVsc2Ugc2V0IHF1YW50aXR5XG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHRvdGFsIFRvdGFsIHF1YW50aXR5IG9mIGl0ZW1zXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fE51bWJlcn0gQ3VycmVudCB0b3RhbCBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy50b3RhbCA9IGZ1bmN0aW9uKHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHRvdGFsKSA/IHRoaXMucHJvcHMoe1xuICAgICAgICAgICAgICAgICAgICAndG90YWwnOiB0b3RhbFxuICAgICAgICAgICAgICAgIH0pIDogcHJvcHMudG90YWw7XG4gICAgICAgICAgICB9O1xuXG5cblxuICAgICAgICAgICAgLy8gaW5uZXIgdXNhZ2Ugb25seSBub3dcbiAgICAgICAgICAgIC8vIHRyYWNrIHdoYXQgY2hhbmdlZCB3aXRoIHN0YXRlXG4gICAgICAgICAgICB0aGlzLnRyYWNrQ2hhbmdlcyA9IGZ1bmN0aW9uKGtleSwgbmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5jaGFuZ2VkU3RhdGVzW2tleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleSxcbiAgICAgICAgICAgICAgICAgICAgcHJldjogb2xkVmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGN1cjogbmV3VmFsdWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gaW5uZXIgdXNhZ2Ugb25seSBub3dcbiAgICAgICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIHRvIHVzZSBjYWNoZVxuICAgICAgICAgICAgdGhpcy5zaG91bGRVc2VDYWNoZSA9IGZ1bmN0aW9uKHN0YXRlLCBjaGFuZ2VkU3RhdGVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGdldGtleXNMZW5ndGgoY2hhbmdlZFN0YXRlcyk7XG4gICAgICAgICAgICAgICAgaWYgKGxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZFN0YXRlcy5zb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi4kc3RhdGUuc29ydFR5cGUgPT09ICdsb2NhbCcgPyAnc29ydC1sb2NhbCcgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZFN0YXRlcy5maWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5maWx0ZXJUeXBlID09PSAnbG9jYWwnID8gJ2ZpbHRlci1sb2NhbCcgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VkU3RhdGVzLnBhZ2UgJiYgY2hhbmdlZFN0YXRlcy5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoYW5nZWRTdGF0ZXMucGFnZS5jdXIgPT09IGNoYW5nZWRTdGF0ZXMucGFnZS5wcmV2ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZFN0YXRlcy5jb3VudC5jdXIgPD0gY2hhbmdlZFN0YXRlcy5jb3VudC5wcmV2ID8gJ2NvdW50LWxvY2FsJyA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjcXVlcnlcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIENhbGxlZCBieSB1c2VyIHRvIGJ1aWxkIHF1ZXJ5IHBhcmFtcyBmb3IgYWpheC5cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufEFycmF5fSBvcHRpb25hbCBmaWx0ZXIuIFdoZW4gaXQncyBhcnJheSwgaXQncyBwcm9wZXJ0eSBuYW1lcyB3aGljaCBuZWVkZWQgYnkgdXNlcjtcbiAgICAgICAgICAgICAqICAgICB3aGVuIGl0J3MgZnVuY3Rpb24sIHJldHVybiB0cnVlfGZhbHNlIHRvIGZpbHRlciBwcm9wZXJ0aWVzLCBvciByZXR1cm4gYW4gYXJyYXkoW3VwZGF0ZWROYW1lLCB1cGRhdGVkVmFsdWVdKS5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5xdWVyeSA9IGZ1bmN0aW9uKGZpbHRlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXQgPSB7fSwgcCwgdG1wO1xuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHAgaW4gZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAocCBpbiBzdGF0ZSkgJiYgKHJldFtwXSA9IHN0YXRlW3BdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChwIGluIHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA9PT0gJ2ZpbHRlclR5cGUnIHx8IHAgPT09ICdzb3J0VHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IGZpbHRlcihwLCBzdGF0ZVtwXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG1wID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0W3BdID0gc3RhdGVbcF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNBcnJheSh0bXApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0W3RtcFswXV0gPSB0bXBbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHAgaW4gc3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwID09PSAnZmlsdGVyVHlwZScgfHwgcCA9PT0gJ3NvcnRUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0W3BdID0gc3RhdGVbcF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjZ2V0RGF0YVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gQ2FsbGVkIHRvIGdldCBuZXcgZGF0YSB3aGVuIHN0YXRlIGNoYW5nZWRcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gJGRlZmVyIHByb21pc2Ugb2JqZWN0XG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RhdGUgTmV3IHN0YXRlXG4gICAgICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGFsbCBXaGV0aGVyIHRvIGdldCBhbGwgZGF0YVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmdldERhdGEgPSBmdW5jdGlvbigkZGVmZXIsIHN0YXRlLCBhbGwpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KHRoaXMuZGF0YSkgJiYgYW5ndWxhci5pc09iamVjdChzdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGRlZmVyLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogYWxsID8gdGhpcy5kYXRhIDogdGhpcy5kYXRhLnNsaWNlKChzdGF0ZS5wYWdlKCkgLSAxKSAqIHN0YXRlLmNvdW50KCksIHN0YXRlLnBhZ2UoKSAqIHN0YXRlLmNvdW50KCkpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Q6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNnZXRBbGxEYXRhXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBDYWxsZWQgd2hlbiB3YW50IHRvIGxvYWQgYWxsIGRhdGEoc3VjaCBhcyBleHBvcnQgY3N2KVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9ICRkZWZlclxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmdldEFsbERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgJGRlZmVyID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBwcm9wcy5nZXREYXRhKCRkZWZlciwgc2VsZiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgJGRlZmVyLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BzLiRzY29wZS4kYWxsRGF0YSA9IGRhdGFIYW5kbGVycy5hZGp1c3QoZGF0YSwgc2VsZiwgdHJ1ZSkubGlzdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGRlZmVyO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNyZWxvYWRcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIFJlbG9hZCB0YWJsZSBkYXRhXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMucmVsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyICRkZWZlciA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgbG9hZGluZyB0byB0cnVlXG4gICAgICAgICAgICAgICAgcHJvcHMubG9hZGluZyA9IHByb3BzLiRzY29wZS4kbG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBsb2coJ2N5VGFibGU6IGFib3V0IHRvIHJlbG9hZC4nKTtcblxuICAgICAgICAgICAgICAgIGlmICgoc2VsZi5jYWNoZVR5cGUgPSBzZWxmLnNob3VsZFVzZUNhY2hlKHN0YXRlLCBzZWxmLmNoYW5nZWRTdGF0ZXMpKSkge1xuICAgICAgICAgICAgICAgICAgICAkZGVmZXIucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiAoc2VsZi5vcmlnaW5hbERhdGEgfHwgc2VsZi5kYXRhKS5zbGljZSgwLCBzdGF0ZS5jb3VudCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogc2VsZi5vcmlnaW5hbFRvdGFsIHx8IHN0YXRlLnRvdGFsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlID0gJGRlZmVyLnByb21pc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuZ2V0RGF0YSgkZGVmZXIsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlID0gJGRlZmVyLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlZERhdGEgPSBkYXRhSGFuZGxlcnMuYWRqdXN0KGRhdGEsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vcmlnaW5hbERhdGEgPSBoYW5kbGVkRGF0YS5saXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3JpZ2luYWxUb3RhbCA9IGhhbmRsZWREYXRhLnRvdGFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coJ2N5VGFibGU6IGRhdGEgaXMgZW1wdHkgb3Igbm90IHZhbGlkLicsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZWREYXRhO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNoYW5nZWRTdGF0ZXMgPSB7fTtcblxuICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbihoYW5kbGVkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9wcy5sb2FkaW5nID0gcHJvcHMuJHNjb3BlLiRsb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHByb3BzLiRzY29wZS4kY3N2R2VuZXJhdGVkID0gZmFsc2U7IC8vIG5lZWQgcmVnZW5lcmF0ZSBjc3ZcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYW5kbGVkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpbHRlciBsb2NhbFxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZmlsdGVyVHlwZSA9PT0gJ2xvY2FsJyAmJiBzdGF0ZS5maWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWREYXRhID0gZGF0YUhhbmRsZXJzLmZpbHRlcihoYW5kbGVkRGF0YSwgc2VsZik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gc29ydCBsb2NhbFxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc29ydFR5cGUgPT09ICdsb2NhbCcgJiYgc3RhdGUuc29ydGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZERhdGEgPSBkYXRhSGFuZGxlcnMuc29ydChoYW5kbGVkRGF0YSwgc2VsZik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsb2coJ2N5VGFibGU6IGN1cnJlbnQgc2NvcGUnLCBwcm9wcy4kc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYXRhID0gcHJvcHMuJHNjb3BlLiRkYXRhID0gaGFuZGxlZERhdGEubGlzdDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNOdW1iZXIoaGFuZGxlZERhdGEudG90YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRvdGFsKGhhbmRsZWREYXRhLnRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwcm9wcy4kc2NvcGUucGFnZXMgPSBzZWxmLmdlbmVyYXRlUGFnZXNBcnJheShzZWxmLnBhZ2UoKSwgc2VsZi50b3RhbCgpLCBzZWxmLmNvdW50KCkpO1xuICAgICAgICAgICAgICAgICAgICBwcm9wcy4kc2NvcGUuJGVtaXQoJ2N5VGFibGVBZnRlclJlbG9hZERhdGEnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjZ2VuZXJhdGVQYWdlc0FycmF5XG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBHZW5lcmF0ZSBhcnJheSBvZiBwYWdlc1xuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gY3VycmVudFBhZ2Ugd2hpY2ggcGFnZSBtdXN0IGJlIGFjdGl2ZVxuICAgICAgICAgICAgICogQHBhcmFtIHtib29sZWFufSB0b3RhbEl0ZW1zIFRvdGFsIHF1YW50aXR5IG9mIGl0ZW1zXG4gICAgICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHBhZ2VTaXplIFF1YW50aXR5IG9mIGl0ZW1zIG9uIHBhZ2VcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgcGFnZXNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZVBhZ2VzQXJyYXkgPSBmdW5jdGlvbihjdXJyZW50UGFnZSwgdG90YWxJdGVtcywgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4QmxvY2tzLCBtYXhQYWdlLCBtYXhQaXZvdFBhZ2VzLCBtaW5QYWdlLCBudW1QYWdlcywgcGFnZXM7XG4gICAgICAgICAgICAgICAgdmFyIHRtcEl0ZW07XG4gICAgICAgICAgICAgICAgbWF4QmxvY2tzID0gMTE7XG4gICAgICAgICAgICAgICAgcGFnZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBudW1QYWdlcyA9IE1hdGguY2VpbCh0b3RhbEl0ZW1zIC8gcGFnZVNpemUpO1xuICAgICAgICAgICAgICAgIGlmIChudW1QYWdlcyA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncHJldicsXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IE1hdGgubWF4KDEsIGN1cnJlbnRQYWdlIC0gMSksXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGN1cnJlbnRQYWdlID4gMVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcGFnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZmlyc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSA+IDFcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG1heFBpdm90UGFnZXMgPSBNYXRoLnJvdW5kKChtYXhCbG9ja3MgLSA1KSAvIDIpO1xuICAgICAgICAgICAgICAgICAgICBtaW5QYWdlID0gTWF0aC5tYXgoMiwgY3VycmVudFBhZ2UgLSBtYXhQaXZvdFBhZ2VzKTtcbiAgICAgICAgICAgICAgICAgICAgbWF4UGFnZSA9IE1hdGgubWluKG51bVBhZ2VzIC0gMSwgY3VycmVudFBhZ2UgKyBtYXhQaXZvdFBhZ2VzICogMiAtIChjdXJyZW50UGFnZSAtIG1pblBhZ2UpKTtcbiAgICAgICAgICAgICAgICAgICAgbWluUGFnZSA9IE1hdGgubWF4KDIsIG1pblBhZ2UgLSAobWF4UGl2b3RQYWdlcyAqIDIgLSAobWF4UGFnZSAtIG1pblBhZ2UpKSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gbWluUGFnZTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPD0gbWF4UGFnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpID09PSBtaW5QYWdlICYmIGkgIT09IDIpIHx8IChpID09PSBtYXhQYWdlICYmIGkgIT09IG51bVBhZ2VzIC0gMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBJdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbW9yZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogY3VycmVudFBhZ2UgIT09IGksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcEl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwYWdlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGN1cnJlbnRQYWdlICE9PSBpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXMucHVzaCh0bXBJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwYWdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsYXN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogbnVtUGFnZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGN1cnJlbnRQYWdlICE9PSBudW1QYWdlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcGFnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbmV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IE1hdGgubWluKG51bVBhZ2VzLCBjdXJyZW50UGFnZSArIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSA8IG51bVBhZ2VzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcGFnZXM7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3NvcnRpbmdcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmICdzb3J0aW5nJyBwYXJhbWV0ZXIgaXMgbm90IHNldCwgcmV0dXJuIGN1cnJlbnQgc29ydGluZy4gT3RoZXJ3aXNlIHNldCBjdXJyZW50IHNvcnRpbmcuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNvcnRpbmcgTmV3IHNvcnRpbmdcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IEN1cnJlbnQgc29ydGluZyBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5zb3J0aW5nID0gZnVuY3Rpb24oc29ydGluZykge1xuICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyYXkgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFycmF5W3NvcnRpbmddID0gYXJndW1lbnRzWzFdO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdzb3J0aW5nJzogc29ydEFycmF5XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHNvcnRpbmcpID8gdGhpcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICdzb3J0aW5nJzogc29ydGluZ1xuICAgICAgICAgICAgICAgIH0pIDogc3RhdGUuc29ydGluZztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjb3JkZXJCeVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gUmV0dXJuIG9iamVjdCBvZiBzb3J0aW5nIHBhcmFtZXRlcnMgZm9yIGFuZ3VsYXIgZmlsdGVyXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBsaWtlOiBbICctbmFtZScsICcrYWdlJyBdXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMub3JkZXJCeSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzb3J0aW5nID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgY29sdW1uIGluIHN0YXRlLnNvcnRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydGluZy5wdXNoKChzdGF0ZS5zb3J0aW5nW2NvbHVtbl0gPT09ICdhc2MnID8gJysnIDogJy0nKSArIGNvbHVtbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzb3J0aW5nO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gdGhlIHN0YXRlIHdpbGwgYmUgd2F0Y2hlZCBieSBjb250cm9sbGVyIHRvIHJlbG9hZFxuICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy4kc3RhdGUgPSB7XG4gICAgICAgICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICAgICAgICBjb3VudDogNSxcbiAgICAgICAgICAgICAgICBmaWx0ZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgZmlsdGVyVHlwZTogJ2xvY2FsJywgLy8gJ3JlbW90ZSd8J2xvY2FsJ1xuICAgICAgICAgICAgICAgIHNvcnRpbmc6IG51bGwsXG4gICAgICAgICAgICAgICAgc29ydFR5cGU6ICdsb2NhbCcgLy8gJ3JlbW90ZSd8J2xvY2FsJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gYWx0aG91Z2ggc29tZSBsaWtlIHRvdGFsIGlzIG1vcmUgYXBwcm9wcmlhdGUgdG8gcGxhY2UgdG8gc3RhdGUsXG4gICAgICAgICAgICAvLyBpdCdzIHBsYWNlZCBoZXJlIHRvIGF2b2lkIGV4dHJhIHJlYWxvZFxuICAgICAgICAgICAgdmFyIHByb3BzID0ge1xuICAgICAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvdGFsOiAwLFxuICAgICAgICAgICAgICAgICRzY29wZTogbnVsbCwgLy8gc2V0IGJ5IGN5VGFibGVDb250cm9sbGVyXG4gICAgICAgICAgICAgICAgZGVmYXVsdFNvcnQ6ICdkZXNjJyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJEZWxheTogNzUwLFxuICAgICAgICAgICAgICAgIGNvdW50czogWzUsIDEwLCAyNSwgNTBdLFxuICAgICAgICAgICAgICAgIHNvcnRpbmdJbmRpY2F0b3I6ICdzcGFuJyxcbiAgICAgICAgICAgICAgICBnZXREYXRhOiB0aGlzLmdldERhdGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMucHJvcHMoaW5pdFByb3BzKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUoaW5pdFN0YXRlKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjeVRhYmxlUGFyYW1zO1xuICAgIH1dKTtcblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBvYmplY3RcbiAgICAgKiBAbmFtZSBjeVRhYmxlLmRpcmVjdGl2ZTpjeVRhYmxlLmN5VGFibGVDb250cm9sbGVyXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBFYWNoIHtAbGluayBjeVRhYmxlLmRpcmVjdGl2ZTpjeVRhYmxlIGN5VGFibGV9IGRpcmVjdGl2ZSBjcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBjeVRhYmxlQ29udHJvbGxlcmBcbiAgICAgKi9cbiAgICB2YXIgY3lUYWJsZUNvbnRyb2xsZXIgPSBbJyRzY29wZScsICdjeVRhYmxlUGFyYW1zJywgJyR0aW1lb3V0JywgZnVuY3Rpb24oJHNjb3BlLCBjeVRhYmxlUGFyYW1zLCAkdGltZW91dCkge1xuICAgICAgICB2YXIgZGVsYXlGaWx0ZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGltZXIgPSAwO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNhbGxiYWNrLCBtcykge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lcik7XG4gICAgICAgICAgICAgICAgdGltZXIgPSAkdGltZW91dChjYWxsYmFjaywgbXMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdwYXJhbXMnLCBmdW5jdGlvbihuZXdQYXJhbXMsIG9sZFBhcmFtcykge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQobmV3UGFyYW1zKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZmlsdGVyVHlwZScsIGZ1bmN0aW9uKGZpbHRlclR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlclR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRGaWx0ZXJUeXBlKGZpbHRlclR5cGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdzb3J0VHlwZScsIGZ1bmN0aW9uKHNvcnRUeXBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzb3J0VHlwZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldFNvcnRUeXBlKHNvcnRUeXBlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgncGFyYW1zLiRzdGF0ZScsIGZ1bmN0aW9uKG5ld1N0YXRlLCBvbGRTdGF0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5lcXVhbHMobmV3U3RhdGUuZmlsdGVyLCBvbGRTdGF0ZSAmJiBvbGRTdGF0ZS5maWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGF5RmlsdGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy4kc3RhdGUucGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICB9LCAkc2NvcGUucGFyYW1zLnByb3BzKCkuZmlsdGVyRGVsYXkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS5zb3J0QnkgPSBmdW5jdGlvbihjb2x1bW4sIGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgcGFyc2VkU29ydGFibGUgPSAkc2NvcGUucGFyc2UoY29sdW1uLnNvcnRhYmxlKTtcbiAgICAgICAgICAgIGlmICghcGFyc2VkU29ydGFibGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZGVmYXVsdFNvcnQgPSAkc2NvcGUucGFyYW1zLnByb3BzKCkuZGVmYXVsdFNvcnQ7XG4gICAgICAgICAgICB2YXIgaW52ZXJzZVNvcnQgPSAoZGVmYXVsdFNvcnQgPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYycpO1xuICAgICAgICAgICAgdmFyIHNvcnRpbmcgPSAkc2NvcGUucGFyYW1zLnNvcnRpbmcoKSAmJiAkc2NvcGUucGFyYW1zLnNvcnRpbmcoKVtwYXJzZWRTb3J0YWJsZV0gJiYgKCRzY29wZS5wYXJhbXMuc29ydGluZygpW3BhcnNlZFNvcnRhYmxlXSA9PT0gZGVmYXVsdFNvcnQpO1xuICAgICAgICAgICAgdmFyIHNvcnRpbmdQYXJhbXMgPSAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSA/ICRzY29wZS5wYXJhbXMuc29ydGluZygpIDoge307XG4gICAgICAgICAgICBzb3J0aW5nUGFyYW1zW3BhcnNlZFNvcnRhYmxlXSA9IChzb3J0aW5nID8gaW52ZXJzZVNvcnQgOiBkZWZhdWx0U29ydCk7XG4gICAgICAgICAgICAkc2NvcGUucGFyYW1zLnN0YXRlKHtcbiAgICAgICAgICAgICAgICBzb3J0aW5nOiBzb3J0aW5nUGFyYW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBzZXRTb3J0VHlwZSh0eXBlKSB7XG4gICAgICAgICAgICAkc2NvcGUucGFyYW1zLnNvcnRUeXBlKHR5cGUpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNldEZpbHRlclR5cGUodHlwZSkge1xuICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5maWx0ZXJUeXBlKHR5cGUpO1xuICAgICAgICB9XG4gICAgfV07XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgZGlyZWN0aXZlXG4gICAgICogQG5hbWUgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZVxuICAgICAqIEByZXN0cmljdCBFQVxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogRGlyZWN0aXZlIHRoYXQgaW5zdGFudGlhdGVzIHtAbGluayBjeVRhYmxlLmRpcmVjdGl2ZTpjeVRhYmxlLmN5VGFibGVDb250cm9sbGVyIGN5VGFibGVDb250cm9sbGVyfS5cbiAgICAgKi9cbiAgICBhcHAuZGlyZWN0aXZlKCdjeVRhYmxlJywgWyckY29tcGlsZScsICckcScsICckcGFyc2UnLFxuICAgICAgICBmdW5jdGlvbigkY29tcGlsZSwgJHEsICRwYXJzZSkge1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IDEwMDEsXG4gICAgICAgICAgICAgICAgc2NvcGU6IHRydWUsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogY3lUYWJsZUNvbnRyb2xsZXIsXG4gICAgICAgICAgICAgICAgY29tcGlsZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3dUcGw7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY3VzdG9tIGhlYWRlclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBlbGVtZW50LmZpbmQoJ3RhYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aGVhZCA9IHRhYmxlLmZpbmQoJ3RoZWFkJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3cgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndHI6bm90KC5jeS10YWJsZS1ncm91cCknKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocm93LmZpbmQoJ3RkJyksIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbCA9IGFuZ3VsYXIuZWxlbWVudChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbC5hdHRyKCdpZ25vcmUtY2VsbCcpICYmICd0cnVlJyA9PT0gZWwuYXR0cignaWdub3JlLWNlbGwnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJzZWRBdHRyaWJ1dGUgPSBmdW5jdGlvbihhdHRyLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwYXJzZShlbC5hdHRyKCdkYXRhLScgKyBhdHRyKSB8fCBlbC5hdHRyKGF0dHIpKShzY29wZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbnM6IGNvbHVtbnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgfHwgZGVmYXVsdFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyc2VkVGl0bGUgPSBwYXJzZWRBdHRyaWJ1dGUoJ3RpdGxlJywgJyAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJUZW1wbGF0ZVVSTCA9IHBhcnNlZEF0dHJpYnV0ZSgnaGVhZGVyJywgZmFsc2UpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IHBhcnNlZEF0dHJpYnV0ZSgnZmlsdGVyJywgZmFsc2UpKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVGVtcGxhdGVVUkwgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJOYW1lID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyLiQkbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlck5hbWUgPSBmaWx0ZXIuJCRuYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWx0ZXIuJCRuYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIudGVtcGxhdGVVUkwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUZW1wbGF0ZVVSTCA9IGZpbHRlci50ZW1wbGF0ZVVSTDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZmlsdGVyLnRlbXBsYXRlVVJMO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5hdHRyKCdkYXRhLXRpdGxlLXRleHQnLCBwYXJzZWRUaXRsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGkrKyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcGFyc2VkVGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHBhcnNlZEF0dHJpYnV0ZSgnc29ydGFibGUnLCBmYWxzZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogZWwuYXR0cignZGF0YS1oZWFkZXItY2xhc3MnKSB8fCBlbC5hdHRyKCdoZWFkZXItY2xhc3MnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6IGZpbHRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUZW1wbGF0ZVVSTDogZmlsdGVyVGVtcGxhdGVVUkwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyTmFtZTogZmlsdGVyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJUZW1wbGF0ZVVSTDogaGVhZGVyVGVtcGxhdGVVUkwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyRGF0YTogKGVsLmF0dHIoJ2ZpbHRlci1kYXRhJykgPyBlbC5hdHRyKCdmaWx0ZXItZGF0YScpIDogbnVsbCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogKGVsLmF0dHIoJ25nLXNob3cnKSA/IGZ1bmN0aW9uKHNjb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcGFyc2UoZWwuYXR0cignbmctc2hvdycpKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByb3dUcGwgPSByb3cub3V0ZXJIVE1MID8gcm93Lm91dGVySFRNTCA6IGFuZ3VsYXIuZWxlbWVudCgnPGRpdj48L2Rpdj4nKS5hcHBlbmQocm93LmNsb25lKCkpLmh0bWwoKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBlbGVtZW50LmZpbmQoJ3RhYmxlJykuYWRkQ2xhc3MoJ2N5LXRhYmxlLWNvbnRlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRjb2x1bW5zID0gY29sdW1ucztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRyb3dUcGwgPSAnPHRhYmxlPjx0Ym9keT4nICsgcm93VHBsLnJlcGxhY2UoL14oXFxzKjxcXHMqdHIuKykoXFwkZGF0YSkvLCAnJDEkYWxsRGF0YScpICsgJzwvdGJvZHk+PC90YWJsZT4nO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRycy4kb2JzZXJ2ZSgnZmlsdGVyVHlwZScsIGZ1bmN0aW9uKGZpbHRlclR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWx0ZXJUeXBlID0gZmlsdGVyVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ3NvcnRUeXBlJywgZnVuY3Rpb24oc29ydFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zb3J0VHlwZSA9IHNvcnRUeXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cnMudGFibGVQYXJhbXMsIChmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChwYXJhbXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFyYW1zTW9kZWwgPSAkcGFyc2UoYXR0cnMudGFibGVQYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMucHJvcHMoKS4kc2NvcGUgPSBzY29wZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnNlID0gZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZCh0ZXh0KSA/IHRleHQoc2NvcGUpIDogJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJzLnNob3dGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kcGFyZW50LiR3YXRjaChhdHRycy5zaG93RmlsdGVyLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zaG93RmlsdGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goY29sdW1ucywgZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlZjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbHVtbi5maWx0ZXJEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmID0gJHBhcnNlKGNvbHVtbi5maWx0ZXJEYXRhKShzY29wZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uOiBjb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShhbmd1bGFyLmlzT2JqZWN0KGRlZikgJiYgYW5ndWxhci5pc09iamVjdChkZWYucHJvbWlzZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRnVuY3Rpb24gJyArIGNvbHVtbi5maWx0ZXJEYXRhICsgJyBtdXN0IGJlIGluc3RhbmNlIG9mICRxLmRlZmVyKCknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbHVtbi5maWx0ZXJEYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWYucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnVuc2hpZnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICctJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuaGFzQ2xhc3MoJ2N5LXRhYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50ZW1wbGF0ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogKGF0dHJzLnRlbXBsYXRlSGVhZGVyID8gYXR0cnMudGVtcGxhdGVIZWFkZXIgOiAnY3ktdGFibGUvaGVhZGVyLmh0bWwnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjogKGF0dHJzLnRlbXBsYXRlUGFnaW5hdGlvbiA/IGF0dHJzLnRlbXBsYXRlUGFnaW5hdGlvbiA6ICdjeS10YWJsZS9wYWdlci5odG1sJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogKGF0dHJzLnRlbXBsYXRlT3BlcmF0aW9uID8gYXR0cnMudGVtcGxhdGVPcGVyYXRpb24gOiAnY3ktdGFibGUvb3BlcmF0aW9uLmh0bWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlclRlbXBsYXRlID0gdGhlYWQubGVuZ3RoID4gMCA/IHRoZWFkIDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoZWFkJykpLmF0dHIoJ25nLWluY2x1ZGUnLCAndGVtcGxhdGVzLmhlYWRlcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYWdpbmF0aW9uVGVtcGxhdGUgPSBhbmd1bGFyLmVsZW1lbnQoZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yKCcuY3ktdGFibGUtcGFnaW5hdGlvbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3BlcmF0aW9uVGVtcGxhdGUgPSBhbmd1bGFyLmVsZW1lbnQoZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yKCcuY3ktdGFibGUtb3BlcmF0aW9uJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25UZW1wbGF0ZS5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2N5LXRhYmxlLXBhZ2luYXRpb24nOiAncGFyYW1zJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RlbXBsYXRlLXVybCc6ICd0ZW1wbGF0ZXMucGFnaW5hdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb25UZW1wbGF0ZS5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2N5LXRhYmxlLW9wZXJhdGlvbic6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGVtcGxhdGUtdXJsJzogJ3RlbXBsYXRlcy5vcGVyYXRpb24nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCd0aGVhZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2N5LXRhYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUucHJlcGVuZChoZWFkZXJUZW1wbGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUoaGVhZGVyVGVtcGxhdGUpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZShwYWdpbmF0aW9uVGVtcGxhdGUpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZShvcGVyYXRpb25UZW1wbGF0ZSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0pO1xuXG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgZGlyZWN0aXZlXG4gICAgICogQG5hbWUgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZVBhZ2luYXRpb25cbiAgICAgKiBAcmVzdHJpY3QgQVxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogRGlyZWN0aXZlIHRoYXQgaGFuZGxlcyBwYWdpbmF0aW9uXG4gICAgICovXG4gICAgYXBwLmRpcmVjdGl2ZSgnY3lUYWJsZVBhZ2luYXRpb24nLCBbJyRjb21waWxlJyxcbiAgICAgICAgZnVuY3Rpb24oJGNvbXBpbGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICAncGFyYW1zJzogJz1jeVRhYmxlUGFnaW5hdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICd0ZW1wbGF0ZVVybCc6ICc9J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncGFyYW1zJywgZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChwYXJhbXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFyYW1zLnByb3BzKCkuJHNjb3BlLiRvbignY3lUYWJsZUFmdGVyUmVsb2FkRGF0YScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhZ2VzID0gc2NvcGUucGFyYW1zLmdlbmVyYXRlUGFnZXNBcnJheShzY29wZS5wYXJhbXMucGFnZSgpLCBzY29wZS5wYXJhbXMudG90YWwoKSwgc2NvcGUucGFyYW1zLmNvdW50KCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndGVtcGxhdGVVcmwnLCBmdW5jdGlvbih0ZW1wbGF0ZVVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodGVtcGxhdGVVcmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGUuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25nLWluY2x1ZGUnOiAndGVtcGxhdGVVcmwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKHRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKHRlbXBsYXRlKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBkaXJlY3RpdmVcbiAgICAgKiBAbmFtZSBjeVRhYmxlLmRpcmVjdGl2ZTpjeVRhYmxlT3BlcmF0aW9uXG4gICAgICogQHJlc3RyaWN0IEFcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIERpcmVjdGl2ZSB0aGF0IGhhbmRsZXMgdGFibGUncyBwYWdlIGNvdW50LCBmaWx0ZXIsIGFuZCBzbyBvblxuICAgICAqL1xuICAgIGFwcC5kaXJlY3RpdmUoJ2N5VGFibGVPcGVyYXRpb24nLCBbJyRjb21waWxlJyxcbiAgICAgICAgZnVuY3Rpb24oJGNvbXBpbGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgICAgICBzY29wZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZXBsYWNlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXF1aXJlOiAnXmN5VGFibGUnLFxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWF0dHJzLnRlbXBsYXRlVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ3RlbXBsYXRlVXJsJywgZnVuY3Rpb24odGVtcGxhdGVVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHRlbXBsYXRlVXJsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmctaW5jbHVkZSc6IHRlbXBsYXRlVXJsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKHRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKHRlbXBsYXRlKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBkaXJlY3RpdmVcbiAgICAgKiBAbmFtZSBjeVRhYmxlLmRpcmVjdGl2ZTpjeVRhYmxlQ3N2XG4gICAgICogQHJlc3RyaWN0IEFcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIERpcmVjdGl2ZSB0aGF0IGhlbHBzIGV4cG9ydCB0YWJsZSB0byBjc3ZcbiAgICAgKi9cbiAgICBhcHAuZGlyZWN0aXZlKCdjeVRhYmxlQ3N2JywgWyckcGFyc2UnLCAnJGNvbXBpbGUnLCAnJHRpbWVvdXQnLCBmdW5jdGlvbiAoJHBhcnNlLCAkY29tcGlsZSwgJHRpbWVvdXQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3N2U3RyID0gJyc7XG4gICAgICAgICAgICAgICAgdmFyIGFsbERhdGE7XG4gICAgICAgICAgICAgICAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xuICAgICAgICAgICAgICAgIC8vIGFjdHVhbCBkZWxpbWl0ZXIgY2hhcmFjdGVycyBmb3IgQ1NWIGZvcm1hdFxuICAgICAgICAgICAgICAgIHZhciBjb2xEZWxpbSA9ICdcIixcIic7XG4gICAgICAgICAgICAgICAgdmFyIHJvd0RlbGltID0gJ1wiXFxyXFxuXCInO1xuICAgICAgICAgICAgICAgIC8vIFRlbXBvcmFyeSBkZWxpbWl0ZXIgY2hhcmFjdGVycyB1bmxpa2VseSB0byBiZSB0eXBlZCBieSBrZXlib2FyZFxuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gYXZvaWQgYWNjaWRlbnRhbGx5IHNwbGl0dGluZyB0aGUgYWN0dWFsIGNvbnRlbnRzXG4gICAgICAgICAgICAgICAgdmFyIHRtcENvbERlbGltID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxMSk7IC8vIHZlcnRpY2FsIHRhYiBjaGFyYWN0ZXJcbiAgICAgICAgICAgICAgICB2YXIgdG1wUm93RGVsaW0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDApOyAvLyBudWxsIGNoYXJhY3RlclxuICAgICAgICAgICAgICAgIHZhciBjc3YgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL15cXHNcXHMqLywgJycpLnJlcGxhY2UoL1xccypcXHMkLywgJycpIC8vIHRyaW0gc3BhY2VzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csJ1wiXCInKTsgLy8gcmVwbGFjZSBxdW90ZXMgd2l0aCBkb3VibGUgcXVvdGVzXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlOiBmdW5jdGlvbigkZXZlbnQsIGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS4kY3N2R2VuZXJhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY3N2LmdlbmVyYXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbCAmJiBzY29wZS5wYXJhbXMuZ2V0QWxsRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSAkZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcmFtcy5nZXRBbGxEYXRhKCkucHJvbWlzZS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSAkY29tcGlsZShzY29wZS4kcm93VHBsKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUucHJlcGVuZChlbGVtZW50LmZpbmQoJ3RoZWFkJykuY2xvbmUoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3ZTdHIgPSBnZW5Dc3YodGFibGUuZmluZCgndHInKSwgZnVuY3Rpb24ocm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdyAmJiByb3cuaGFzQ2xhc3MoJ25nLXRhYmxlLWZpbHRlcnMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3N2LmdlbmVyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5jbGljaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3ZTdHIgPSBnZW5Dc3YoZWxlbWVudC5maW5kKCd0cicpLCBmdW5jdGlvbihyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdyAmJiByb3cuaGFzQ2xhc3MoJ25nLXRhYmxlLWZpbHRlcnMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3YuZ2VuZXJhdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGNzdkdlbmVyYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdkYXRhOnRleHQvY3N2O2NoYXJzZXQ9dXRmLTgsJyArIGVuY29kZVVSSUNvbXBvbmVudChjc3ZTdHIpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkb3dubG9hZDogZnVuY3Rpb24oZmlsZU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkKGNzdlN0ciwgZmlsZU5hbWUgfHwgJ2Rvd2xvYWQuY3N2JywgJ3RleHQvY3N2Jyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRpbmc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAkcGFyc2UoYXR0cnMuY3lUYWJsZUNzdikuYXNzaWduKHNjb3BlLiRwYXJlbnQsIGNzdik7XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZW5Dc3Yocm93cywgaWdub3JlUm93KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcm93cyB8fCAhcm93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlZFJvd3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgc2xpY2UuY2FsbChyb3dzKS5tYXAoZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gYW5ndWxhci5lbGVtZW50KHJvdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29scyA9IHJvdy5maW5kKCd0aCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29scyA9IHJvdy5maW5kKCd0ZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlnbm9yZVJvdyAmJiBpZ25vcmVSb3cocm93KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWRSb3dzLnB1c2goc2xpY2UuY2FsbChjb2xzKS5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjc3Yuc3RyaW5naWZ5KGFuZ3VsYXIuZWxlbWVudChjb2wpLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKHRtcENvbERlbGltKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ1wiJyArIGhhbmRsZWRSb3dzLmpvaW4odG1wUm93RGVsaW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQodG1wUm93RGVsaW0pLmpvaW4ocm93RGVsaW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQodG1wQ29sRGVsaW0pLmpvaW4oY29sRGVsaW0pICsgJ1wiJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBtb3N0IGNvbXBhdGlibGUgY3N2IGdlbmVyYXRvci9kb3dubG9hZCA8aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjkzMDQ0MTQ+XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZG93bmxvYWQoY29udGVudCwgZmlsZU5hbWUsIG1pbWVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICAgICAgICAgICAgICBtaW1lVHlwZSA9IG1pbWVUeXBlIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IubXNTYXZlQmxvYikgeyAvLyBJRTEwLzExL0VkZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubXNTYXZlQmxvYihuZXcgQmxvYihbY29udGVudF0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBtaW1lVHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSksIGZpbGVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgnZG93bmxvYWQnIGluIGEpIHsgLy9odG1sNSBBW2Rvd25sb2FkXVxuICAgICAgICAgICAgICAgICAgICAgICAgYS5ocmVmID0gJ2RhdGE6JyArIG1pbWVUeXBlICsgJywnICsgZW5jb2RlVVJJQ29tcG9uZW50KGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYS5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jbGljaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCA2Nik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy9kbyBpZnJhbWUgZGF0YVVSTCBkb3dubG9hZCAob2xkIGNoK0ZGKTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZi5zcmMgPSAnZGF0YTonICsgbWltZVR5cGUgKyAnLCcgKyBlbmNvZGVVUklDb21wb25lbnQoY29udGVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMzMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7XG5cbiAgICBhcHAucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoJ2N5LXRhYmxlL2ZpbHRlcnMvdGV4dC5odG1sJywgJzxpbnB1dCB0eXBlPVwidGV4dFwiIG5hbWU9XCJ7e2NvbHVtbi5maWx0ZXJOYW1lfX1cIiBuZy1tb2RlbD1cInBhcmFtcy5maWx0ZXIoKVtuYW1lXVwiIG5nLWNoYW5nZT1cInBhcmFtcy50cmFja0NoYW5nZXMoXFwnZmlsdGVyXFwnLCBwYXJhbXMuZmlsdGVyKCkpXCIgbmctaWY9XCJmaWx0ZXIgPT09IFxcJ3RleHRcXCcgJiYgcGFyYW1zLmZpbHRlclR5cGUoKSA9PT0gXFwnbG9jYWxcXCdcIiBjbGFzcz1cImlucHV0LWZpbHRlciBmb3JtLWNvbnRyb2xcIiAvPicpO1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoJ2N5LXRhYmxlL2hlYWRlci5odG1sJywgJzx0cj4gPHRoIG5nLXJlcGVhdD1cImNvbHVtbiBpbiAkY29sdW1uc1wiIG5nLWNsYXNzPVwieyBcXCdzb3J0YWJsZVxcJzogcGFyc2UoY29sdW1uLnNvcnRhYmxlKSwgXFwnc29ydC1hc2NcXCc6IHBhcmFtcy5zb3J0aW5nKClbcGFyc2UoY29sdW1uLnNvcnRhYmxlKV09PVxcJ2FzY1xcJywgXFwnc29ydC1kZXNjXFwnOiBwYXJhbXMuc29ydGluZygpW3BhcnNlKGNvbHVtbi5zb3J0YWJsZSldPT1cXCdkZXNjXFwnIH1cIiBuZy1jbGljaz1cInNvcnRCeShjb2x1bW4sICRldmVudClcIiBuZy1zaG93PVwiY29sdW1uLnNob3codGhpcylcIiBuZy1pbml0PVwidGVtcGxhdGU9Y29sdW1uLmhlYWRlclRlbXBsYXRlVVJMKHRoaXMpXCIgY2xhc3M9XCJoZWFkZXIge3tjb2x1bW4uY2xhc3N9fVwiPiA8ZGl2IG5nLWlmPVwiIXRlbXBsYXRlXCIgbmctc2hvdz1cIiF0ZW1wbGF0ZVwiIG5nLWJpbmQ9XCJwYXJzZShjb2x1bW4udGl0bGUpXCI+PC9kaXY+IDxkaXYgbmctaWY9XCJ0ZW1wbGF0ZVwiIG5nLXNob3c9XCJ0ZW1wbGF0ZVwiPjxkaXYgbmctaW5jbHVkZT1cInRlbXBsYXRlXCI+PC9kaXY+PC9kaXY+IDwvdGg+IDwvdHI+IDx0ciBuZy1zaG93PVwic2hvd0ZpbHRlciAmJiBwYXJhbXMuZmlsdGVyVHlwZSgpID09PSBcXCdsb2NhbFxcJ1wiIGNsYXNzPVwiY3ktdGFibGUtZmlsdGVyc1wiPiA8dGggbmctcmVwZWF0PVwiY29sdW1uIGluICRjb2x1bW5zXCIgbmctc2hvdz1cImNvbHVtbi5zaG93KHRoaXMpXCIgY2xhc3M9XCJmaWx0ZXJcIj4gPGRpdiBuZy1yZXBlYXQ9XCIobmFtZSwgZmlsdGVyKSBpbiBjb2x1bW4uZmlsdGVyXCI+IDxkaXYgbmctaWY9XCJjb2x1bW4uZmlsdGVyVGVtcGxhdGVVUkxcIiBuZy1zaG93PVwiY29sdW1uLmZpbHRlclRlbXBsYXRlVVJMXCI+IDxkaXYgbmctaW5jbHVkZT1cImNvbHVtbi5maWx0ZXJUZW1wbGF0ZVVSTFwiPjwvZGl2PiA8L2Rpdj4gPGRpdiBuZy1pZj1cIiFjb2x1bW4uZmlsdGVyVGVtcGxhdGVVUkxcIiBuZy1zaG93PVwiIWNvbHVtbi5maWx0ZXJUZW1wbGF0ZVVSTFwiPiA8ZGl2IG5nLWluY2x1ZGU9XCJcXCdjeS10YWJsZS9maWx0ZXJzL1xcJyArIGZpbHRlciArIFxcJy5odG1sXFwnXCI+PC9kaXY+IDwvZGl2PiA8L2Rpdj4gPC90aD4gPC90cj4nKTtcbiAgICAgICAgJHRlbXBsYXRlQ2FjaGUucHV0KCdjeS10YWJsZS9wYWdlci5odG1sJywgJzx1bCBjbGFzcz1cImN5LXRhYmxlLXBhZ2VyIHBhZ2VyIG5nLWNsb2FrXCI+PGxpIG5nLXJlcGVhdD1cInBhZ2UgaW4gcGFnZXNcIiBuZy1jbGFzcz1cIntcXCdkaXNhYmxlZFxcJzogIXBhZ2UuYWN0aXZlLCBcXCdwcmV2aW91c1xcJzogcGFnZS50eXBlID09PSBcXCdwcmV2XFwnLCBcXCduZXh0XFwnOiBwYWdlLnR5cGU9PT1cXCduZXh0XFwnfVwiPjxhIG5nLWlmPVwicGFnZS50eXBlID09PSBcXCdwcmV2XFwnXCIgbmctY2xpY2s9XCJwYXJhbXMucGFnZShwYWdlLm51bWJlcilcIiBocmVmPVwiXCI+UHJldjwvYT48YSBuZy1pZj1cInBhZ2UudHlwZSA9PT0gXFwnbmV4dFxcJ1wiIG5nLWNsaWNrPVwicGFyYW1zLnBhZ2UocGFnZS5udW1iZXIpXCIgaHJlZj1cIlwiPk5leHQ8L2E+PGEgbmctaWY9XCJwYWdlLnR5cGUgPT09IFxcJ3BhZ2VcXCcgfHwgcGFnZS50eXBlID09PSBcXCdmaXJzdFxcJyB8fCBwYWdlLnR5cGUgPT09IFxcJ2xhc3RcXCdcIiBuZy1jbGljaz1cInBhcmFtcy5wYWdlKHBhZ2UubnVtYmVyKVwiIGhyZWY9XCJcIj57e3BhZ2UubnVtYmVyfX08L2E+PGEgbmctaWY9XCJwYWdlLnR5cGUgPT09IFxcJ21vcmVcXCdcIiBuZy1jbGljaz1cInBhcmFtcy5wYWdlKHBhZ2UubnVtYmVyKVwiIGhyZWY9XCJcIj4uLi48L2E+PC9saT48L3VsPicpO1xuICAgIH1dKTtcblxuICAgIHJldHVybiBhcHA7XG59KSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=