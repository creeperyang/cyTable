"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["angular"],e);else{if("object"!=typeof exports)return e(t);module.exports=e(t)}}(angular||null,function(t){var e=t.module("cyTable",[]);e.config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|data):/)}]),e.factory("cyTableParams",["$q","$log","$filter",function(e,a,r){var n=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},i=function(t){return Object.keys?Object.keys(t).length:function(t){var e,a=0;for(e in t)a++;return a}(t)},l={adjust:function(e,a){return t.isArray(e)?{list:e.slice(0,a.count()),total:e.length}:t.isObject(e)?(e.list=e.list.slice(0,a.count()),e):(a.data=[],a.total(0),!1)},filter:function(t,e){var a=e.filter(),n=a?r("filter")(t.list,a):void 0;return n?{list:n,total:n.length===e.$state.count?e.originalTotal:n.length}:t},sort:function(t,e){var a=e.sorting(),n=a?r("orderBy")(t.list,e.orderBy()):void 0;return n?{list:n,total:t.total}:t}},o=function(r,o){var s=this,c=function(){u.debugMode&&a.debug&&a.debug.apply(this,arguments)};this.data=[],this.originalData=void 0,this.originalTotal=void 0,this.cacheType=void 0,this.changedStates={},this.state=function(e){if(t.isDefined(e)){for(var a in e){var r=e[a];s.trackChanges(a,r,p[a]),p[a]=n(e[a])?parseFloat(e[a]):e[a]}return c("cyTable: set state",p),this}return p},this.props=function(e){return t.isDefined(e)?(u=t.extend(u,e),c("cyTable: set props",u),this):u},this.page=function(e){return t.isDefined(e)?this.state({page:e}):p.page},this.filter=function(e){return t.isDefined(e)?this.state({filter:e}):p.filter},this.count=function(e){return t.isDefined(e)?this.state({count:e,page:1}):p.count},this.sortType=function(e){return t.isDefined(e)?this.state({sortType:e,page:1}):p.sortType},this.filterType=function(e){return t.isDefined(e)?this.state({filterType:e,page:1}):p.filterType},this.total=function(e){return t.isDefined(e)?this.props({total:e}):u.total},this.trackChanges=function(t,e,a){s.changedStates[t]={name:t,prev:a,cur:e}},this.shouldUseCache=function(t,e){var a=i(e);if(1===a){if(e.sorting)return"local"===s.$state.sortType?"sort-local":!1;if(e.filter)return"local"===t.filterType?"filter-local":!1}else if(2===a&&e.page&&e.count)return e.page.cur===e.page.prev&&e.count.cur<=e.count.prev?"count-local":!1;return!1},this.query=function(e){var a,r,n={};if(t.isArray(e))for(a in e)a in p&&(n[a]=p[a]);else if(t.isFunction(e))for(a in p)"filterType"!==a&&"sortType"!==a&&(r=e(a,p[a]),r===!0?n[a]=p[a]:t.isArray(r)&&(n[r[0]]=r[1]));else for(a in p)"filterType"!==a&&"sortType"!==a&&(n[a]=p[a]);return n},this.getData=function(e,a,r){e.resolve(t.isArray(this.data)&&t.isObject(a)?{list:r?this.data:this.data.slice((a.page()-1)*a.count(),a.page()*a.count())}:{list:[],total:0})},this.reload=function(){var t,a=e.defer();u.loading=u.$scope.$loading=!0,c("cyTable: about to reload."),(s.cacheType=s.shouldUseCache(p,s.changedStates))?(a.resolve({list:(s.originalData||s.data).slice(0,p.count),total:s.originalTotal||p.total}),t=a.promise):(u.getData(a,s),t=a.promise.then(function(t){var e=l.adjust(t,s);return e?(s.originalData=e.list,s.originalTotal=e.total):c("cyTable: data is empty or not valid.",t),e})),s.changedStates={},t.then(function(t){u.loading=u.$scope.$loading=!1,u.$scope.$csvGenerated=!1,t&&("local"===p.filterType&&p.filter&&(t=l.filter(t,s)),"local"===p.sortType&&p.sorting&&(t=l.sort(t,s)),c("cyTable: current scope",u.$scope),s.data=u.$scope.$data=t.list,n(t.total)&&s.total(t.total),u.$scope.pages=s.generatePagesArray(s.page(),s.total(),s.count()),u.$scope.$emit("cyTableAfterReloadData"))})},this.generatePagesArray=function(t,e,a){var r,n,i,l,o,s,c;if(r=11,s=[],o=Math.ceil(e/a),o>1){s.push({type:"prev",number:Math.max(1,t-1),active:t>1}),s.push({type:"first",number:1,active:t>1}),i=Math.round((r-5)/2),l=Math.max(2,t-i),n=Math.min(o-1,t+2*i-(t-l)),l=Math.max(2,l-(2*i-(n-l)));for(var p=l;n>=p;)c=p===l&&2!==p||p===n&&p!==o-1?{type:"more",active:t!==p,number:p}:{type:"page",number:p,active:t!==p},s.push(c),p++;s.push({type:"last",number:o,active:t!==o}),s.push({type:"next",number:Math.min(o,t+1),active:o>t})}return s},this.sorting=function(e){if(2===arguments.length){var a={};return a[e]=arguments[1],this.state({sorting:a}),this}return t.isDefined(e)?this.state({sorting:e}):p.sorting},this.orderBy=function(){var t=[];for(var e in p.sorting)t.push(("asc"===p.sorting[e]?"+":"-")+e);return t};var p=this.$state={page:1,count:5,filter:null,filterType:"local",sorting:null,sortType:"local"},u={loading:!1,total:0,$scope:null,defaultSort:"desc",filterDelay:750,counts:[5,10,25,50],sortingIndicator:"span",getData:this.getData};return this.props(o),this.state(r),this};return o}]);var a=["$scope","cyTableParams","$timeout",function(e,a,r){function n(t){e.params.sortType(t)}function i(t){e.params.filterType(t)}var l=function(){var t=0;return function(e,a){r.cancel(t),t=r(e,a)}}();e.$watch("params",function(a,r){t.isUndefined(a)||(e.$watch("filterType",function(t){t&&i(t)}),e.$watch("sortType",function(t){t&&n(t)}),e.$watch("params.$state",function(a,r){t.isUndefined(a)||(t.equals(a.filter,r&&r.filter)?e.params.reload():l(function(){e.params.$state.page=1,e.params.reload()},e.params.props().filterDelay))},!0))}),e.sortBy=function(t,a){var r=e.parse(t.sortable);if(r){var n=e.params.props().defaultSort,i="asc"===n?"desc":"asc",l=e.params.sorting()&&e.params.sorting()[r]&&e.params.sorting()[r]===n,o=a.ctrlKey||a.metaKey?e.params.sorting():{};o[r]=l?i:n,e.params.state({sorting:o})}}}];return e.directive("cyTable",["$compile","$q","$parse",function(e,r,n){return{restrict:"A",priority:1001,scope:!0,controller:a,compile:function(a){var r,i=[],l=0,o=a.find("table"),s=o.find("thead"),c=t.element(document.querySelector("tr:not(.cy-table-group)"));return c?(t.forEach(c.find("td"),function(e){var a=t.element(e);if(!a.attr("ignore-cell")||"true"!==a.attr("ignore-cell")){var r=function(t,e){return function(r){return n(a.attr("data-"+t)||a.attr(t))(r,{$columns:i})||e}},o=r("title"," "),s=r("header",!1),c=r("filter",!1)(),p=!1,u=!1;c&&c.$$name&&(u=c.$$name,delete c.$$name),c&&c.templateURL&&(p=c.templateURL,delete c.templateURL),a.attr("data-title-text",o()),i.push({id:l++,title:o,sortable:r("sortable",!1),"class":a.attr("data-header-class")||a.attr("header-class"),filter:c,filterTemplateURL:p,filterName:u,headerTemplateURL:s,filterData:a.attr("filter-data")?a.attr("filter-data"):null,show:a.attr("ng-show")?function(t){return n(a.attr("ng-show"))(t)}:function(){return!0}})}}),r=c.outerHTML?c.outerHTML:t.element("<div></div>").append(c.clone()).html(),function(a,l,o,c){var p=l.find("table").addClass("cy-table-content");if(a.$columns=i,a.$rowTpl="<table><tbody>"+r.replace(/^(\s*<\s*tr.+)(\$data)/,"$1$allData")+"</tbody></table>",o.$observe("filterType",function(t){a.filterType=t}),o.$observe("sortType",function(t){a.sortType=t}),a.$watch(o.tableParams,function(e){t.isUndefined(e)||(a.paramsModel=n(o.tableParams),a.params=e,e.props().$scope=a)},!0),a.parse=function(e){return t.isDefined(e)?e(a):""},o.showFilter&&a.$parent.$watch(o.showFilter,function(t){a.showFilter=t}),t.forEach(i,function(e){var r;if(e.filterData){if(r=n(e.filterData)(a,{$column:e}),!t.isObject(r)||!t.isObject(r.promise))throw new Error("Function "+e.filterData+" must be instance of $q.defer()");return delete e.filterData,r.promise.then(function(a){t.isArray(a)||(a=[]),a.unshift({title:"-",id:""}),e.data=a})}}),!l.hasClass("cy-table")){a.templates={header:o.templateHeader?o.templateHeader:"cy-table/header.html",pagination:o.templatePagination?o.templatePagination:"cy-table/pager.html",operation:o.templateOperation?o.templateOperation:"cy-table/operation.html"};var u=s.length>0?s:t.element(document.createElement("thead")).attr("ng-include","templates.header"),f=t.element(l[0].querySelector(".cy-table-pagination")),m=t.element(l[0].querySelector(".cy-table-operation"));f.attr({"cy-table-pagination":"params","template-url":"templates.pagination"}),m.attr({"cy-table-operation":"","template-url":"templates.operation"}),l.find("thead").remove(),l.addClass("cy-table"),p.prepend(u),e(u)(a),e(f)(a),e(m)(a)}}):void 0}}}]),e.directive("cyTablePagination",["$compile",function(e){return{restrict:"A",scope:{params:"=cyTablePagination",templateUrl:"="},replace:!1,link:function(a,r,n){a.$watch("params",function(e){t.isUndefined(e)||a.params.props().$scope.$on("cyTableAfterReloadData",function(){a.pages=a.params.generatePagesArray(a.params.page(),a.params.total(),a.params.count())},!0)}),a.$watch("templateUrl",function(n){if(!t.isUndefined(n)){var i=t.element(document.createElement("div"));i.attr({"ng-include":"templateUrl"}),r.append(i),e(i)(a)}})}}}]),e.directive("cyTableOperation",["$compile",function(e){return{restrict:"A",scope:!0,replace:!1,require:"^cyTable",link:function(a,r,n){n.templateUrl&&n.$observe("templateUrl",function(n){if(!t.isUndefined(n)){var i=t.element(document.createElement("div"));i.attr({"ng-include":n}),r.append(i),e(i)(a)}})}}}]),e.run(["$templateCache",function(t){t.put("cy-table/filters/text.html",'<input type="text" name="{{column.filterName}}" ng-model="params.filter()[name]" ng-change="params.trackChanges(\'filter\', params.filter())" ng-if="filter === \'text\' && params.filterType() === \'local\'" class="input-filter form-control" />'),t.put("cy-table/header.html",'<tr> <th ng-repeat="column in $columns" ng-class="{ \'sortable\': parse(column.sortable), \'sort-asc\': params.sorting()[parse(column.sortable)]==\'asc\', \'sort-desc\': params.sorting()[parse(column.sortable)]==\'desc\' }" ng-click="sortBy(column, $event)" ng-show="column.show(this)" ng-init="template=column.headerTemplateURL(this)" class="header {{column.class}}"> <div ng-if="!template" ng-show="!template" ng-bind="parse(column.title)"></div> <div ng-if="template" ng-show="template"><div ng-include="template"></div></div> </th> </tr> <tr ng-show="showFilter && params.filterType() === \'local\'" class="cy-table-filters"> <th ng-repeat="column in $columns" ng-show="column.show(this)" class="filter"> <div ng-repeat="(name, filter) in column.filter"> <div ng-if="column.filterTemplateURL" ng-show="column.filterTemplateURL"> <div ng-include="column.filterTemplateURL"></div> </div> <div ng-if="!column.filterTemplateURL" ng-show="!column.filterTemplateURL"> <div ng-include="\'cy-table/filters/\' + filter + \'.html\'"></div> </div> </div> </th> </tr>'),t.put("cy-table/pager.html",'<ul class="cy-table-pager pager ng-cloak"><li ng-repeat="page in pages" ng-class="{\'disabled\': !page.active, \'previous\': page.type === \'prev\', \'next\': page.type===\'next\'}"><a ng-if="page.type === \'prev\'" ng-click="params.page(page.number)" href="">Prev</a><a ng-if="page.type === \'next\'" ng-click="params.page(page.number)" href="">Next</a><a ng-if="page.type === \'page\' || page.type === \'first\' || page.type === \'last\'" ng-click="params.page(page.number)" href="">{{page.number}}</a><a ng-if="page.type === \'more\'" ng-click="params.page(page.number)" href="">...</a></li></ul>')}]),e});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN5LXRhYmxlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsImFwcCIsImNvbmZpZyIsIiRjb21waWxlUHJvdmlkZXIiLCJhSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCIsIiRxIiwiJGxvZyIsIiRmaWx0ZXIiLCJpc051bWJlciIsIm4iLCJpc05hTiIsInBhcnNlRmxvYXQiLCJpc0Zpbml0ZSIsImdldGtleXNMZW5ndGgiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwicCIsImkiLCJkYXRhSGFuZGxlcnMiLCJhZGp1c3QiLCJkYXRhIiwidGFibGVQYXJhbXMiLCJpc0FycmF5IiwibGlzdCIsInNsaWNlIiwiY291bnQiLCJ0b3RhbCIsImlzT2JqZWN0IiwiZmlsdGVyIiwidW5kZWZpbmVkIiwiJHN0YXRlIiwib3JpZ2luYWxUb3RhbCIsInNvcnQiLCJzb3J0aW5nIiwib3JkZXJCeSIsImN5VGFibGVQYXJhbXMiLCJpbml0U3RhdGUiLCJpbml0UHJvcHMiLCJzZWxmIiwidGhpcyIsImxvZyIsInByb3BzIiwiZGVidWdNb2RlIiwiZGVidWciLCJhcHBseSIsImFyZ3VtZW50cyIsIm9yaWdpbmFsRGF0YSIsImNhY2hlVHlwZSIsImNoYW5nZWRTdGF0ZXMiLCJzdGF0ZSIsIm5ld1N0YXRlIiwiaXNEZWZpbmVkIiwia2V5IiwidmFsdWUiLCJ0cmFja0NoYW5nZXMiLCJuZXdQcm9wcyIsImV4dGVuZCIsInBhZ2UiLCJzb3J0VHlwZSIsImZpbHRlclR5cGUiLCJuZXdWYWx1ZSIsIm9sZFZhbHVlIiwibmFtZSIsInByZXYiLCJjdXIiLCJzaG91bGRVc2VDYWNoZSIsInF1ZXJ5IiwidG1wIiwicmV0IiwiaXNGdW5jdGlvbiIsImdldERhdGEiLCIkZGVmZXIiLCJhbGwiLCJyZXNvbHZlIiwicmVsb2FkIiwicHJvbWlzZSIsImRlZmVyIiwibG9hZGluZyIsIiRzY29wZSIsIiRsb2FkaW5nIiwidGhlbiIsImhhbmRsZWREYXRhIiwiJGNzdkdlbmVyYXRlZCIsIiRkYXRhIiwicGFnZXMiLCJnZW5lcmF0ZVBhZ2VzQXJyYXkiLCIkZW1pdCIsImN1cnJlbnRQYWdlIiwidG90YWxJdGVtcyIsInBhZ2VTaXplIiwibWF4QmxvY2tzIiwibWF4UGFnZSIsIm1heFBpdm90UGFnZXMiLCJtaW5QYWdlIiwibnVtUGFnZXMiLCJ0bXBJdGVtIiwiTWF0aCIsImNlaWwiLCJwdXNoIiwidHlwZSIsIm51bWJlciIsIm1heCIsImFjdGl2ZSIsInJvdW5kIiwibWluIiwic29ydEFycmF5IiwiY29sdW1uIiwiZGVmYXVsdFNvcnQiLCJmaWx0ZXJEZWxheSIsImNvdW50cyIsInNvcnRpbmdJbmRpY2F0b3IiLCJjeVRhYmxlQ29udHJvbGxlciIsIiR0aW1lb3V0Iiwic2V0U29ydFR5cGUiLCJwYXJhbXMiLCJzZXRGaWx0ZXJUeXBlIiwiZGVsYXlGaWx0ZXIiLCJ0aW1lciIsImNhbGxiYWNrIiwibXMiLCJjYW5jZWwiLCIkd2F0Y2giLCJuZXdQYXJhbXMiLCJvbGRQYXJhbXMiLCJpc1VuZGVmaW5lZCIsIm9sZFN0YXRlIiwiZXF1YWxzIiwic29ydEJ5IiwiZXZlbnQiLCJwYXJzZWRTb3J0YWJsZSIsInBhcnNlIiwic29ydGFibGUiLCJpbnZlcnNlU29ydCIsInNvcnRpbmdQYXJhbXMiLCJjdHJsS2V5IiwibWV0YUtleSIsImRpcmVjdGl2ZSIsIiRjb21waWxlIiwiJHBhcnNlIiwicmVzdHJpY3QiLCJwcmlvcml0eSIsInNjb3BlIiwiY29udHJvbGxlciIsImNvbXBpbGUiLCJlbGVtZW50Iiwicm93VHBsIiwiY29sdW1ucyIsInRhYmxlIiwiZmluZCIsInRoZWFkIiwicm93IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZm9yRWFjaCIsIml0ZW0iLCJlbCIsImF0dHIiLCJwYXJzZWRBdHRyaWJ1dGUiLCJkZWZhdWx0VmFsdWUiLCIkY29sdW1ucyIsInBhcnNlZFRpdGxlIiwiaGVhZGVyVGVtcGxhdGVVUkwiLCJmaWx0ZXJUZW1wbGF0ZVVSTCIsImZpbHRlck5hbWUiLCIkJG5hbWUiLCJ0ZW1wbGF0ZVVSTCIsImlkIiwidGl0bGUiLCJjbGFzcyIsImZpbHRlckRhdGEiLCJzaG93Iiwib3V0ZXJIVE1MIiwiYXBwZW5kIiwiY2xvbmUiLCJodG1sIiwiYXR0cnMiLCJjdHJsIiwiYWRkQ2xhc3MiLCIkcm93VHBsIiwicmVwbGFjZSIsIiRvYnNlcnZlIiwicGFyYW1zTW9kZWwiLCJ0ZXh0Iiwic2hvd0ZpbHRlciIsIiRwYXJlbnQiLCJkZWYiLCIkY29sdW1uIiwiRXJyb3IiLCJ1bnNoaWZ0IiwiaGFzQ2xhc3MiLCJ0ZW1wbGF0ZXMiLCJoZWFkZXIiLCJ0ZW1wbGF0ZUhlYWRlciIsInBhZ2luYXRpb24iLCJ0ZW1wbGF0ZVBhZ2luYXRpb24iLCJvcGVyYXRpb24iLCJ0ZW1wbGF0ZU9wZXJhdGlvbiIsImhlYWRlclRlbXBsYXRlIiwiY3JlYXRlRWxlbWVudCIsInBhZ2luYXRpb25UZW1wbGF0ZSIsIm9wZXJhdGlvblRlbXBsYXRlIiwiY3ktdGFibGUtcGFnaW5hdGlvbiIsInRlbXBsYXRlLXVybCIsImN5LXRhYmxlLW9wZXJhdGlvbiIsInJlbW92ZSIsInByZXBlbmQiLCJ0ZW1wbGF0ZVVybCIsImxpbmsiLCIkb24iLCJ0ZW1wbGF0ZSIsIm5nLWluY2x1ZGUiLCJyZXF1aXJlIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUUsU0FBU0EsRUFBU0MsR0FFaEIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN2Q0QsUUFBUSxXQUFZRCxPQUNqQixDQUFBLEdBQXVCLGdCQUFaRyxTQUdkLE1BQU9ILEdBQVFELEVBRmZLLFFBQU9ELFFBQVVILEVBQVFELEtBSy9CQSxTQUFXLEtBQU0sU0FBU0EsR0FFeEIsR0FBSU0sR0FBTU4sRUFBUUssT0FBTyxhQU96QkMsR0FBSUMsUUFBUSxtQkFBb0IsU0FBU0MsR0FDckNBLEVBQWlCQywyQkFBMkIsNkNBUWhESCxFQUFJTCxRQUFRLGlC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LEVBQVN3RSxHQUFVcEUsV0FPdkM5SSxFQUFJcU4sS0FBSyxpQkFBa0IsU0FBU0MsR0FDaENBLEVBQWVDLElBQUksNkJBQThCLHVQQUNqREQsRUFBZUMsSUFBSSx1QkFBd0IsdWlDQUMzQ0QsRUFBZUMsSUFBSSxzQkFBdUIsOGxCQUd2Q3ZOIiwiZmlsZSI6ImN5LXRhYmxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG47KGZ1bmN0aW9uKGFuZ3VsYXIsIGZhY3RvcnkpIHtcblxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKFsnYW5ndWxhciddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoYW5ndWxhcik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhY3RvcnkoYW5ndWxhcik7XG4gICAgfVxuXG59KGFuZ3VsYXIgfHwgbnVsbCwgZnVuY3Rpb24oYW5ndWxhcikge1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjeVRhYmxlJywgW10pO1xuXG4gICAgLypcbiAgICAgKiBhdHRlbnNpb246IEFuZ3VsYXJKUyAxLjMueCwgJCRTYW5pdGl6ZVVyaVByb3ZpZGVyIHNldCBhSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCA9IC9eXFxzKihodHRwcz98ZnRwfG1haWx0b3x0ZWx8ZmlsZSk6L1xuICAgICAqIGFuZCBleHBvcnQgY3N2LCBocmVmIHdvdWxkIGJlIGxpa2UgYGRhdGE6dGV4dC9jc3YuLi5gXG4gICAgICogaWYgZG9udCBjaGFuZ2UgdGhpcywgYW5ndWxhciB3b3VsZCBhZGQgYHVuc2FmZTpgIHByZWZpeCwgc28gbW9kaWZ5IGFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0XG4gICAgKi9cbiAgICBhcHAuY29uZmlnKFsnJGNvbXBpbGVQcm92aWRlcicsIGZ1bmN0aW9uKCRjb21waWxlUHJvdmlkZXIpIHtcbiAgICAgICAgJGNvbXBpbGVQcm92aWRlci5hSHJlZlNhbml0aXphdGlvbldoaXRlbGlzdCgvXlxccyooaHR0cHM/fGZ0cHxtYWlsdG98dGVsfGZpbGV8ZGF0YSk6Lyk7XG4gICAgfV0pO1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIHNlcnZpY2VcbiAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAqIEBkZXNjcmlwdGlvbiBQYXJhbWV0ZXJzIG1hbmFnZXIgZm9yIGN5VGFibGVcbiAgICAgKi9cbiAgICBhcHAuZmFjdG9yeSgnY3lUYWJsZVBhcmFtcycsIFsnJHEnLCAnJGxvZycsICckZmlsdGVyJywgZnVuY3Rpb24oJHEsICRsb2csICRmaWx0ZXIpIHtcbiAgICAgICAgdmFyIGlzTnVtYmVyID0gZnVuY3Rpb24obikge1xuICAgICAgICAgICAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG4pKSAmJiBpc0Zpbml0ZShuKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGdldGtleXNMZW5ndGggPSBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyA/IE9iamVjdC5rZXlzKG9iaikubGVuZ3RoIDogKGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgICAgIHZhciBpID0gMCwgcDtcbiAgICAgICAgICAgICAgICBmb3IgKHAgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9KShvYmopO1xuICAgICAgICB9O1xuICAgICAgICAvLyBkYXRhIGhhbmRsZXJzIHRvIGhhbmRsZSBkYXRhIGdldCBmcm9tICNnZXREYXRhXG4gICAgICAgIC8vIGlubmVyIHVzYWdlIG5vd1xuICAgICAgICB2YXIgZGF0YUhhbmRsZXJzID0ge1xuICAgICAgICAgICAgYWRqdXN0OiBmdW5jdGlvbiBhZGp1c3REYXRhKGRhdGEsIHRhYmxlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogZGF0YS5zbGljZSgwLCB0YWJsZVBhcmFtcy5jb3VudCgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiBkYXRhLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYW5ndWxhci5pc09iamVjdChkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmxpc3QgPSBkYXRhLmxpc3Quc2xpY2UoMCwgdGFibGVQYXJhbXMuY291bnQoKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlUGFyYW1zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGFibGVQYXJhbXMudG90YWwoMCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiBmaWx0ZXJEYXRhKGRhdGEsIHRhYmxlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlciA9IHRhYmxlUGFyYW1zLmZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gZmlsdGVyID8gJGZpbHRlcignZmlsdGVyJykoZGF0YS5saXN0LCBmaWx0ZXIpIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0ID8ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0OiBsaXN0LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogbGlzdC5sZW5ndGggPT09IHRhYmxlUGFyYW1zLiRzdGF0ZS5jb3VudCA/IHRhYmxlUGFyYW1zLm9yaWdpbmFsVG90YWwgOiBsaXN0Lmxlbmd0aFxuICAgICAgICAgICAgICAgIH0gOiBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNvcnQ6IGZ1bmN0aW9uIHNvcnREYXRhKGRhdGEsIHRhYmxlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRpbmcgPSB0YWJsZVBhcmFtcy5zb3J0aW5nKCk7XG4gICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBzb3J0aW5nID8gJGZpbHRlcignb3JkZXJCeScpKGRhdGEubGlzdCwgdGFibGVQYXJhbXMub3JkZXJCeSgpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdCA/IHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdDogbGlzdCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGRhdGEudG90YWxcbiAgICAgICAgICAgICAgICB9IDogZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY3lUYWJsZVBhcmFtcyA9IGZ1bmN0aW9uKGluaXRTdGF0ZSwgaW5pdFByb3BzKSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByb3BzLmRlYnVnTW9kZSAmJiAkbG9nLmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyB0YWJsZSBkYXRhXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIC8vIHVzZWQgdG8ga2VlcCBvcmlnaW5hbCBkYXRhKGZldGNoZWQgZnJvbSByZW1vdGUpXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxUb3RhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIC8vIFdoZXRoZXIgdG8gdXNlIGNhY2hlLlxuICAgICAgICAgICAgLy8gVXNlZnVsIGZvciBleGFtcGxlLCB3aGVuIHlvdSBzZXQgcGFnZSBsZW5ndGggNTAgdG8gMjAsIG5vIG5lZWQgdG8gcmVsb2FkIGRhdGEuXG4gICAgICAgICAgICB0aGlzLmNhY2hlVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIC8vIHRoZSBjaGFuZ2VkIHN0YXRlIHByb3BlcnRpZXMsIHJlc2V0IGFmdGVyIHJlbG9hZCxcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlZFN0YXRlcyA9IHt9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3N0YXRlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBTZXQgbmV3IHN0YXRlIG9yIGdldCBjdXJyZW50IHN0YXRlXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5ld1N0YXRlIE5ldyBzdGF0ZVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdH0gQ3VycmVudCBzdGF0ZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbmV3U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG5ld1N0YXRlW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYWNrQ2hhbmdlcyhrZXksIHZhbHVlLCBzdGF0ZVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlW2tleV0gPSAoaXNOdW1iZXIobmV3U3RhdGVba2V5XSkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQobmV3U3RhdGVba2V5XSkgOiBuZXdTdGF0ZVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsb2coJ2N5VGFibGU6IHNldCBzdGF0ZScsIHN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjcHJvcHNcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIFNldCBuZXcgcHJvcHMgb3IgZ2V0IGN1cnJlbnQgcHJvcHNcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3UHJvcHMgTmV3IHByb3BzIG9yIHVuZGVmaW5lZFxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdH0gQ3VycmVudCBwcm9wcyBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5wcm9wcyA9IGZ1bmN0aW9uKG5ld1Byb3BzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKG5ld1Byb3BzKSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9wcyA9IGFuZ3VsYXIuZXh0ZW5kKHByb3BzLCBuZXdQcm9wcyk7XG4gICAgICAgICAgICAgICAgICAgIGxvZygnY3lUYWJsZTogc2V0IHByb3BzJywgcHJvcHMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNwYWdlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgcGFnZSBub3Qgc2V0IHJldHVybiBjdXJyZW50IHBhZ2UgZWxzZSBzZXQgY3VycmVudCBwYWdlXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBhZ2UgUGFnZSBudW1iZXJcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R8TnVtYmVyfSBDdXJyZW50IHBhZ2Ugb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMucGFnZSA9IGZ1bmN0aW9uKHBhZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQocGFnZSkgPyB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgJ3BhZ2UnOiBwYWdlXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5wYWdlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNmaWx0ZXJcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIElmIHBhcmFtZXRlciBwYWdlIG5vdCBzZXQgcmV0dXJuIGN1cnJlbnQgZmlsdGVyIGVsc2Ugc2V0IGN1cnJlbnQgZmlsdGVyXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciBOZXcgZmlsdGVyXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDdXJyZW50IGZpbHRlciBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoZmlsdGVyKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnZmlsdGVyJzogZmlsdGVyXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5maWx0ZXI7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2NvdW50XG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgY291bnQgbm90IHNldCByZXR1cm4gY3VycmVudCBjb3VudCBwZXIgcGFnZSBlbHNlIHNldCBjb3VudCBwZXIgcGFnZVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb3VudCBDb3VudCBwZXIgbnVtYmVyXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fE51bWJlcn0gQ291bnQgcGVyIHBhZ2Ugb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuY291bnQgPSBmdW5jdGlvbihjb3VudCkge1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IHRvIGZpcnN0IHBhZ2UgYmVjYXVzZSBjYW4gYmUgYmxhbmsgcGFnZVxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChjb3VudCkgPyB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogY291bnQsXG4gICAgICAgICAgICAgICAgICAgICdwYWdlJzogMVxuICAgICAgICAgICAgICAgIH0pIDogc3RhdGUuY291bnQ7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3NvcnRUeXBlXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgc29ydFR5cGUgbm90IHNldCByZXR1cm4gY3VycmVudCBzb3J0VHlwZSBlbHNlIHNldCBzb3J0VHlwZVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3J0VHlwZSBob3cgdG8gc29ydCBkYXRhKCdyZW1vdGUnOiBsZXQgc2VydmVyIHNvcnQgYWxsIGRhdGEgaW4gZGJ8J2xvY2FsJzogc29ydCBsb2NhbClcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R8TnVtYmVyfSBTb3J0VHlwZSBvciBgdGhpc2BcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5zb3J0VHlwZSA9IGZ1bmN0aW9uKHNvcnRUeXBlKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgdG8gZmlyc3QgcGFnZSBiZWNhdXNlIGNhbiBiZSBibGFuayBwYWdlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHNvcnRUeXBlKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnc29ydFR5cGUnOiBzb3J0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgJ3BhZ2UnOiAxXG4gICAgICAgICAgICAgICAgfSkgOiBzdGF0ZS5zb3J0VHlwZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjZmlsdGVyVHlwZVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gSWYgcGFyYW1ldGVyIGZpbHRlclR5cGUgbm90IHNldCByZXR1cm4gY3VycmVudCBmaWx0ZXJUeXBlIGVsc2Ugc2V0IGZpbHRlclR5cGVcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyVHlwZSBob3cgdG8gZmlsdGVyIGRhdGEoJ3JlbW90ZSc6IGxldCBzZXJ2ZXIgc2VhcmNoIGZyb20gZGJ8J2xvY2FsJzogZmlsdGVyIGxvY2FsKVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdHxOdW1iZXJ9IEZpbHRlclR5cGUgb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVHlwZSA9IGZ1bmN0aW9uKGZpbHRlclR5cGUpIHtcbiAgICAgICAgICAgICAgICAvLyByZXNldCB0byBmaXJzdCBwYWdlIGJlY2F1c2UgY2FuIGJlIGJsYW5rIHBhZ2VcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoZmlsdGVyVHlwZSkgPyB0aGlzLnN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgJ2ZpbHRlclR5cGUnOiBmaWx0ZXJUeXBlLFxuICAgICAgICAgICAgICAgICAgICAncGFnZSc6IDFcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLmZpbHRlclR5cGU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3RvdGFsXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiBwYXJhbWV0ZXIgdG90YWwgbm90IHNldCByZXR1cm4gY3VycmVudCBxdWFudGl0eSBlbHNlIHNldCBxdWFudGl0eVxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0b3RhbCBUb3RhbCBxdWFudGl0eSBvZiBpdGVtc1xuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdHxOdW1iZXJ9IEN1cnJlbnQgdG90YWwgb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMudG90YWwgPSBmdW5jdGlvbih0b3RhbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZCh0b3RhbCkgPyB0aGlzLnByb3BzKHtcbiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsJzogdG90YWxcbiAgICAgICAgICAgICAgICB9KSA6IHByb3BzLnRvdGFsO1xuICAgICAgICAgICAgfTtcblxuXG5cbiAgICAgICAgICAgIC8vIGlubmVyIHVzYWdlIG9ubHkgbm93XG4gICAgICAgICAgICAvLyB0cmFjayB3aGF0IGNoYW5nZWQgd2l0aCBzdGF0ZVxuICAgICAgICAgICAgdGhpcy50cmFja0NoYW5nZXMgPSBmdW5jdGlvbihrZXksIG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2hhbmdlZFN0YXRlc1trZXldID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXksXG4gICAgICAgICAgICAgICAgICAgIHByZXY6IG9sZFZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBjdXI6IG5ld1ZhbHVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGlubmVyIHVzYWdlIG9ubHkgbm93XG4gICAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0byB1c2UgY2FjaGVcbiAgICAgICAgICAgIHRoaXMuc2hvdWxkVXNlQ2FjaGUgPSBmdW5jdGlvbihzdGF0ZSwgY2hhbmdlZFN0YXRlcykge1xuICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSBnZXRrZXlzTGVuZ3RoKGNoYW5nZWRTdGF0ZXMpO1xuICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYW5nZWRTdGF0ZXMuc29ydGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuJHN0YXRlLnNvcnRUeXBlID09PSAnbG9jYWwnID8gJ3NvcnQtbG9jYWwnIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYW5nZWRTdGF0ZXMuZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuZmlsdGVyVHlwZSA9PT0gJ2xvY2FsJyA/ICdmaWx0ZXItbG9jYWwnIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZFN0YXRlcy5wYWdlICYmIGNoYW5nZWRTdGF0ZXMuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkU3RhdGVzLnBhZ2UuY3VyID09PSBjaGFuZ2VkU3RhdGVzLnBhZ2UucHJldiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRTdGF0ZXMuY291bnQuY3VyIDw9IGNoYW5nZWRTdGF0ZXMuY291bnQucHJldiA/ICdjb3VudC1sb2NhbCcgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI3F1ZXJ5XG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBDYWxsZWQgYnkgdXNlciB0byBidWlsZCBxdWVyeSBwYXJhbXMgZm9yIGFqYXguXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbnxBcnJheX0gb3B0aW9uYWwgZmlsdGVyLiBXaGVuIGl0J3MgYXJyYXksIGl0J3MgcHJvcGVydHkgbmFtZXMgd2hpY2ggbmVlZGVkIGJ5IHVzZXI7XG4gICAgICAgICAgICAgKiAgICAgd2hlbiBpdCdzIGZ1bmN0aW9uLCByZXR1cm4gdHJ1ZXxmYWxzZSB0byBmaWx0ZXIgcHJvcGVydGllcywgb3IgcmV0dXJuIGFuIGFycmF5KFt1cGRhdGVkTmFtZSwgdXBkYXRlZFZhbHVlXSkuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0ge30sIHAsIHRtcDtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChwIGluIGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgKHAgaW4gc3RhdGUpICYmIChyZXRbcF0gPSBzdGF0ZVtwXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAocCBpbiBzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAgPT09ICdmaWx0ZXJUeXBlJyB8fCBwID09PSAnc29ydFR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSBmaWx0ZXIocCwgc3RhdGVbcF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFtwXSA9IHN0YXRlW3BdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbmd1bGFyLmlzQXJyYXkodG1wKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFt0bXBbMF1dID0gdG1wWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChwIGluIHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA9PT0gJ2ZpbHRlclR5cGUnIHx8IHAgPT09ICdzb3J0VHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFtwXSA9IHN0YXRlW3BdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2dldERhdGFcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIENhbGxlZCB0byBnZXQgbmV3IGRhdGEgd2hlbiBzdGF0ZSBjaGFuZ2VkXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRkZWZlciBwcm9taXNlIG9iamVjdFxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHN0YXRlIE5ldyBzdGF0ZVxuICAgICAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBhbGwgV2hldGhlciB0byBnZXQgYWxsIGRhdGFcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5nZXREYXRhID0gZnVuY3Rpb24oJGRlZmVyLCBzdGF0ZSwgYWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheSh0aGlzLmRhdGEpICYmIGFuZ3VsYXIuaXNPYmplY3Qoc3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Q6IGFsbCA/IHRoaXMuZGF0YSA6IHRoaXMuZGF0YS5zbGljZSgoc3RhdGUucGFnZSgpIC0gMSkgKiBzdGF0ZS5jb3VudCgpLCBzdGF0ZS5wYWdlKCkgKiBzdGF0ZS5jb3VudCgpKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkZGVmZXIucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAgICAgICAgICogQG5hbWUgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXMjcmVsb2FkXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBSZWxvYWQgdGFibGUgZGF0YVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciAkZGVmZXIgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlO1xuXG4gICAgICAgICAgICAgICAgLy8gc2V0IGxvYWRpbmcgdG8gdHJ1ZVxuICAgICAgICAgICAgICAgIHByb3BzLmxvYWRpbmcgPSBwcm9wcy4kc2NvcGUuJGxvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBhYm91dCB0byByZWxvYWQuJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoKHNlbGYuY2FjaGVUeXBlID0gc2VsZi5zaG91bGRVc2VDYWNoZShzdGF0ZSwgc2VsZi5jaGFuZ2VkU3RhdGVzKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGRlZmVyLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogKHNlbGYub3JpZ2luYWxEYXRhIHx8IHNlbGYuZGF0YSkuc2xpY2UoMCwgc3RhdGUuY291bnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHNlbGYub3JpZ2luYWxUb3RhbCB8fCBzdGF0ZS50b3RhbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9ICRkZWZlci5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BzLmdldERhdGEoJGRlZmVyLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9ICRkZWZlci5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZWREYXRhID0gZGF0YUhhbmRsZXJzLmFkanVzdChkYXRhLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3JpZ2luYWxEYXRhID0gaGFuZGxlZERhdGEubGlzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9yaWdpbmFsVG90YWwgPSBoYW5kbGVkRGF0YS50b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBkYXRhIGlzIGVtcHR5IG9yIG5vdCB2YWxpZC4nLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVkRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VsZi5jaGFuZ2VkU3RhdGVzID0ge307XG5cbiAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24oaGFuZGxlZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMubG9hZGluZyA9IHByb3BzLiRzY29wZS4kbG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBwcm9wcy4kc2NvcGUuJGNzdkdlbmVyYXRlZCA9IGZhbHNlOyAvLyBuZWVkIHJlZ2VuZXJhdGUgY3N2XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFuZGxlZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBmaWx0ZXIgbG9jYWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZpbHRlclR5cGUgPT09ICdsb2NhbCcgJiYgc3RhdGUuZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVkRGF0YSA9IGRhdGFIYW5kbGVycy5maWx0ZXIoaGFuZGxlZERhdGEsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHNvcnQgbG9jYWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNvcnRUeXBlID09PSAnbG9jYWwnICYmIHN0YXRlLnNvcnRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWREYXRhID0gZGF0YUhhbmRsZXJzLnNvcnQoaGFuZGxlZERhdGEsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbG9nKCdjeVRhYmxlOiBjdXJyZW50IHNjb3BlJywgcHJvcHMuJHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZGF0YSA9IHByb3BzLiRzY29wZS4kZGF0YSA9IGhhbmRsZWREYXRhLmxpc3Q7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyKGhhbmRsZWREYXRhLnRvdGFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b3RhbChoYW5kbGVkRGF0YS50b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuJHNjb3BlLnBhZ2VzID0gc2VsZi5nZW5lcmF0ZVBhZ2VzQXJyYXkoc2VsZi5wYWdlKCksIHNlbGYudG90YWwoKSwgc2VsZi5jb3VudCgpKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuJHNjb3BlLiRlbWl0KCdjeVRhYmxlQWZ0ZXJSZWxvYWREYXRhJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI2dlbmVyYXRlUGFnZXNBcnJheVxuICAgICAgICAgICAgICogQG1ldGhvZE9mIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gR2VuZXJhdGUgYXJyYXkgb2YgcGFnZXNcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGN1cnJlbnRQYWdlIHdoaWNoIHBhZ2UgbXVzdCBiZSBhY3RpdmVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gdG90YWxJdGVtcyBUb3RhbCBxdWFudGl0eSBvZiBpdGVtc1xuICAgICAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBwYWdlU2l6ZSBRdWFudGl0eSBvZiBpdGVtcyBvbiBwYWdlXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIHBhZ2VzXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVQYWdlc0FycmF5ID0gZnVuY3Rpb24oY3VycmVudFBhZ2UsIHRvdGFsSXRlbXMsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1heEJsb2NrcywgbWF4UGFnZSwgbWF4UGl2b3RQYWdlcywgbWluUGFnZSwgbnVtUGFnZXMsIHBhZ2VzO1xuICAgICAgICAgICAgICAgIHZhciB0bXBJdGVtO1xuICAgICAgICAgICAgICAgIG1heEJsb2NrcyA9IDExO1xuICAgICAgICAgICAgICAgIHBhZ2VzID0gW107XG4gICAgICAgICAgICAgICAgbnVtUGFnZXMgPSBNYXRoLmNlaWwodG90YWxJdGVtcyAvIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICBpZiAobnVtUGFnZXMgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3ByZXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBNYXRoLm1heCgxLCBjdXJyZW50UGFnZSAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSA+IDFcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ZpcnN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogY3VycmVudFBhZ2UgPiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBtYXhQaXZvdFBhZ2VzID0gTWF0aC5yb3VuZCgobWF4QmxvY2tzIC0gNSkgLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgbWluUGFnZSA9IE1hdGgubWF4KDIsIGN1cnJlbnRQYWdlIC0gbWF4UGl2b3RQYWdlcyk7XG4gICAgICAgICAgICAgICAgICAgIG1heFBhZ2UgPSBNYXRoLm1pbihudW1QYWdlcyAtIDEsIGN1cnJlbnRQYWdlICsgbWF4UGl2b3RQYWdlcyAqIDIgLSAoY3VycmVudFBhZ2UgLSBtaW5QYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgIG1pblBhZ2UgPSBNYXRoLm1heCgyLCBtaW5QYWdlIC0gKG1heFBpdm90UGFnZXMgKiAyIC0gKG1heFBhZ2UgLSBtaW5QYWdlKSkpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG1pblBhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDw9IG1heFBhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaSA9PT0gbWluUGFnZSAmJiBpICE9PSAyKSB8fCAoaSA9PT0gbWF4UGFnZSAmJiBpICE9PSBudW1QYWdlcyAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wSXRlbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21vcmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGN1cnJlbnRQYWdlICE9PSBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBJdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSAhPT0gaVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2godG1wSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcGFnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGFzdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG51bVBhZ2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBjdXJyZW50UGFnZSAhPT0gbnVtUGFnZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ25leHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBNYXRoLm1pbihudW1QYWdlcywgY3VycmVudFBhZ2UgKyAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogY3VycmVudFBhZ2UgPCBudW1QYWdlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZ2VzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICAgICAgICAgKiBAbmFtZSBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtcyNzb3J0aW5nXG4gICAgICAgICAgICAgKiBAbWV0aG9kT2YgY3lUYWJsZS5mYWN0b3J5OmN5VGFibGVQYXJhbXNcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiBJZiAnc29ydGluZycgcGFyYW1ldGVyIGlzIG5vdCBzZXQsIHJldHVybiBjdXJyZW50IHNvcnRpbmcuIE90aGVyd2lzZSBzZXQgY3VycmVudCBzb3J0aW5nLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3J0aW5nIE5ldyBzb3J0aW5nXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDdXJyZW50IHNvcnRpbmcgb3IgYHRoaXNgXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuc29ydGluZyA9IGZ1bmN0aW9uKHNvcnRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc29ydEFycmF5ID0ge307XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnJheVtzb3J0aW5nXSA9IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc29ydGluZyc6IHNvcnRBcnJheVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzRGVmaW5lZChzb3J0aW5nKSA/IHRoaXMuc3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAnc29ydGluZyc6IHNvcnRpbmdcbiAgICAgICAgICAgICAgICB9KSA6IHN0YXRlLnNvcnRpbmc7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgICAgICAgICAqIEBuYW1lIGN5VGFibGUuZmFjdG9yeTpjeVRhYmxlUGFyYW1zI29yZGVyQnlcbiAgICAgICAgICAgICAqIEBtZXRob2RPZiBjeVRhYmxlLmZhY3Rvcnk6Y3lUYWJsZVBhcmFtc1xuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIFJldHVybiBvYmplY3Qgb2Ygc29ydGluZyBwYXJhbWV0ZXJzIGZvciBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgbGlrZTogWyAnLW5hbWUnLCAnK2FnZScgXVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLm9yZGVyQnkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc29ydGluZyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGNvbHVtbiBpbiBzdGF0ZS5zb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRpbmcucHVzaCgoc3RhdGUuc29ydGluZ1tjb2x1bW5dID09PSAnYXNjJyA/ICcrJyA6ICctJykgKyBjb2x1bW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGluZztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSB3aWxsIGJlIHdhdGNoZWQgYnkgY29udHJvbGxlciB0byByZWxvYWRcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHRoaXMuJHN0YXRlID0ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IDEsXG4gICAgICAgICAgICAgICAgY291bnQ6IDUsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIGZpbHRlclR5cGU6ICdsb2NhbCcsIC8vICdyZW1vdGUnfCdsb2NhbCdcbiAgICAgICAgICAgICAgICBzb3J0aW5nOiBudWxsLFxuICAgICAgICAgICAgICAgIHNvcnRUeXBlOiAnbG9jYWwnIC8vICdyZW1vdGUnfCdsb2NhbCdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGFsdGhvdWdoIHNvbWUgbGlrZSB0b3RhbCBpcyBtb3JlIGFwcHJvcHJpYXRlIHRvIHBsYWNlIHRvIHN0YXRlLFxuICAgICAgICAgICAgLy8gaXQncyBwbGFjZWQgaGVyZSB0byBhdm9pZCBleHRyYSByZWFsb2RcbiAgICAgICAgICAgIHZhciBwcm9wcyA9IHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgICAgICAkc2NvcGU6IG51bGwsIC8vIHNldCBieSBjeVRhYmxlQ29udHJvbGxlclxuICAgICAgICAgICAgICAgIGRlZmF1bHRTb3J0OiAnZGVzYycsXG4gICAgICAgICAgICAgICAgZmlsdGVyRGVsYXk6IDc1MCxcbiAgICAgICAgICAgICAgICBjb3VudHM6IFs1LCAxMCwgMjUsIDUwXSxcbiAgICAgICAgICAgICAgICBzb3J0aW5nSW5kaWNhdG9yOiAnc3BhbicsXG4gICAgICAgICAgICAgICAgZ2V0RGF0YTogdGhpcy5nZXREYXRhXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnByb3BzKGluaXRQcm9wcyk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlKGluaXRTdGF0ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY3lUYWJsZVBhcmFtcztcbiAgICB9XSk7XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2Mgb2JqZWN0XG4gICAgICogQG5hbWUgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZS5jeVRhYmxlQ29udHJvbGxlclxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogRWFjaCB7QGxpbmsgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZSBjeVRhYmxlfSBkaXJlY3RpdmUgY3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgY3lUYWJsZUNvbnRyb2xsZXJgXG4gICAgICovXG4gICAgdmFyIGN5VGFibGVDb250cm9sbGVyID0gWyckc2NvcGUnLCAnY3lUYWJsZVBhcmFtcycsICckdGltZW91dCcsIGZ1bmN0aW9uKCRzY29wZSwgY3lUYWJsZVBhcmFtcywgJHRpbWVvdXQpIHtcbiAgICAgICAgdmFyIGRlbGF5RmlsdGVyID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRpbWVyID0gMDtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaywgbXMpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZXIpO1xuICAgICAgICAgICAgICAgIHRpbWVyID0gJHRpbWVvdXQoY2FsbGJhY2ssIG1zKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgncGFyYW1zJywgZnVuY3Rpb24obmV3UGFyYW1zLCBvbGRQYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKG5ld1BhcmFtcykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2ZpbHRlclR5cGUnLCBmdW5jdGlvbihmaWx0ZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2V0RmlsdGVyVHlwZShmaWx0ZXJUeXBlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnc29ydFR5cGUnLCBmdW5jdGlvbihzb3J0VHlwZSkge1xuICAgICAgICAgICAgICAgIGlmICghc29ydFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRTb3J0VHlwZShzb3J0VHlwZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3BhcmFtcy4kc3RhdGUnLCBmdW5jdGlvbihuZXdTdGF0ZSwgb2xkU3RhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChuZXdTdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWFuZ3VsYXIuZXF1YWxzKG5ld1N0YXRlLmZpbHRlciwgb2xkU3RhdGUgJiYgb2xkU3RhdGUuZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxheUZpbHRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMuJHN0YXRlLnBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgJHNjb3BlLnBhcmFtcy5wcm9wcygpLmZpbHRlckRlbGF5KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuc29ydEJ5ID0gZnVuY3Rpb24oY29sdW1uLCBldmVudCkge1xuICAgICAgICAgICAgdmFyIHBhcnNlZFNvcnRhYmxlID0gJHNjb3BlLnBhcnNlKGNvbHVtbi5zb3J0YWJsZSk7XG4gICAgICAgICAgICBpZiAoIXBhcnNlZFNvcnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGRlZmF1bHRTb3J0ID0gJHNjb3BlLnBhcmFtcy5wcm9wcygpLmRlZmF1bHRTb3J0O1xuICAgICAgICAgICAgdmFyIGludmVyc2VTb3J0ID0gKGRlZmF1bHRTb3J0ID09PSAnYXNjJyA/ICdkZXNjJyA6ICdhc2MnKTtcbiAgICAgICAgICAgIHZhciBzb3J0aW5nID0gJHNjb3BlLnBhcmFtcy5zb3J0aW5nKCkgJiYgJHNjb3BlLnBhcmFtcy5zb3J0aW5nKClbcGFyc2VkU29ydGFibGVdICYmICgkc2NvcGUucGFyYW1zLnNvcnRpbmcoKVtwYXJzZWRTb3J0YWJsZV0gPT09IGRlZmF1bHRTb3J0KTtcbiAgICAgICAgICAgIHZhciBzb3J0aW5nUGFyYW1zID0gKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgPyAkc2NvcGUucGFyYW1zLnNvcnRpbmcoKSA6IHt9O1xuICAgICAgICAgICAgc29ydGluZ1BhcmFtc1twYXJzZWRTb3J0YWJsZV0gPSAoc29ydGluZyA/IGludmVyc2VTb3J0IDogZGVmYXVsdFNvcnQpO1xuICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5zdGF0ZSh7XG4gICAgICAgICAgICAgICAgc29ydGluZzogc29ydGluZ1BhcmFtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0U29ydFR5cGUodHlwZSkge1xuICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5zb3J0VHlwZSh0eXBlKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZXRGaWx0ZXJUeXBlKHR5cGUpIHtcbiAgICAgICAgICAgICRzY29wZS5wYXJhbXMuZmlsdGVyVHlwZSh0eXBlKTtcbiAgICAgICAgfVxuICAgIH1dO1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGRpcmVjdGl2ZVxuICAgICAqIEBuYW1lIGN5VGFibGUuZGlyZWN0aXZlOmN5VGFibGVcbiAgICAgKiBAcmVzdHJpY3QgRUFcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIERpcmVjdGl2ZSB0aGF0IGluc3RhbnRpYXRlcyB7QGxpbmsgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZS5jeVRhYmxlQ29udHJvbGxlciBjeVRhYmxlQ29udHJvbGxlcn0uXG4gICAgICovXG4gICAgYXBwLmRpcmVjdGl2ZSgnY3lUYWJsZScsIFsnJGNvbXBpbGUnLCAnJHEnLCAnJHBhcnNlJyxcbiAgICAgICAgZnVuY3Rpb24oJGNvbXBpbGUsICRxLCAkcGFyc2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAxMDAxLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGN5VGFibGVDb250cm9sbGVyLFxuICAgICAgICAgICAgICAgIGNvbXBpbGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93VHBsO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGN1c3RvbSBoZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gZWxlbWVudC5maW5kKCd0YWJsZScpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGhlYWQgPSB0YWJsZS5maW5kKCd0aGVhZCcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93ID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RyOm5vdCguY3ktdGFibGUtZ3JvdXApJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghcm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvdy5maW5kKCd0ZCcpLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBhbmd1bGFyLmVsZW1lbnQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwuYXR0cignaWdub3JlLWNlbGwnKSAmJiAndHJ1ZScgPT09IGVsLmF0dHIoJ2lnbm9yZS1jZWxsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyc2VkQXR0cmlidXRlID0gZnVuY3Rpb24oYXR0ciwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcGFyc2UoZWwuYXR0cignZGF0YS0nICsgYXR0cikgfHwgZWwuYXR0cihhdHRyKSkoc2NvcGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5zOiBjb2x1bW5zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIHx8IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZFRpdGxlID0gcGFyc2VkQXR0cmlidXRlKCd0aXRsZScsICcgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGVVUkwgPSBwYXJzZWRBdHRyaWJ1dGUoJ2hlYWRlcicsIGZhbHNlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBwYXJzZWRBdHRyaWJ1dGUoJ2ZpbHRlcicsIGZhbHNlKSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclRlbXBsYXRlVVJMID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyTmFtZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyICYmIGZpbHRlci4kJG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyLiQkbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZmlsdGVyLiQkbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyLnRlbXBsYXRlVVJMKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVGVtcGxhdGVVUkwgPSBmaWx0ZXIudGVtcGxhdGVVUkw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbHRlci50ZW1wbGF0ZVVSTDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZWwuYXR0cignZGF0YS10aXRsZS10ZXh0JywgcGFyc2VkVGl0bGUoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpKyssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHBhcnNlZFRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBwYXJzZWRBdHRyaWJ1dGUoJ3NvcnRhYmxlJywgZmFsc2UpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcyc6IGVsLmF0dHIoJ2RhdGEtaGVhZGVyLWNsYXNzJykgfHwgZWwuYXR0cignaGVhZGVyLWNsYXNzJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiBmaWx0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVGVtcGxhdGVVUkw6IGZpbHRlclRlbXBsYXRlVVJMLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlck5hbWU6IGZpbHRlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGVtcGxhdGVVUkw6IGhlYWRlclRlbXBsYXRlVVJMLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckRhdGE6IChlbC5hdHRyKCdmaWx0ZXItZGF0YScpID8gZWwuYXR0cignZmlsdGVyLWRhdGEnKSA6IG51bGwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3c6IChlbC5hdHRyKCduZy1zaG93JykgPyBmdW5jdGlvbihzY29wZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBhcnNlKGVsLmF0dHIoJ25nLXNob3cnKSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcm93VHBsID0gcm93Lm91dGVySFRNTCA/IHJvdy5vdXRlckhUTUwgOiBhbmd1bGFyLmVsZW1lbnQoJzxkaXY+PC9kaXY+JykuYXBwZW5kKHJvdy5jbG9uZSgpKS5odG1sKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gZWxlbWVudC5maW5kKCd0YWJsZScpLmFkZENsYXNzKCdjeS10YWJsZS1jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kY29sdW1ucyA9IGNvbHVtbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kcm93VHBsID0gJzx0YWJsZT48dGJvZHk+JyArIHJvd1RwbC5yZXBsYWNlKC9eKFxccyo8XFxzKnRyLispKFxcJGRhdGEpLywgJyQxJGFsbERhdGEnKSArICc8L3Rib2R5PjwvdGFibGU+JztcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ2ZpbHRlclR5cGUnLCBmdW5jdGlvbihmaWx0ZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmlsdGVyVHlwZSA9IGZpbHRlclR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdzb3J0VHlwZScsIGZ1bmN0aW9uKHNvcnRUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc29ydFR5cGUgPSBzb3J0VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLnRhYmxlUGFyYW1zLCAoZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQocGFyYW1zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcmFtc01vZGVsID0gJHBhcnNlKGF0dHJzLnRhYmxlUGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJhbXMgPSBwYXJhbXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnByb3BzKCkuJHNjb3BlID0gc2NvcGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJzZSA9IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQodGV4dCkgPyB0ZXh0KHNjb3BlKSA6ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRycy5zaG93RmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHBhcmVudC4kd2F0Y2goYXR0cnMuc2hvd0ZpbHRlciwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd0ZpbHRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGNvbHVtbnMsIGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2x1bW4uZmlsdGVyRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZiA9ICRwYXJzZShjb2x1bW4uZmlsdGVyRGF0YSkoc2NvcGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbjogY29sdW1uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYW5ndWxhci5pc09iamVjdChkZWYpICYmIGFuZ3VsYXIuaXNPYmplY3QoZGVmLnByb21pc2UpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Z1bmN0aW9uICcgKyBjb2x1bW4uZmlsdGVyRGF0YSArICcgbXVzdCBiZSBpbnN0YW5jZSBvZiAkcS5kZWZlcigpJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb2x1bW4uZmlsdGVyRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS51bnNoaWZ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnLScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50Lmhhc0NsYXNzKCdjeS10YWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudGVtcGxhdGVzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IChhdHRycy50ZW1wbGF0ZUhlYWRlciA/IGF0dHJzLnRlbXBsYXRlSGVhZGVyIDogJ2N5LXRhYmxlL2hlYWRlci5odG1sJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IChhdHRycy50ZW1wbGF0ZVBhZ2luYXRpb24gPyBhdHRycy50ZW1wbGF0ZVBhZ2luYXRpb24gOiAnY3ktdGFibGUvcGFnZXIuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb246IChhdHRycy50ZW1wbGF0ZU9wZXJhdGlvbiA/IGF0dHJzLnRlbXBsYXRlT3BlcmF0aW9uIDogJ2N5LXRhYmxlL29wZXJhdGlvbi5odG1sJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXJUZW1wbGF0ZSA9IHRoZWFkLmxlbmd0aCA+IDAgPyB0aGVhZCA6IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpKS5hdHRyKCduZy1pbmNsdWRlJywgJ3RlbXBsYXRlcy5oZWFkZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnaW5hdGlvblRlbXBsYXRlID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcignLmN5LXRhYmxlLXBhZ2luYXRpb24nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wZXJhdGlvblRlbXBsYXRlID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcignLmN5LXRhYmxlLW9wZXJhdGlvbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uVGVtcGxhdGUuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjeS10YWJsZS1wYWdpbmF0aW9uJzogJ3BhcmFtcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZW1wbGF0ZS11cmwnOiAndGVtcGxhdGVzLnBhZ2luYXRpb24nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uVGVtcGxhdGUuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjeS10YWJsZS1vcGVyYXRpb24nOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RlbXBsYXRlLXVybCc6ICd0ZW1wbGF0ZXMub3BlcmF0aW9uJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgndGhlYWQnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdjeS10YWJsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnByZXBlbmQoaGVhZGVyVGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKGhlYWRlclRlbXBsYXRlKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUocGFnaW5hdGlvblRlbXBsYXRlKShzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUob3BlcmF0aW9uVGVtcGxhdGUpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcblxuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGRpcmVjdGl2ZVxuICAgICAqIEBuYW1lIGN5VGFibGUuZGlyZWN0aXZlOmN5VGFibGVQYWdpbmF0aW9uXG4gICAgICogQHJlc3RyaWN0IEFcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIERpcmVjdGl2ZSB0aGF0IGhhbmRsZXMgcGFnaW5hdGlvblxuICAgICAqL1xuICAgIGFwcC5kaXJlY3RpdmUoJ2N5VGFibGVQYWdpbmF0aW9uJywgWyckY29tcGlsZScsXG4gICAgICAgIGZ1bmN0aW9uKCRjb21waWxlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICAgICAgJ3BhcmFtcyc6ICc9Y3lUYWJsZVBhZ2luYXRpb24nLFxuICAgICAgICAgICAgICAgICAgICAndGVtcGxhdGVVcmwnOiAnPSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcGxhY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3BhcmFtcycsIGZ1bmN0aW9uKHBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQocGFyYW1zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcmFtcy5wcm9wcygpLiRzY29wZS4kb24oJ2N5VGFibGVBZnRlclJlbG9hZERhdGEnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYWdlcyA9IHNjb3BlLnBhcmFtcy5nZW5lcmF0ZVBhZ2VzQXJyYXkoc2NvcGUucGFyYW1zLnBhZ2UoKSwgc2NvcGUucGFyYW1zLnRvdGFsKCksIHNjb3BlLnBhcmFtcy5jb3VudCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3RlbXBsYXRlVXJsJywgZnVuY3Rpb24odGVtcGxhdGVVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHRlbXBsYXRlVXJsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICduZy1pbmNsdWRlJzogJ3RlbXBsYXRlVXJsJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZCh0ZW1wbGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZSh0ZW1wbGF0ZSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgXSk7XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgZGlyZWN0aXZlXG4gICAgICogQG5hbWUgY3lUYWJsZS5kaXJlY3RpdmU6Y3lUYWJsZU9wZXJhdGlvblxuICAgICAqIEByZXN0cmljdCBBXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBEaXJlY3RpdmUgdGhhdCBoYW5kbGVzIHRhYmxlJ3MgcGFnZSBjb3VudCwgZmlsdGVyLCBhbmQgc28gb25cbiAgICAgKi9cbiAgICBhcHAuZGlyZWN0aXZlKCdjeVRhYmxlT3BlcmF0aW9uJywgWyckY29tcGlsZScsXG4gICAgICAgIGZ1bmN0aW9uKCRjb21waWxlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICAgICAgc2NvcGU6IHRydWUsXG4gICAgICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZTogJ15jeVRhYmxlJyxcbiAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhdHRycy50ZW1wbGF0ZVVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCd0ZW1wbGF0ZVVybCcsIGZ1bmN0aW9uKHRlbXBsYXRlVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh0ZW1wbGF0ZVVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGUuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25nLWluY2x1ZGUnOiB0ZW1wbGF0ZVVybFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZCh0ZW1wbGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZSh0ZW1wbGF0ZSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgXSk7XG5cbiAgICBhcHAucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoJ2N5LXRhYmxlL2ZpbHRlcnMvdGV4dC5odG1sJywgJzxpbnB1dCB0eXBlPVwidGV4dFwiIG5hbWU9XCJ7e2NvbHVtbi5maWx0ZXJOYW1lfX1cIiBuZy1tb2RlbD1cInBhcmFtcy5maWx0ZXIoKVtuYW1lXVwiIG5nLWNoYW5nZT1cInBhcmFtcy50cmFja0NoYW5nZXMoXFwnZmlsdGVyXFwnLCBwYXJhbXMuZmlsdGVyKCkpXCIgbmctaWY9XCJmaWx0ZXIgPT09IFxcJ3RleHRcXCcgJiYgcGFyYW1zLmZpbHRlclR5cGUoKSA9PT0gXFwnbG9jYWxcXCdcIiBjbGFzcz1cImlucHV0LWZpbHRlciBmb3JtLWNvbnRyb2xcIiAvPicpO1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoJ2N5LXRhYmxlL2hlYWRlci5odG1sJywgJzx0cj4gPHRoIG5nLXJlcGVhdD1cImNvbHVtbiBpbiAkY29sdW1uc1wiIG5nLWNsYXNzPVwieyBcXCdzb3J0YWJsZVxcJzogcGFyc2UoY29sdW1uLnNvcnRhYmxlKSwgXFwnc29ydC1hc2NcXCc6IHBhcmFtcy5zb3J0aW5nKClbcGFyc2UoY29sdW1uLnNvcnRhYmxlKV09PVxcJ2FzY1xcJywgXFwnc29ydC1kZXNjXFwnOiBwYXJhbXMuc29ydGluZygpW3BhcnNlKGNvbHVtbi5zb3J0YWJsZSldPT1cXCdkZXNjXFwnIH1cIiBuZy1jbGljaz1cInNvcnRCeShjb2x1bW4sICRldmVudClcIiBuZy1zaG93PVwiY29sdW1uLnNob3codGhpcylcIiBuZy1pbml0PVwidGVtcGxhdGU9Y29sdW1uLmhlYWRlclRlbXBsYXRlVVJMKHRoaXMpXCIgY2xhc3M9XCJoZWFkZXIge3tjb2x1bW4uY2xhc3N9fVwiPiA8ZGl2IG5nLWlmPVwiIXRlbXBsYXRlXCIgbmctc2hvdz1cIiF0ZW1wbGF0ZVwiIG5nLWJpbmQ9XCJwYXJzZShjb2x1bW4udGl0bGUpXCI+PC9kaXY+IDxkaXYgbmctaWY9XCJ0ZW1wbGF0ZVwiIG5nLXNob3c9XCJ0ZW1wbGF0ZVwiPjxkaXYgbmctaW5jbHVkZT1cInRlbXBsYXRlXCI+PC9kaXY+PC9kaXY+IDwvdGg+IDwvdHI+IDx0ciBuZy1zaG93PVwic2hvd0ZpbHRlciAmJiBwYXJhbXMuZmlsdGVyVHlwZSgpID09PSBcXCdsb2NhbFxcJ1wiIGNsYXNzPVwiY3ktdGFibGUtZmlsdGVyc1wiPiA8dGggbmctcmVwZWF0PVwiY29sdW1uIGluICRjb2x1bW5zXCIgbmctc2hvdz1cImNvbHVtbi5zaG93KHRoaXMpXCIgY2xhc3M9XCJmaWx0ZXJcIj4gPGRpdiBuZy1yZXBlYXQ9XCIobmFtZSwgZmlsdGVyKSBpbiBjb2x1bW4uZmlsdGVyXCI+IDxkaXYgbmctaWY9XCJjb2x1bW4uZmlsdGVyVGVtcGxhdGVVUkxcIiBuZy1zaG93PVwiY29sdW1uLmZpbHRlclRlbXBsYXRlVVJMXCI+IDxkaXYgbmctaW5jbHVkZT1cImNvbHVtbi5maWx0ZXJUZW1wbGF0ZVVSTFwiPjwvZGl2PiA8L2Rpdj4gPGRpdiBuZy1pZj1cIiFjb2x1bW4uZmlsdGVyVGVtcGxhdGVVUkxcIiBuZy1zaG93PVwiIWNvbHVtbi5maWx0ZXJUZW1wbGF0ZVVSTFwiPiA8ZGl2IG5nLWluY2x1ZGU9XCJcXCdjeS10YWJsZS9maWx0ZXJzL1xcJyArIGZpbHRlciArIFxcJy5odG1sXFwnXCI+PC9kaXY+IDwvZGl2PiA8L2Rpdj4gPC90aD4gPC90cj4nKTtcbiAgICAgICAgJHRlbXBsYXRlQ2FjaGUucHV0KCdjeS10YWJsZS9wYWdlci5odG1sJywgJzx1bCBjbGFzcz1cImN5LXRhYmxlLXBhZ2VyIHBhZ2VyIG5nLWNsb2FrXCI+PGxpIG5nLXJlcGVhdD1cInBhZ2UgaW4gcGFnZXNcIiBuZy1jbGFzcz1cIntcXCdkaXNhYmxlZFxcJzogIXBhZ2UuYWN0aXZlLCBcXCdwcmV2aW91c1xcJzogcGFnZS50eXBlID09PSBcXCdwcmV2XFwnLCBcXCduZXh0XFwnOiBwYWdlLnR5cGU9PT1cXCduZXh0XFwnfVwiPjxhIG5nLWlmPVwicGFnZS50eXBlID09PSBcXCdwcmV2XFwnXCIgbmctY2xpY2s9XCJwYXJhbXMucGFnZShwYWdlLm51bWJlcilcIiBocmVmPVwiXCI+UHJldjwvYT48YSBuZy1pZj1cInBhZ2UudHlwZSA9PT0gXFwnbmV4dFxcJ1wiIG5nLWNsaWNrPVwicGFyYW1zLnBhZ2UocGFnZS5udW1iZXIpXCIgaHJlZj1cIlwiPk5leHQ8L2E+PGEgbmctaWY9XCJwYWdlLnR5cGUgPT09IFxcJ3BhZ2VcXCcgfHwgcGFnZS50eXBlID09PSBcXCdmaXJzdFxcJyB8fCBwYWdlLnR5cGUgPT09IFxcJ2xhc3RcXCdcIiBuZy1jbGljaz1cInBhcmFtcy5wYWdlKHBhZ2UubnVtYmVyKVwiIGhyZWY9XCJcIj57e3BhZ2UubnVtYmVyfX08L2E+PGEgbmctaWY9XCJwYWdlLnR5cGUgPT09IFxcJ21vcmVcXCdcIiBuZy1jbGljaz1cInBhcmFtcy5wYWdlKHBhZ2UubnVtYmVyKVwiIGhyZWY9XCJcIj4uLi48L2E+PC9saT48L3VsPicpO1xuICAgIH1dKTtcblxuICAgIHJldHVybiBhcHA7XG59KSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=